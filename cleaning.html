<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data Cleaning | Personality Predictors of Dementia Diagnosis and Neuropathic Burden: A Mega-Analysis</title>
  <meta name="description" content="Personality, Dementia, and Neuropathology" />
  <meta name="generator" content="bookdown 0.29 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data Cleaning | Personality Predictors of Dementia Diagnosis and Neuropathic Burden: A Mega-Analysis" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Personality, Dementia, and Neuropathology" />
  <meta name="github-repo" content="emoriebeck/personality-dementia-neuropath" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data Cleaning | Personality Predictors of Dementia Diagnosis and Neuropathic Burden: A Mega-Analysis" />
  
  <meta name="twitter:description" content="Personality, Dementia, and Neuropathology" />
  



<meta name="date" content="2023-07-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="runmodels.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Workspace</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#directory-path"><i class="fa fa-check"></i><b>1.2</b> Directory Path</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#codebook"><i class="fa fa-check"></i><b>1.3</b> Codebook</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#tables"><i class="fa fa-check"></i><b>1.4</b> Tables</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#table-s1"><i class="fa fa-check"></i><b>1.4.1</b> Table S1</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#table-s2"><i class="fa fa-check"></i><b>1.4.2</b> Table S2</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#table-s3"><i class="fa fa-check"></i><b>1.4.3</b> Table S3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>2</b> Data Cleaning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cleaning.html"><a href="cleaning.html#health-and-retirement-study-hrs"><i class="fa fa-check"></i><b>2.1</b> Health and Retirement Study (HRS)</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="cleaning.html"><a href="cleaning.html#load-data"><i class="fa fa-check"></i><b>2.1.1</b> Load Data</a></li>
<li class="chapter" data-level="2.1.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring"><i class="fa fa-check"></i><b>2.1.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.1.3" data-path="cleaning.html"><a href="cleaning.html#covariates"><i class="fa fa-check"></i><b>2.1.3</b> Covariates</a></li>
<li class="chapter" data-level="2.1.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables"><i class="fa fa-check"></i><b>2.1.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.1.5" data-path="cleaning.html"><a href="cleaning.html#cognition-variables"><i class="fa fa-check"></i><b>2.1.5</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.1.6" data-path="cleaning.html"><a href="cleaning.html#outcome-variables"><i class="fa fa-check"></i><b>2.1.6</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.1.7" data-path="cleaning.html"><a href="cleaning.html#combine-data"><i class="fa fa-check"></i><b>2.1.7</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="cleaning.html"><a href="cleaning.html#rush-memory-and-and-aging-project-rush-map"><i class="fa fa-check"></i><b>2.2</b> RUSH Memory and and Aging Project (RUSH-MAP)</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="cleaning.html"><a href="cleaning.html#load-data-1"><i class="fa fa-check"></i><b>2.2.1</b> Load Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-1"><i class="fa fa-check"></i><b>2.2.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.2.3" data-path="cleaning.html"><a href="cleaning.html#covariates-1"><i class="fa fa-check"></i><b>2.2.3</b> Covariates</a></li>
<li class="chapter" data-level="2.2.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-1"><i class="fa fa-check"></i><b>2.2.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.2.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-1"><i class="fa fa-check"></i><b>2.2.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.2.6" data-path="cleaning.html"><a href="cleaning.html#cognition-variables-1"><i class="fa fa-check"></i><b>2.2.6</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.2.7" data-path="cleaning.html"><a href="cleaning.html#combine-data-1"><i class="fa fa-check"></i><b>2.2.7</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cleaning.html"><a href="cleaning.html#rush-religious-orders-study-ros"><i class="fa fa-check"></i><b>2.3</b> RUSH Religious Orders Study (ROS)</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-2"><i class="fa fa-check"></i><b>2.3.1</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.3.2" data-path="cleaning.html"><a href="cleaning.html#covariates-2"><i class="fa fa-check"></i><b>2.3.2</b> Covariates</a></li>
<li class="chapter" data-level="2.3.3" data-path="cleaning.html"><a href="cleaning.html#personality-variables-2"><i class="fa fa-check"></i><b>2.3.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.3.4" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-2"><i class="fa fa-check"></i><b>2.3.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.3.5" data-path="cleaning.html"><a href="cleaning.html#cognition-variables-2"><i class="fa fa-check"></i><b>2.3.5</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.3.6" data-path="cleaning.html"><a href="cleaning.html#combine-data-2"><i class="fa fa-check"></i><b>2.3.6</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="cleaning.html"><a href="cleaning.html#swedish-adoption-twin-study-of-aging-satsa"><i class="fa fa-check"></i><b>2.4</b> Swedish Adoption Twin Study of Aging (SATSA)</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="cleaning.html"><a href="cleaning.html#load-data-2"><i class="fa fa-check"></i><b>2.4.1</b> Load Data</a></li>
<li class="chapter" data-level="2.4.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-3"><i class="fa fa-check"></i><b>2.4.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.4.3" data-path="cleaning.html"><a href="cleaning.html#covariates-3"><i class="fa fa-check"></i><b>2.4.3</b> Covariates</a></li>
<li class="chapter" data-level="2.4.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-3"><i class="fa fa-check"></i><b>2.4.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.4.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-3"><i class="fa fa-check"></i><b>2.4.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.4.6" data-path="cleaning.html"><a href="cleaning.html#cognition-variables-3"><i class="fa fa-check"></i><b>2.4.6</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.4.7" data-path="cleaning.html"><a href="cleaning.html#combine-data-3"><i class="fa fa-check"></i><b>2.4.7</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="cleaning.html"><a href="cleaning.html#adrc-memory-and-aging-project-adrc-map"><i class="fa fa-check"></i><b>2.5</b> ADRC Memory and Aging Project (ADRC-MAP)</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="cleaning.html"><a href="cleaning.html#load-data-3"><i class="fa fa-check"></i><b>2.5.1</b> Load Data</a></li>
<li class="chapter" data-level="2.5.2" data-path="cleaning.html"><a href="cleaning.html#recode-reverse-scoring"><i class="fa fa-check"></i><b>2.5.2</b> Recode &amp; Reverse-Scoring</a></li>
<li class="chapter" data-level="2.5.3" data-path="cleaning.html"><a href="cleaning.html#covariates-4"><i class="fa fa-check"></i><b>2.5.3</b> Covariates</a></li>
<li class="chapter" data-level="2.5.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-4"><i class="fa fa-check"></i><b>2.5.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.5.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-4"><i class="fa fa-check"></i><b>2.5.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.5.6" data-path="cleaning.html"><a href="cleaning.html#cognition-variables-4"><i class="fa fa-check"></i><b>2.5.6</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.5.7" data-path="cleaning.html"><a href="cleaning.html#combine-data-4"><i class="fa fa-check"></i><b>2.5.7</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="cleaning.html"><a href="cleaning.html#einstein-aging-study"><i class="fa fa-check"></i><b>2.6</b> Einstein Aging Study</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="cleaning.html"><a href="cleaning.html#load-data-4"><i class="fa fa-check"></i><b>2.6.1</b> Load Data</a></li>
<li class="chapter" data-level="2.6.2" data-path="cleaning.html"><a href="cleaning.html#recode-reverse-scoring-1"><i class="fa fa-check"></i><b>2.6.2</b> Recode &amp; Reverse-Scoring</a></li>
<li class="chapter" data-level="2.6.3" data-path="cleaning.html"><a href="cleaning.html#covariates-5"><i class="fa fa-check"></i><b>2.6.3</b> Covariates</a></li>
<li class="chapter" data-level="2.6.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-5"><i class="fa fa-check"></i><b>2.6.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.6.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-5"><i class="fa fa-check"></i><b>2.6.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.6.6" data-path="cleaning.html"><a href="cleaning.html#cognition-variables-5"><i class="fa fa-check"></i><b>2.6.6</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.6.7" data-path="cleaning.html"><a href="cleaning.html#combine-data-5"><i class="fa fa-check"></i><b>2.6.7</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="cleaning.html"><a href="cleaning.html#german-socioeconomic-panel-study-gsoep"><i class="fa fa-check"></i><b>2.7</b> German Socioeconomic Panel Study (GSOEP)</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="cleaning.html"><a href="cleaning.html#load-data-5"><i class="fa fa-check"></i><b>2.7.1</b> Load Data</a></li>
<li class="chapter" data-level="2.7.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-4"><i class="fa fa-check"></i><b>2.7.2</b> Recoding &amp; Reverse Scoring</a></li>
<li class="chapter" data-level="2.7.3" data-path="cleaning.html"><a href="cleaning.html#covariates-6"><i class="fa fa-check"></i><b>2.7.3</b> Covariates</a></li>
<li class="chapter" data-level="2.7.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-6"><i class="fa fa-check"></i><b>2.7.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.7.5" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-6"><i class="fa fa-check"></i><b>2.7.5</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.7.6" data-path="cleaning.html"><a href="cleaning.html#cognition-variables-6"><i class="fa fa-check"></i><b>2.7.6</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.7.7" data-path="cleaning.html"><a href="cleaning.html#combine-data-6"><i class="fa fa-check"></i><b>2.7.7</b> Combine Data</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="cleaning.html"><a href="cleaning.html#the-longitudinal-studies-for-the-social-sciences-liss"><i class="fa fa-check"></i><b>2.8</b> The Longitudinal Studies for the Social sciences (LISS)</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="cleaning.html"><a href="cleaning.html#load-data-6"><i class="fa fa-check"></i><b>2.8.1</b> Load Data</a></li>
<li class="chapter" data-level="2.8.2" data-path="cleaning.html"><a href="cleaning.html#recoding-reverse-scoring-5"><i class="fa fa-check"></i><b>2.8.2</b> Recoding &amp; Reverse-Scoring</a></li>
<li class="chapter" data-level="2.8.3" data-path="cleaning.html"><a href="cleaning.html#covariates-7"><i class="fa fa-check"></i><b>2.8.3</b> Covariates</a></li>
<li class="chapter" data-level="2.8.4" data-path="cleaning.html"><a href="cleaning.html#personality-variables-7"><i class="fa fa-check"></i><b>2.8.4</b> Personality Variables</a></li>
<li class="chapter" data-level="2.8.5" data-path="cleaning.html"><a href="cleaning.html#cognition-variables-7"><i class="fa fa-check"></i><b>2.8.5</b> Cognition Variables</a></li>
<li class="chapter" data-level="2.8.6" data-path="cleaning.html"><a href="cleaning.html#outcome-variables-7"><i class="fa fa-check"></i><b>2.8.6</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.8.7" data-path="cleaning.html"><a href="cleaning.html#combine-data-7"><i class="fa fa-check"></i><b>2.8.7</b> Combine Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="runmodels.html"><a href="runmodels.html"><i class="fa fa-check"></i><b>3</b> Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="runmodels.html"><a href="runmodels.html#part-1-combine-data"><i class="fa fa-check"></i><b>3.1</b> Part 1: Combine Data</a></li>
<li class="chapter" data-level="3.2" data-path="runmodels.html"><a href="runmodels.html#part-2-clean-and-prepare-data-sets"><i class="fa fa-check"></i><b>3.2</b> Part 2: Clean and Prepare Data Sets</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="runmodels.html"><a href="runmodels.html#descriptives"><i class="fa fa-check"></i><b>3.2.1</b> Descriptives</a></li>
<li class="chapter" data-level="3.2.2" data-path="runmodels.html"><a href="runmodels.html#zero-order-correlations"><i class="fa fa-check"></i><b>3.2.2</b> Zero-Order Correlations</a></li>
<li class="chapter" data-level="3.2.3" data-path="runmodels.html"><a href="runmodels.html#pomp-and-factor-levels"><i class="fa fa-check"></i><b>3.2.3</b> POMP and Factor Levels</a></li>
<li class="chapter" data-level="3.2.4" data-path="runmodels.html"><a href="runmodels.html#rescale-outcomes"><i class="fa fa-check"></i><b>3.2.4</b> Rescale Outcomes</a></li>
<li class="chapter" data-level="3.2.5" data-path="runmodels.html"><a href="runmodels.html#bring-in-moderators-and-covariate-adjustments"><i class="fa fa-check"></i><b>3.2.5</b> Bring in Moderators and Covariate Adjustments</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="runmodels.html"><a href="runmodels.html#part-3-models"><i class="fa fa-check"></i><b>3.3</b> Part 3: Models</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="runmodels.html"><a href="runmodels.html#functions"><i class="fa fa-check"></i><b>3.3.1</b> Functions</a></li>
<li class="chapter" data-level="3.3.2" data-path="runmodels.html"><a href="runmodels.html#run-models-and-summaries"><i class="fa fa-check"></i><b>3.3.2</b> Run Models and Summaries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="compile.html"><a href="compile.html"><i class="fa fa-check"></i><b>4</b> Compile Results</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="compile.html"><a href="compile.html#tables-1"><i class="fa fa-check"></i><b>4.0.1</b> Tables</a></li>
<li class="chapter" data-level="4.0.2" data-path="compile.html"><a href="compile.html#figures"><i class="fa fa-check"></i><b>4.0.2</b> Figures</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Personality Predictors of Dementia Diagnosis and Neuropathic Burden: A Mega-Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Data Cleaning<a href="cleaning.html#cleaning" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section, we will clean the data for each study. Raw data cannot be shared directly, but for each study, we include instrucitons on how to access the data.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="cleaning.html#cb18-1" tabindex="-1"></a>Mode <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb18-2"><a href="cleaning.html#cb18-2" tabindex="-1"></a>  ux <span class="ot">&lt;-</span> <span class="fu">unique</span>(x)</span>
<span id="cb18-3"><a href="cleaning.html#cb18-3" tabindex="-1"></a>  ux <span class="ot">&lt;-</span> ux[<span class="sc">!</span><span class="fu">is.na</span>(ux)]</span>
<span id="cb18-4"><a href="cleaning.html#cb18-4" tabindex="-1"></a>  ux[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(x, ux)))]</span>
<span id="cb18-5"><a href="cleaning.html#cb18-5" tabindex="-1"></a>}</span>
<span id="cb18-6"><a href="cleaning.html#cb18-6" tabindex="-1"></a>pomp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) (x <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))<span class="sc">/</span>(<span class="fu">max</span>(x, <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))<span class="sc">*</span><span class="dv">10</span></span></code></pre></div>
<div id="health-and-retirement-study-hrs" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Health and Retirement Study (HRS)<a href="cleaning.html#health-and-retirement-study-hrs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Health and Retirement Study [HRS; <span class="citation">(<a href="#ref-juster1995overview"><strong>juster1995overview?</strong></a>)</span>] is an ongoing longitudinal study of households in the United States. These data are available at <a href="https://hrs.isr.umich.edu" class="uri">https://hrs.isr.umich.edu</a> by creating a free account.</p>
<p>Participants were recruited from more than 35,000 individuals from the financial households of individuals born between 1931 and 1941 in the US. Data have been collected biannually since 1992. The latest data release includes data up to 2016. On average, 10,000 individuals are sampled each wave More information on the HRS can be found at <a href="https://hrs.isr.umich.edu/documentation/survey-design" class="uri">https://hrs.isr.umich.edu/documentation/survey-design</a>, but, in short, the HRS is a nationally representative sample of adults over 50 in the US. It is critical to note that the HRS samples households of the original cohort and follows individuals and their spouses or partners until their death.</p>
<p>Sample size varies by year, ranging from approximately 7,500 (2014) to 15,500 (1992). (<a href="https://hrs.isr.umich.edu/sites/default/files/biblio/ResponseRates_2017.pdf" class="uri">https://hrs.isr.umich.edu/sites/default/files/biblio/ResponseRates_2017.pdf</a>). This provides 99% power to detect a zero-order correlation effect size of ~.04, two-tailed at alpha .05.</p>
<div id="load-data" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Load Data<a href="cleaning.html#load-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="cleaning.html#cb19-1" tabindex="-1"></a>hrs_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(year) {</span>
<span id="cb19-2"><a href="cleaning.html#cb19-2" tabindex="-1"></a>  read_da <span class="ot">&lt;-</span> <span class="cf">function</span>(da, dct, Year){</span>
<span id="cb19-3"><a href="cleaning.html#cb19-3" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(da, dct, year, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>))</span>
<span id="cb19-4"><a href="cleaning.html#cb19-4" tabindex="-1"></a>    data.file <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/%s/%s&quot;</span>, data_path, Year, da)</span>
<span id="cb19-5"><a href="cleaning.html#cb19-5" tabindex="-1"></a>    <span class="co"># Set path to the dictionary file &quot;*.DCT&quot;</span></span>
<span id="cb19-6"><a href="cleaning.html#cb19-6" tabindex="-1"></a>    dict.file <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/%s/%s&quot;</span>, data_path, Year, dct)</span>
<span id="cb19-7"><a href="cleaning.html#cb19-7" tabindex="-1"></a>    <span class="co"># Read the dictionary file</span></span>
<span id="cb19-8"><a href="cleaning.html#cb19-8" tabindex="-1"></a>    df.dict <span class="ot">&lt;-</span> <span class="fu">read.table</span>(dict.file, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">TRUE</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-9"><a href="cleaning.html#cb19-9" tabindex="-1"></a>    <span class="co"># Set column names for dictionary dataframe</span></span>
<span id="cb19-10"><a href="cleaning.html#cb19-10" tabindex="-1"></a>    <span class="fu">colnames</span>(df.dict) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;col.num&quot;</span>,<span class="st">&quot;col.type&quot;</span>,<span class="st">&quot;col.name&quot;</span>,<span class="st">&quot;col.width&quot;</span>,<span class="st">&quot;col.lbl&quot;</span>)</span>
<span id="cb19-11"><a href="cleaning.html#cb19-11" tabindex="-1"></a>    <span class="co"># Remove last row which only contains a closing }</span></span>
<span id="cb19-12"><a href="cleaning.html#cb19-12" tabindex="-1"></a>    row <span class="ot">&lt;-</span> <span class="fu">which</span>(df.dict<span class="sc">$</span>col.name <span class="sc">==</span> <span class="st">&quot;HHID&quot;</span>)</span>
<span id="cb19-13"><a href="cleaning.html#cb19-13" tabindex="-1"></a>    df.dict <span class="ot">&lt;-</span> df.dict[<span class="sc">-</span><span class="fu">nrow</span>(df.dict),]</span>
<span id="cb19-14"><a href="cleaning.html#cb19-14" tabindex="-1"></a>    <span class="cf">if</span>(row <span class="sc">==</span> <span class="dv">2</span>){df.dict <span class="ot">&lt;-</span> df.dict[<span class="sc">-</span><span class="dv">1</span>,]}</span>
<span id="cb19-15"><a href="cleaning.html#cb19-15" tabindex="-1"></a>    <span class="co"># Extract numeric value from column width field</span></span>
<span id="cb19-16"><a href="cleaning.html#cb19-16" tabindex="-1"></a>    df.dict<span class="sc">$</span>col.width <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">sapply</span>(df.dict<span class="sc">$</span>col.width, gsub, <span class="at">pattern =</span> <span class="st">&quot;[^0-9</span><span class="sc">\\</span><span class="st">.]&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb19-17"><a href="cleaning.html#cb19-17" tabindex="-1"></a>    <span class="co"># Convert column types to format to be used with read_fwf function</span></span>
<span id="cb19-18"><a href="cleaning.html#cb19-18" tabindex="-1"></a>    df.dict<span class="sc">$</span>col.type <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df.dict<span class="sc">$</span>col.type, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;int&quot;</span>,<span class="st">&quot;byte&quot;</span>,<span class="st">&quot;long&quot;</span>), <span class="st">&quot;i&quot;</span>, <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">&quot;float&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">&quot;double&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;c&quot;</span>))))</span>
<span id="cb19-19"><a href="cleaning.html#cb19-19" tabindex="-1"></a>    <span class="co"># Read the data file into a dataframe</span></span>
<span id="cb19-20"><a href="cleaning.html#cb19-20" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="at">file =</span> data.file, <span class="fu">fwf_widths</span>(<span class="at">widths =</span> df.dict<span class="sc">$</span>col.width, <span class="at">col_names =</span> df.dict<span class="sc">$</span>col.name), <span class="at">col_types =</span> <span class="fu">paste</span>(df.dict<span class="sc">$</span>col.type, <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb19-21"><a href="cleaning.html#cb19-21" tabindex="-1"></a>    <span class="co"># Add column labels to headers</span></span>
<span id="cb19-22"><a href="cleaning.html#cb19-22" tabindex="-1"></a>    <span class="fu">attributes</span>(df)<span class="sc">$</span>variable.labels <span class="ot">&lt;-</span> df.dict<span class="sc">$</span>col.lbl</span>
<span id="cb19-23"><a href="cleaning.html#cb19-23" tabindex="-1"></a>    old.names <span class="ot">&lt;-</span> (hrs_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> Year))<span class="sc">$</span>orig_itemname</span>
<span id="cb19-24"><a href="cleaning.html#cb19-24" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">c</span>(<span class="st">&quot;PN&quot;</span>, <span class="st">&quot;HHID&quot;</span>) <span class="sc">%in%</span> <span class="fu">colnames</span>(df)) <span class="sc">&amp;</span> <span class="fu">any</span>(old.names <span class="sc">%in%</span> <span class="fu">colnames</span>(df))){</span>
<span id="cb19-25"><a href="cleaning.html#cb19-25" tabindex="-1"></a>    <span class="co"># if(any(c(&quot;PN&quot;, &quot;HHID&quot;) %in% colnames(df))){</span></span>
<span id="cb19-26"><a href="cleaning.html#cb19-26" tabindex="-1"></a>      df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb19-27"><a href="cleaning.html#cb19-27" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">hhidpn =</span> <span class="dv">1000</span><span class="sc">*</span><span class="fu">as.numeric</span>(HHID) <span class="sc">+</span> <span class="fu">as.numeric</span>(PN)) <span class="sc">%&gt;%</span></span>
<span id="cb19-28"><a href="cleaning.html#cb19-28" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">one_of</span>(<span class="fu">c</span>(<span class="st">&quot;PN&quot;</span>, <span class="st">&quot;HHID&quot;</span>)), <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb19-29"><a href="cleaning.html#cb19-29" tabindex="-1"></a>        <span class="fu">distinct</span>()</span>
<span id="cb19-30"><a href="cleaning.html#cb19-30" tabindex="-1"></a>      <span class="co"># gather(key = item, value = value, -hhidpn)</span></span>
<span id="cb19-31"><a href="cleaning.html#cb19-31" tabindex="-1"></a>    } <span class="cf">else</span> {df <span class="ot">&lt;-</span> <span class="cn">NA</span>}</span>
<span id="cb19-32"><a href="cleaning.html#cb19-32" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb19-33"><a href="cleaning.html#cb19-33" tabindex="-1"></a>  }</span>
<span id="cb19-34"><a href="cleaning.html#cb19-34" tabindex="-1"></a>    <span class="co"># Set path to the data file &quot;*.DA&quot;</span></span>
<span id="cb19-35"><a href="cleaning.html#cb19-35" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/%s&quot;</span>, data_path, year))</span>
<span id="cb19-36"><a href="cleaning.html#cb19-36" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb19-37"><a href="cleaning.html#cb19-37" tabindex="-1"></a>    <span class="at">da =</span> files[<span class="fu">grepl</span>(<span class="st">&quot;.da&quot;</span>,  files) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;.DA&quot;</span>, files)],</span>
<span id="cb19-38"><a href="cleaning.html#cb19-38" tabindex="-1"></a>    <span class="at">dct =</span> files[<span class="fu">grepl</span>(<span class="st">&quot;.dct&quot;</span>, files) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;.DCT&quot;</span>, files)]</span>
<span id="cb19-39"><a href="cleaning.html#cb19-39" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-40"><a href="cleaning.html#cb19-40" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(da, dct, <span class="fu">possibly</span>(<span class="sc">~</span><span class="fu">read_da</span>(.x, .y, year), <span class="cn">NA_real_</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb19-41"><a href="cleaning.html#cb19-41" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(data)) <span class="sc">%&gt;%</span></span>
<span id="cb19-42"><a href="cleaning.html#cb19-42" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>da, <span class="sc">-</span>dct) </span>
<span id="cb19-43"><a href="cleaning.html#cb19-43" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(df2) <span class="sc">!=</span> <span class="dv">0</span>){df2<span class="sc">$</span>data <span class="sc">%&gt;%</span> <span class="fu">reduce</span>(full_join) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()} <span class="cf">else</span> {<span class="cn">NA</span>}</span>
<span id="cb19-44"><a href="cleaning.html#cb19-44" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="cleaning.html#cb20-1" tabindex="-1"></a>hrs_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;HRS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="cleaning.html#cb20-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_upper</span>(orig_itemname)) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="cleaning.html#cb20-3" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(orig_itemname, name, itemname), <span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">&quot;[[:space:]]&quot;</span>))</span>
<span id="cb20-4"><a href="cleaning.html#cb20-4" tabindex="-1"></a>hrs_codebook</span></code></pre></div>
<pre><code>## # A tibble: 702 × 17
##    study dataset category name  itemname  wave waveletter  year orig_itemname description scale reverse_code
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       
##  1 hrs   Rand    cogniti… cogn… digitsB…     3 &lt;NA&gt;        1996 R3BWC20       BACKWARDS … &quot;0.I… no          
##  2 hrs   Rand    cogniti… cogn… digitsB…     4 &lt;NA&gt;        1998 R4BWC20       BACKWARDS … &quot;0.I… no          
##  3 hrs   Rand    cogniti… cogn… digitsB…     5 &lt;NA&gt;        2000 R5BWC20       BACKWARDS … &quot;0.I… no          
##  4 hrs   Rand    cogniti… cogn… digitsB…     6 &lt;NA&gt;        2002 R6BWC20       BACKWARDS … &quot;0.I… no          
##  5 hrs   Rand    cogniti… cogn… digitsB…     7 &lt;NA&gt;        2004 R7BWC20       BACKWARDS … &quot;0.I… no          
##  6 hrs   Rand    cogniti… cogn… digitsB…     8 &lt;NA&gt;        2006 R8BWC20       BACKWARDS … &quot;0.I… no          
##  7 hrs   Rand    cogniti… cogn… digitsB…     9 &lt;NA&gt;        2008 R9BWC20       BACKWARDS … &quot;0.I… no          
##  8 hrs   Rand    cogniti… cogn… digitsB…    10 &lt;NA&gt;        2010 R10BWC20      BACKWARDS … &quot;0.I… no          
##  9 hrs   Rand    cogniti… cogn… digitsB…    11 &lt;NA&gt;        2012 R11BWC20      BACKWARDS … &quot;0.I… no          
## 10 hrs   Rand    cogniti… cogn… digitsB…    12 &lt;NA&gt;        2014 R12BWC20      BACKWARDS … &quot;0.I… no          
## # ℹ 692 more rows
## # ℹ 5 more variables: recode &lt;chr&gt;, mini &lt;dbl&gt;, maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="cleaning.html#cb22-1" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(hrs_codebook<span class="sc">$</span>orig_itemname)</span>
<span id="cb22-2"><a href="cleaning.html#cb22-2" tabindex="-1"></a>hrs.paq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb22-3"><a href="cleaning.html#cb22-3" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">list.files</span>(., <span class="at">pattern =</span> <span class="st">&quot;^[0-9]&quot;</span>)</span>
<span id="cb22-4"><a href="cleaning.html#cb22-4" tabindex="-1"></a>  , <span class="at">data =</span> <span class="fu">map</span>(year, hrs_read_fun)</span>
<span id="cb22-5"><a href="cleaning.html#cb22-5" tabindex="-1"></a>  , <span class="at">names =</span> <span class="fu">map</span>(data, colnames)</span>
<span id="cb22-6"><a href="cleaning.html#cb22-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="cleaning.html#cb22-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(data))</span>
<span id="cb22-8"><a href="cleaning.html#cb22-8" tabindex="-1"></a></span>
<span id="cb22-9"><a href="cleaning.html#cb22-9" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((hrs_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">&quot;Rand&quot;</span>))<span class="sc">$</span>orig_itemname)</span>
<span id="cb22-10"><a href="cleaning.html#cb22-10" tabindex="-1"></a>hrs.rand <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/randhrs1992_2016v1.sav&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb22-11"><a href="cleaning.html#cb22-11" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="cleaning.html#cb22-12" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="cleaning.html#cb22-13" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">SID =</span> HHIDPN, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="cleaning.html#cb22-14" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="at">na.rm =</span> T)</span>
<span id="cb22-15"><a href="cleaning.html#cb22-15" tabindex="-1"></a></span>
<span id="cb22-16"><a href="cleaning.html#cb22-16" tabindex="-1"></a></span>
<span id="cb22-17"><a href="cleaning.html#cb22-17" tabindex="-1"></a>hrs_long <span class="ot">&lt;-</span> hrs.paq <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="cleaning.html#cb22-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb22-19"><a href="cleaning.html#cb22-19" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>HHID, <span class="sc">-</span>PN)</span>
<span id="cb22-20"><a href="cleaning.html#cb22-20" tabindex="-1"></a>                   , <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb22-21"><a href="cleaning.html#cb22-21" tabindex="-1"></a>                   , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb22-22"><a href="cleaning.html#cb22-22" tabindex="-1"></a>                   , <span class="at">values_drop_na =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb22-23"><a href="cleaning.html#cb22-23" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>names, <span class="sc">-</span>year) <span class="sc">%&gt;%</span></span>
<span id="cb22-24"><a href="cleaning.html#cb22-24" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb22-25"><a href="cleaning.html#cb22-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SID =</span> <span class="dv">1000</span><span class="sc">*</span><span class="fu">as.numeric</span>(HHID) <span class="sc">+</span> <span class="fu">as.numeric</span>(PN)) <span class="sc">%&gt;%</span></span>
<span id="cb22-26"><a href="cleaning.html#cb22-26" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PN, <span class="sc">-</span>HHID) </span>
<span id="cb22-27"><a href="cleaning.html#cb22-27" tabindex="-1"></a></span>
<span id="cb22-28"><a href="cleaning.html#cb22-28" tabindex="-1"></a>hrs_dem <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/hrs/pdem_withvarnames.sas7bdat&quot;</span>, data_path) <span class="sc">%&gt;%</span></span>
<span id="cb22-29"><a href="cleaning.html#cb22-29" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">read_sas</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb22-30"><a href="cleaning.html#cb22-30" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">SID =</span> hhidpn, <span class="at">year =</span> prediction_year, <span class="at">value =</span> prob_dementia) <span class="sc">%&gt;%</span></span>
<span id="cb22-31"><a href="cleaning.html#cb22-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="st">&quot;PROB_DEMENTIA&quot;</span>)</span>
<span id="cb22-32"><a href="cleaning.html#cb22-32" tabindex="-1"></a></span>
<span id="cb22-33"><a href="cleaning.html#cb22-33" tabindex="-1"></a>hrs.subs <span class="ot">&lt;-</span> <span class="fu">unique</span>(hrs_long<span class="sc">$</span>SID)[<span class="fu">unique</span>(hrs_long<span class="sc">$</span>SID) <span class="sc">%in%</span> <span class="fu">unique</span>(hrs.rand<span class="sc">$</span>SID)]</span>
<span id="cb22-34"><a href="cleaning.html#cb22-34" tabindex="-1"></a>hrs_long <span class="ot">&lt;-</span> hrs_long <span class="sc">%&gt;%</span></span>
<span id="cb22-35"><a href="cleaning.html#cb22-35" tabindex="-1"></a>  <span class="fu">bind_rows</span>(hrs.rand <span class="sc">%&gt;%</span> <span class="fu">select</span>(orig_itemname, value, SID)) <span class="sc">%&gt;%</span></span>
<span id="cb22-36"><a href="cleaning.html#cb22-36" tabindex="-1"></a>  <span class="fu">filter</span>(SID <span class="sc">%in%</span> hrs.subs)</span>
<span id="cb22-37"><a href="cleaning.html#cb22-37" tabindex="-1"></a></span>
<span id="cb22-38"><a href="cleaning.html#cb22-38" tabindex="-1"></a><span class="fu">save</span>(hrs.rand, hrs.paq, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/hrs_raw.RData&quot;</span>, local_path))</span>
<span id="cb22-39"><a href="cleaning.html#cb22-39" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">c</span>(<span class="st">&quot;hrs.paq&quot;</span>, <span class="st">&quot;hrs.rand&quot;</span>))</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="cleaning.html#cb23-1" tabindex="-1"></a>hrs_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;HRS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb23-2"><a href="cleaning.html#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="cleaning.html#cb23-3" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb23-4"><a href="cleaning.html#cb23-4" tabindex="-1"></a>hrs_recode <span class="ot">&lt;-</span> hrs_codebook <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="cleaning.html#cb23-5" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;cognition&quot;</span>) <span class="sc">&amp;</span> orig_itemname <span class="sc">!=</span> <span class="st">&quot;prob_dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="cleaning.html#cb23-6" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, wave, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="cleaning.html#cb23-7" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="cleaning.html#cb23-8" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="cleaning.html#cb23-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="cleaning.html#cb23-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(hrs_long))) </span>
<span id="cb23-11"><a href="cleaning.html#cb23-11" tabindex="-1"></a></span>
<span id="cb23-12"><a href="cleaning.html#cb23-12" tabindex="-1"></a>hrs_recode <span class="ot">&lt;-</span> hrs_dem <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="cleaning.html#cb23-13" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb23-14"><a href="cleaning.html#cb23-14" tabindex="-1"></a>    hrs_codebook <span class="sc">%&gt;%</span> </span>
<span id="cb23-15"><a href="cleaning.html#cb23-15" tabindex="-1"></a>      <span class="fu">select</span>(category, name, itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule)</span>
<span id="cb23-16"><a href="cleaning.html#cb23-16" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb23-17"><a href="cleaning.html#cb23-17" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb23-18"><a href="cleaning.html#cb23-18" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-19"><a href="cleaning.html#cb23-19" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-20"><a href="cleaning.html#cb23-20" tabindex="-1"></a>  <span class="fu">bind_rows</span>(hrs_recode)</span>
<span id="cb23-21"><a href="cleaning.html#cb23-21" tabindex="-1"></a></span>
<span id="cb23-22"><a href="cleaning.html#cb23-22" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb23-23"><a href="cleaning.html#cb23-23" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year, p_year){</span>
<span id="cb23-24"><a href="cleaning.html#cb23-24" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb23-25"><a href="cleaning.html#cb23-25" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb23-26"><a href="cleaning.html#cb23-26" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb23-27"><a href="cleaning.html#cb23-27" tabindex="-1"></a>}</span>
<span id="cb23-28"><a href="cleaning.html#cb23-28" tabindex="-1"></a></span>
<span id="cb23-29"><a href="cleaning.html#cb23-29" tabindex="-1"></a>hrs_recode <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span> </span>
<span id="cb23-30"><a href="cleaning.html#cb23-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb23-31"><a href="cleaning.html#cb23-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">mapvalues</span>(year, <span class="fu">seq</span>(<span class="dv">2006</span>, <span class="dv">2016</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2006</span>, <span class="dv">2010</span>, <span class="dv">2014</span>), <span class="at">each =</span> <span class="dv">2</span>)),</span>
<span id="cb23-32"><a href="cleaning.html#cb23-32" tabindex="-1"></a>           <span class="at">p_year =</span> <span class="dv">2006</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-33"><a href="cleaning.html#cb23-33" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb23-34"><a href="cleaning.html#cb23-34" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-35"><a href="cleaning.html#cb23-35" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-36"><a href="cleaning.html#cb23-36" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year, p_year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb23-37"><a href="cleaning.html#cb23-37" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb23-38"><a href="cleaning.html#cb23-38" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb23-39"><a href="cleaning.html#cb23-39" tabindex="-1"></a></span>
<span id="cb23-40"><a href="cleaning.html#cb23-40" tabindex="-1"></a></span>
<span id="cb23-41"><a href="cleaning.html#cb23-41" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb23-42"><a href="cleaning.html#cb23-42" tabindex="-1"></a>hrs_recode <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb23-43"><a href="cleaning.html#cb23-43" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb23-44"><a href="cleaning.html#cb23-44" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb23-45"><a href="cleaning.html#cb23-45" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb23-46"><a href="cleaning.html#cb23-46" tabindex="-1"></a></span>
<span id="cb23-47"><a href="cleaning.html#cb23-47" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb23-48"><a href="cleaning.html#cb23-48" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb23-49"><a href="cleaning.html#cb23-49" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb23-50"><a href="cleaning.html#cb23-50" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb23-51"><a href="cleaning.html#cb23-51" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb23-52"><a href="cleaning.html#cb23-52" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb23-53"><a href="cleaning.html#cb23-53" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb23-54"><a href="cleaning.html#cb23-54" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb23-55"><a href="cleaning.html#cb23-55" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb23-56"><a href="cleaning.html#cb23-56" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Covariates<a href="cleaning.html#covariates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="cleaning.html#cb24-1" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb24-2"><a href="cleaning.html#cb24-2" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb24-3"><a href="cleaning.html#cb24-3" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="cleaning.html#cb24-4" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb24-5"><a href="cleaning.html#cb24-5" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year, p_year, long_rule) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="cleaning.html#cb24-6" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="cleaning.html#cb24-7" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="cleaning.html#cb24-8" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb24-9"><a href="cleaning.html#cb24-9" tabindex="-1"></a>}</span>
<span id="cb24-10"><a href="cleaning.html#cb24-10" tabindex="-1"></a></span>
<span id="cb24-11"><a href="cleaning.html#cb24-11" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb24-12"><a href="cleaning.html#cb24-12" tabindex="-1"></a>hrs_cov <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="cleaning.html#cb24-13" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="cleaning.html#cb24-14" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="cleaning.html#cb24-15" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="cleaning.html#cb24-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="cleaning.html#cb24-17" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="cleaning.html#cb24-18" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-19"><a href="cleaning.html#cb24-19" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="cleaning.html#cb24-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb24-21"><a href="cleaning.html#cb24-21" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb24-22"><a href="cleaning.html#cb24-22" tabindex="-1"></a></span>
<span id="cb24-23"><a href="cleaning.html#cb24-23" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule, p_year){</span>
<span id="cb24-24"><a href="cleaning.html#cb24-24" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb24-25"><a href="cleaning.html#cb24-25" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb24-26"><a href="cleaning.html#cb24-26" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb24-27"><a href="cleaning.html#cb24-27" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb24-28"><a href="cleaning.html#cb24-28" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-29"><a href="cleaning.html#cb24-29" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb24-30"><a href="cleaning.html#cb24-30" tabindex="-1"></a>}</span>
<span id="cb24-31"><a href="cleaning.html#cb24-31" tabindex="-1"></a></span>
<span id="cb24-32"><a href="cleaning.html#cb24-32" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb24-33"><a href="cleaning.html#cb24-33" tabindex="-1"></a>hrs_cov <span class="ot">&lt;-</span> hrs_cov <span class="sc">%&gt;%</span></span>
<span id="cb24-34"><a href="cleaning.html#cb24-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb24-35"><a href="cleaning.html#cb24-35" tabindex="-1"></a>  <span class="fu">group_by</span>(p_year, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb24-36"><a href="cleaning.html#cb24-36" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-37"><a href="cleaning.html#cb24-37" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-38"><a href="cleaning.html#cb24-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule, p_year), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb24-39"><a href="cleaning.html#cb24-39" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb24-40"><a href="cleaning.html#cb24-40" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb24-41"><a href="cleaning.html#cb24-41" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb24-42"><a href="cleaning.html#cb24-42" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb24-43"><a href="cleaning.html#cb24-43" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="cleaning.html#cb25-1" tabindex="-1"></a>hrs_cov</span></code></pre></div>
<pre><code>## # A tibble: 28,726 × 19
##    p_year      SID alcohol   BMI cancer diabetes education exercise gender heartProb height married  race
##     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1   2006     3010       1  28.8      0        0        12     2.02      0         1   165.       1     0
##  2   2006     3020       1  28.8      1        0        16     1.77      1         0   165.       1     0
##  3   2006 10001010       0  23.5      0        0        12     1.88      0         0   183.       0     0
##  4   2006 10003030       0  28.5      0        0        16     1.25      1         1   157.       1     0
##  5   2006 10004010       1  27.0      1        0        16     1.75      0         0   185.       1     0
##  6   2006 10004040       1  27.0      0        0        12     2         1         0   165.       1     0
##  7   2006 10013010       0  28.2      0        1        12     1.57      0         1   177.       1     0
##  8   2006 10013040       1  24.5      0        0        13     1.5       1         0   160.       1     0
##  9   2006 10038010       1  23.3      0        0        16     1.75      0         1   177.       1     0
## 10   2006 10038040       1  23.3      0        0        16     1.78      1         0   170.       1     0
## # ℹ 28,716 more rows
## # ℹ 6 more variables: respDis &lt;dbl&gt;, smokes &lt;dbl&gt;, SRhealth &lt;dbl&gt;, stroke &lt;dbl&gt;, weight &lt;dbl&gt;,
## #   yearBrth &lt;dbl&gt;</code></pre>
</div>
<div id="personality-variables" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Personality Variables<a href="cleaning.html#personality-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="cleaning.html#cb27-1" tabindex="-1"></a>hrs_pers <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="cleaning.html#cb27-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="cleaning.html#cb27-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="cleaning.html#cb27-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="cleaning.html#cb27-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">&quot;2006&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb27-6"><a href="cleaning.html#cb27-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, year, name, itemname, comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="cleaning.html#cb27-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="cleaning.html#cb27-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb27-9"><a href="cleaning.html#cb27-9" tabindex="-1"></a></span>
<span id="cb27-10"><a href="cleaning.html#cb27-10" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb27-11"><a href="cleaning.html#cb27-11" tabindex="-1"></a>hrs_alpha <span class="ot">&lt;-</span> hrs_pers <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="cleaning.html#cb27-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="cleaning.html#cb27-13" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb27-14"><a href="cleaning.html#cb27-14" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb27-15"><a href="cleaning.html#cb27-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-16"><a href="cleaning.html#cb27-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(mean))),</span>
<span id="cb27-17"><a href="cleaning.html#cb27-17" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb27-18"><a href="cleaning.html#cb27-18" tabindex="-1"></a></span>
<span id="cb27-19"><a href="cleaning.html#cb27-19" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb27-20"><a href="cleaning.html#cb27-20" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb27-21"><a href="cleaning.html#cb27-21" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb27-22"><a href="cleaning.html#cb27-22" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb27-23"><a href="cleaning.html#cb27-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-24"><a href="cleaning.html#cb27-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb27-25"><a href="cleaning.html#cb27-25" tabindex="-1"></a>}</span>
<span id="cb27-26"><a href="cleaning.html#cb27-26" tabindex="-1"></a></span>
<span id="cb27-27"><a href="cleaning.html#cb27-27" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb27-28"><a href="cleaning.html#cb27-28" tabindex="-1"></a>hrs_pers <span class="ot">&lt;-</span> hrs_pers <span class="sc">%&gt;%</span></span>
<span id="cb27-29"><a href="cleaning.html#cb27-29" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb27-30"><a href="cleaning.html#cb27-30" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-31"><a href="cleaning.html#cb27-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-32"><a href="cleaning.html#cb27-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb27-33"><a href="cleaning.html#cb27-33" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb27-34"><a href="cleaning.html#cb27-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="cleaning.html#cb28-1" tabindex="-1"></a>hrs_pers</span></code></pre></div>
<pre><code>## # A tibble: 116,915 × 4
##     year name       SID value
##    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2006 A         3010   3  
##  2  2006 A         3020   3  
##  3  2006 A     10001010   4  
##  4  2006 A     10003030   3.4
##  5  2006 A     10004010   3.4
##  6  2006 A     10004040   3.6
##  7  2006 A     10013010   2  
##  8  2006 A     10013040   2.6
##  9  2006 A     10038010   3.4
## 10  2006 A     10038040   2.6
## # ℹ 116,905 more rows</code></pre>
</div>
<div id="cognition-variables" class="section level3 hasAnchor" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Cognition Variables<a href="cleaning.html#cognition-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="cleaning.html#cb30-1" tabindex="-1"></a>hrs_cog <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="cleaning.html#cb30-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="cleaning.html#cb30-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="cleaning.html#cb30-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="cleaning.html#cb30-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="cleaning.html#cb30-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="cleaning.html#cb30-7" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, year) <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="cleaning.html#cb30-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="cleaning.html#cb30-9" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb30-10"><a href="cleaning.html#cb30-10" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb30-11"><a href="cleaning.html#cb30-11" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-12"><a href="cleaning.html#cb30-12" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="cleaning.html#cb31-1" tabindex="-1"></a>hrs_cog</span></code></pre></div>
<pre><code>## # A tibble: 16,778 × 2
##         SID cognition
##       &lt;dbl&gt;     &lt;dbl&gt;
##  1     3010      7.5 
##  2     3020      8.08
##  3 10001010      8.75
##  4 10003030      6   
##  5 10004010      7.92
##  6 10004040      8.83
##  7 10013010      7.25
##  8 10013040      8.67
##  9 10038010      8.58
## 10 10038040      8.25
## # ℹ 16,768 more rows</code></pre>
</div>
<div id="outcome-variables" class="section level3 hasAnchor" number="2.1.6">
<h3><span class="header-section-number">2.1.6</span> Outcome Variables<a href="cleaning.html#outcome-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="cleaning.html#cb33-1" tabindex="-1"></a><span class="co"># composite within years </span></span>
<span id="cb33-2"><a href="cleaning.html#cb33-2" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb33-3"><a href="cleaning.html#cb33-3" tabindex="-1"></a>hrs_out <span class="ot">&lt;-</span> hrs_recode <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="cleaning.html#cb33-4" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="cleaning.html#cb33-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="cleaning.html#cb33-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, year, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="cleaning.html#cb33-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="cleaning.html#cb33-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="cleaning.html#cb33-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value),</span>
<span id="cb33-10"><a href="cleaning.html#cb33-10" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">ifelse</span>(year <span class="sc">&gt;</span> p_year, <span class="st">&quot;future&quot;</span>, <span class="st">&quot;past&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="cleaning.html#cb33-11" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="cleaning.html#cb33-12" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, year, name, group) <span class="sc">%&gt;%</span></span>
<span id="cb33-13"><a href="cleaning.html#cb33-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> .<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb33-14"><a href="cleaning.html#cb33-14" tabindex="-1"></a>         , <span class="at">o_year =</span> <span class="fu">max</span>(year[<span class="sc">!</span><span class="fu">is.na</span>(value)])) <span class="sc">%&gt;%</span></span>
<span id="cb33-15"><a href="cleaning.html#cb33-15" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, name, group, o_year) <span class="sc">%&gt;%</span></span>
<span id="cb33-16"><a href="cleaning.html#cb33-16" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb33-17"><a href="cleaning.html#cb33-17" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-18"><a href="cleaning.html#cb33-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb33-19"><a href="cleaning.html#cb33-19" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="cleaning.html#cb33-20" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, o_year) <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="cleaning.html#cb33-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(past) <span class="sc">|</span> (past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(future)), future,</span>
<span id="cb33-22"><a href="cleaning.html#cb33-22" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(future), past, </span>
<span id="cb33-23"><a href="cleaning.html#cb33-23" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb33-24"><a href="cleaning.html#cb33-24" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, name) <span class="sc">%&gt;%</span> </span>
<span id="cb33-25"><a href="cleaning.html#cb33-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">o_year =</span> <span class="fu">max</span>(o_year)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-26"><a href="cleaning.html#cb33-26" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, o_year, name) <span class="sc">%&gt;%</span> </span>
<span id="cb33-27"><a href="cleaning.html#cb33-27" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb33-28"><a href="cleaning.html#cb33-28" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-29"><a href="cleaning.html#cb33-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb33-30"><a href="cleaning.html#cb33-30" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="cleaning.html#cb34-1" tabindex="-1"></a>hrs_out</span></code></pre></div>
<pre><code>## # A tibble: 27,187 × 5
##         SID p_year o_year name     value
##       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1     3010   2006   2010 dementia     1
##  2     3020   2006   2014 dementia     0
##  3 10001010   2006   2014 dementia     0
##  4 10003030   2006   2014 dementia     0
##  5 10004010   2006   2010 dementia     0
##  6 10004040   2006   2014 dementia     0
##  7 10013010   2006   2014 dementia     1
##  8 10013040   2006   2014 dementia     0
##  9 10038010   2006   2014 dementia     0
## 10 10038040   2006   2014 dementia     0
## # ℹ 27,177 more rows</code></pre>
</div>
<div id="combine-data" class="section level3 hasAnchor" number="2.1.7">
<h3><span class="header-section-number">2.1.7</span> Combine Data<a href="cleaning.html#combine-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="cleaning.html#cb36-1" tabindex="-1"></a>hrs_combined <span class="ot">&lt;-</span> hrs_pers <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="cleaning.html#cb36-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="cleaning.html#cb36-3" tabindex="-1"></a>  <span class="fu">full_join</span>(hrs_out <span class="sc">%&gt;%</span> <span class="fu">select</span>(SID, <span class="at">Outcome =</span> name, <span class="at">o_value =</span> value, o_year)) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="cleaning.html#cb36-4" tabindex="-1"></a>  <span class="fu">full_join</span>(hrs_cov) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="cleaning.html#cb36-5" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb36-6"><a href="cleaning.html#cb36-6" tabindex="-1"></a>    hrs_out <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="cleaning.html#cb36-7" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="cleaning.html#cb36-8" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb36-9"><a href="cleaning.html#cb36-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="cleaning.html#cb36-10" tabindex="-1"></a>  <span class="fu">full_join</span>(hrs_cog) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="cleaning.html#cb36-11" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value)) <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="cleaning.html#cb36-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> p_year <span class="sc">-</span> yearBrth)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="cleaning.html#cb37-1" tabindex="-1"></a>hrs_combined</span></code></pre></div>
<pre><code>## # A tibble: 112,097 × 27
##    p_year Trait      SID p_value Outcome  o_value o_year alcohol   BMI cancer diabetes education exercise
##     &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1   2006 A         3010     3   dementia       1   2010       1  28.8      0        0        12     2.02
##  2   2006 A         3020     3   dementia       0   2014       1  28.8      1        0        16     1.77
##  3   2006 A     10001010     4   dementia       0   2014       0  23.5      0        0        12     1.88
##  4   2006 A     10003030     3.4 dementia       0   2014       0  28.5      0        0        16     1.25
##  5   2006 A     10004010     3.4 dementia       0   2010       1  27.0      1        0        16     1.75
##  6   2006 A     10004040     3.6 dementia       0   2014       1  27.0      0        0        12     2   
##  7   2006 A     10013010     2   dementia       1   2014       0  28.2      0        1        12     1.57
##  8   2006 A     10013040     2.6 dementia       0   2014       1  24.5      0        0        13     1.5 
##  9   2006 A     10038010     3.4 dementia       0   2014       1  23.3      0        0        16     1.75
## 10   2006 A     10038040     2.6 dementia       0   2014       1  23.3      0        0        16     1.78
## # ℹ 112,087 more rows
## # ℹ 14 more variables: gender &lt;dbl&gt;, heartProb &lt;dbl&gt;, height &lt;dbl&gt;, married &lt;dbl&gt;, race &lt;dbl&gt;,
## #   respDis &lt;dbl&gt;, smokes &lt;dbl&gt;, SRhealth &lt;dbl&gt;, stroke &lt;dbl&gt;, weight &lt;dbl&gt;, yearBrth &lt;dbl&gt;,
## #   dementia &lt;dbl&gt;, cognition &lt;dbl&gt;, age &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="cleaning.html#cb39-1" tabindex="-1"></a><span class="fu">save</span>(hrs_cov, hrs_alpha, hrs_pers, hrs_out, hrs_combined, hrs_cog,</span>
<span id="cb39-2"><a href="cleaning.html#cb39-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/hrs_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="cleaning.html#cb40-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;hrs&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="rush-memory-and-and-aging-project-rush-map" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> RUSH Memory and and Aging Project (RUSH-MAP)<a href="cleaning.html#rush-memory-and-and-aging-project-rush-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The RUSH Memory and Aging Project (RUSH-MAP) is an ongoing longitudinal study that began in 1997 <span class="citation">(<a href="#ref-a2012overview"><strong>a2012overview?</strong></a>)</span>. These data are available, through application from <a href="https://www.radc.rush.edu/requests.htm" class="uri">https://www.radc.rush.edu/requests.htm</a>.</p>
<p>Participants who were 65 and older were recruited from retirement communities and subsidized senior housing facilities throughout Chicagoland and northeastern Illinois beginning in 1997. Data are collected annually, and all participants are organ donors. Additional participants are recuited each year. Additional information and documentation on the data can be found at <a href="https://www.radc.rush.edu/docs/var/variables.htm" class="uri">https://www.radc.rush.edu/docs/var/variables.htm</a>.</p>
<p>Sample sizes vary by year, ranging from 52 (1997) to 2205 participants including 884 deceased participants with autopsy data (2019, 2020). This provides 99% power to detect a zero-order correlation effect size of ~.10, two-tailed at alpha .05.</p>
<div id="load-data-1" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Load Data<a href="cleaning.html#load-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="cleaning.html#cb41-1" tabindex="-1"></a>(map_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;RADC-MAP&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="cleaning.html#cb41-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)))</span></code></pre></div>
<pre><code>## # A tibble: 44 × 15
##    study    dataset category  name  itemname year  orig_itemname description scale reverse_code recode  mini
##    &lt;chr&gt;    &lt;lgl&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 RADC-MAP NA      cognition cogn… freeRec… long… cts_wlii      word list …  &lt;NA&gt; no           ifels…    NA
##  2 RADC-MAP NA      cognition cogn… cuedRec… long… cts_wliii     word list …  &lt;NA&gt; no           ifels…    NA
##  3 RADC-MAP NA      cognition cogn… digitsF… long… cts_df        digits bac…  &lt;NA&gt; no           ifels…    NA
##  4 RADC-MAP NA      cognition cogn… digitsB… long… cts_db        digits for…  &lt;NA&gt; no           ifels…    NA
##  5 RADC-MAP NA      cognition cogn… catFlue… long… cts_catflu    category f…  &lt;NA&gt; no           ifels…    NA
##  6 RADC-MAP NA      cognition cogn… bosNami… long… cts_bname     Boston nam…  &lt;NA&gt; no           ifels…    NA
##  7 RADC-MAP NA      cognition cogn… progMat  long… cts_pmat      progressiv…  &lt;NA&gt; no           ifels…    NA
##  8 RADC-MAP NA      cognition cogn… digitSy… long… cts_sdmt      symbol dig…  &lt;NA&gt; no           ifels…    NA
##  9 RADC-MAP NA      covariat… age   ageBase… base… age_bl        The age at…  &lt;NA&gt; no           ifels…    NA
## 10 RADC-MAP NA      covariat… alco… alcohol  base… alcohol_g_bl  Grams of a… &quot;\r\… no           ifels…    NA
## # ℹ 34 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="cleaning.html#cb43-1" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1033_long_03-24-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="cleaning.html#cb43-2" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1033_basic_03-24-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="cleaning.html#cb43-3" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_long_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="cleaning.html#cb43-4" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_basic_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="cleaning.html#cb43-5" tabindex="-1"></a>  <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;MAP&quot;</span>)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-1" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="cleaning.html#cb44-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb44-2"><a href="cleaning.html#cb44-2" tabindex="-1"></a>  <span class="fu">print</span>(var)</span>
<span id="cb44-3"><a href="cleaning.html#cb44-3" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((map_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb44-4"><a href="cleaning.html#cb44-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> map <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="cleaning.html#cb44-5" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> projid, <span class="at">wave =</span> fu_year, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="cleaning.html#cb44-6" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="sc">-</span>wave, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb44-7"><a href="cleaning.html#cb44-7" tabindex="-1"></a>    <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb44-8"><a href="cleaning.html#cb44-8" tabindex="-1"></a>}</span>
<span id="cb44-9"><a href="cleaning.html#cb44-9" tabindex="-1"></a></span>
<span id="cb44-10"><a href="cleaning.html#cb44-10" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb44-11"><a href="cleaning.html#cb44-11" tabindex="-1"></a>map_recode <span class="ot">&lt;-</span> map_codebook <span class="sc">%&gt;%</span></span>
<span id="cb44-12"><a href="cleaning.html#cb44-12" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb44-13"><a href="cleaning.html#cb44-13" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;cognition&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb44-14"><a href="cleaning.html#cb44-14" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb44-15"><a href="cleaning.html#cb44-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-16"><a href="cleaning.html#cb44-16" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-17"><a href="cleaning.html#cb44-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, name, rename_fun))</span>
<span id="cb44-18"><a href="cleaning.html#cb44-18" tabindex="-1"></a></span>
<span id="cb44-19"><a href="cleaning.html#cb44-19" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb44-20"><a href="cleaning.html#cb44-20" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb44-21"><a href="cleaning.html#cb44-21" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb44-22"><a href="cleaning.html#cb44-22" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb44-23"><a href="cleaning.html#cb44-23" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb44-24"><a href="cleaning.html#cb44-24" tabindex="-1"></a>}</span>
<span id="cb44-25"><a href="cleaning.html#cb44-25" tabindex="-1"></a></span>
<span id="cb44-26"><a href="cleaning.html#cb44-26" tabindex="-1"></a>map_recode <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span> </span>
<span id="cb44-27"><a href="cleaning.html#cb44-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb44-28"><a href="cleaning.html#cb44-28" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">as.numeric</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb44-29"><a href="cleaning.html#cb44-29" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, wave) <span class="sc">%&gt;%</span></span>
<span id="cb44-30"><a href="cleaning.html#cb44-30" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-31"><a href="cleaning.html#cb44-31" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-32"><a href="cleaning.html#cb44-32" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, wave), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb44-33"><a href="cleaning.html#cb44-33" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb44-34"><a href="cleaning.html#cb44-34" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb44-35"><a href="cleaning.html#cb44-35" tabindex="-1"></a></span>
<span id="cb44-36"><a href="cleaning.html#cb44-36" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb44-37"><a href="cleaning.html#cb44-37" tabindex="-1"></a>map_recode <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb44-38"><a href="cleaning.html#cb44-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb44-39"><a href="cleaning.html#cb44-39" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), </span>
<span id="cb44-40"><a href="cleaning.html#cb44-40" tabindex="-1"></a>           <span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb44-41"><a href="cleaning.html#cb44-41" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb44-42"><a href="cleaning.html#cb44-42" tabindex="-1"></a></span>
<span id="cb44-43"><a href="cleaning.html#cb44-43" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb44-44"><a href="cleaning.html#cb44-44" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb44-45"><a href="cleaning.html#cb44-45" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb44-46"><a href="cleaning.html#cb44-46" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb44-47"><a href="cleaning.html#cb44-47" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb44-48"><a href="cleaning.html#cb44-48" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb44-49"><a href="cleaning.html#cb44-49" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb44-50"><a href="cleaning.html#cb44-50" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb44-51"><a href="cleaning.html#cb44-51" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb44-52"><a href="cleaning.html#cb44-52" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="covariates-1" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Covariates<a href="cleaning.html#covariates-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="cleaning.html#cb45-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb45-2"><a href="cleaning.html#cb45-2" tabindex="-1"></a>map_cov <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="cleaning.html#cb45-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="cleaning.html#cb45-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="cleaning.html#cb45-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="cleaning.html#cb45-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb45-7"><a href="cleaning.html#cb45-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb45-8"><a href="cleaning.html#cb45-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, wave, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb45-9"><a href="cleaning.html#cb45-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-10"><a href="cleaning.html#cb45-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-11"><a href="cleaning.html#cb45-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb45-12"><a href="cleaning.html#cb45-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb45-13"><a href="cleaning.html#cb45-13" tabindex="-1"></a>      <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb45-14"><a href="cleaning.html#cb45-14" tabindex="-1"></a>      ))</span>
<span id="cb45-15"><a href="cleaning.html#cb45-15" tabindex="-1"></a></span>
<span id="cb45-16"><a href="cleaning.html#cb45-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb45-17"><a href="cleaning.html#cb45-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb45-18"><a href="cleaning.html#cb45-18" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb45-19"><a href="cleaning.html#cb45-19" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb45-20"><a href="cleaning.html#cb45-20" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-21"><a href="cleaning.html#cb45-21" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb45-22"><a href="cleaning.html#cb45-22" tabindex="-1"></a>}</span>
<span id="cb45-23"><a href="cleaning.html#cb45-23" tabindex="-1"></a></span>
<span id="cb45-24"><a href="cleaning.html#cb45-24" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb45-25"><a href="cleaning.html#cb45-25" tabindex="-1"></a>map_cov <span class="ot">&lt;-</span> map_cov <span class="sc">%&gt;%</span></span>
<span id="cb45-26"><a href="cleaning.html#cb45-26" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb45-27"><a href="cleaning.html#cb45-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb45-28"><a href="cleaning.html#cb45-28" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb45-29"><a href="cleaning.html#cb45-29" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-30"><a href="cleaning.html#cb45-30" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-31"><a href="cleaning.html#cb45-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb45-32"><a href="cleaning.html#cb45-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb45-33"><a href="cleaning.html#cb45-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb45-34"><a href="cleaning.html#cb45-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb45-35"><a href="cleaning.html#cb45-35" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb45-36"><a href="cleaning.html#cb45-36" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="cleaning.html#cb46-1" tabindex="-1"></a>map_cov</span></code></pre></div>
<pre><code>## # A tibble: 2,192 × 16
##    SID        age alcohol   BMI cancer diabetes education exercise gender heartProb married  mmse parkinsons
##    &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1 00009121  80.0       1  26.8      0        0        12        1      0         0       1    29          0
##  2 00033027  81.0       0  32.6      0        1        14        0      0         0       1    29          0
##  3 00045071  87.5       1  28.2      0        1        16        1      1         1       1    18          0
##  4 00130005  89.8       0  27.8      0        0        15        1      0         1       1    29          0
##  5 00204228  65.2       0  36.6      0        1         8        1      1         0       1    27          0
##  6 00228190  73.5       1  23.0      1        0        22        1      0         0       1    29          0
##  7 00246264  90.0       0  24.0      0        0        16        1      0         0       1    27          0
##  8 00285563  84.7       0  27.0      0        0        12        1      0         0       1    28          0
##  9 00402800  78.7       0  17.2      0        0        16        1      0         0       1    17          0
## 10 00482428  81.4       1  NA        1        0        12        1      0         0       1    30          0
## # ℹ 2,182 more rows
## # ℹ 3 more variables: race &lt;dbl&gt;, smokes &lt;dbl&gt;, stroke &lt;dbl&gt;</code></pre>
</div>
<div id="personality-variables-1" class="section level3 hasAnchor" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Personality Variables<a href="cleaning.html#personality-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="cleaning.html#cb48-1" tabindex="-1"></a>map_pers <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="cleaning.html#cb48-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="cleaning.html#cb48-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="cleaning.html#cb48-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb48-5"><a href="cleaning.html#cb48-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="cleaning.html#cb48-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="cleaning.html#cb48-7" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="fu">min</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="cleaning.html#cb48-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="cleaning.html#cb48-9" tabindex="-1"></a>  <span class="fu">select</span>(SID, name, wave, value)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="cleaning.html#cb49-1" tabindex="-1"></a>map_pers</span></code></pre></div>
<pre><code>## # A tibble: 9,115 × 4
##    SID      name   wave value
##    &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 00009121 C         0    35
##  2 00045071 C         0    38
##  3 00130005 C         0    31
##  4 00246264 C         0    33
##  5 00402800 C         0    24
##  6 00582981 C         0    37
##  7 00617643 C         0    34
##  8 00696418 C         0    27
##  9 00701662 C         0    31
## 10 00709354 C         0    40
## # ℹ 9,105 more rows</code></pre>
</div>
<div id="outcome-variables-1" class="section level3 hasAnchor" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="cleaning.html#cb51-1" tabindex="-1"></a>map_out_waves <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="cleaning.html#cb51-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="cleaning.html#cb51-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="cleaning.html#cb51-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="cleaning.html#cb51-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="cleaning.html#cb51-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb51-7"><a href="cleaning.html#cb51-7" tabindex="-1"></a></span>
<span id="cb51-8"><a href="cleaning.html#cb51-8" tabindex="-1"></a>map_out <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb51-9"><a href="cleaning.html#cb51-9" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="cleaning.html#cb51-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb51-11"><a href="cleaning.html#cb51-11" tabindex="-1"></a>  <span class="fu">unnest</span>(data) </span>
<span id="cb51-12"><a href="cleaning.html#cb51-12" tabindex="-1"></a></span>
<span id="cb51-13"><a href="cleaning.html#cb51-13" tabindex="-1"></a>map_dem <span class="ot">&lt;-</span> map_out <span class="sc">%&gt;%</span> </span>
<span id="cb51-14"><a href="cleaning.html#cb51-14" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-15"><a href="cleaning.html#cb51-15" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, wave) <span class="sc">%&gt;%</span></span>
<span id="cb51-16"><a href="cleaning.html#cb51-16" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb51-17"><a href="cleaning.html#cb51-17" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-18"><a href="cleaning.html#cb51-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value),</span>
<span id="cb51-19"><a href="cleaning.html#cb51-19" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">ifelse</span>(wave <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;future&quot;</span>, <span class="st">&quot;past&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb51-20"><a href="cleaning.html#cb51-20" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, group) <span class="sc">%&gt;%</span></span>
<span id="cb51-21"><a href="cleaning.html#cb51-21" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb51-22"><a href="cleaning.html#cb51-22" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-23"><a href="cleaning.html#cb51-23" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb51-24"><a href="cleaning.html#cb51-24" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb51-25"><a href="cleaning.html#cb51-25" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb51-26"><a href="cleaning.html#cb51-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(past) <span class="sc">|</span> (past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(future)), future,</span>
<span id="cb51-27"><a href="cleaning.html#cb51-27" tabindex="-1"></a>                   <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(future), past, </span>
<span id="cb51-28"><a href="cleaning.html#cb51-28" tabindex="-1"></a>                   <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb51-29"><a href="cleaning.html#cb51-29" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb51-30"><a href="cleaning.html#cb51-30" tabindex="-1"></a></span>
<span id="cb51-31"><a href="cleaning.html#cb51-31" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb51-32"><a href="cleaning.html#cb51-32" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb51-33"><a href="cleaning.html#cb51-33" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb51-34"><a href="cleaning.html#cb51-34" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb51-35"><a href="cleaning.html#cb51-35" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-36"><a href="cleaning.html#cb51-36" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb51-37"><a href="cleaning.html#cb51-37" tabindex="-1"></a>}</span>
<span id="cb51-38"><a href="cleaning.html#cb51-38" tabindex="-1"></a></span>
<span id="cb51-39"><a href="cleaning.html#cb51-39" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb51-40"><a href="cleaning.html#cb51-40" tabindex="-1"></a>map_out <span class="ot">&lt;-</span> map_out <span class="sc">%&gt;%</span></span>
<span id="cb51-41"><a href="cleaning.html#cb51-41" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> name <span class="sc">!=</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-42"><a href="cleaning.html#cb51-42" tabindex="-1"></a>  <span class="fu">group_by</span>(name, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb51-43"><a href="cleaning.html#cb51-43" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-44"><a href="cleaning.html#cb51-44" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-45"><a href="cleaning.html#cb51-45" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, long_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb51-46"><a href="cleaning.html#cb51-46" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb51-47"><a href="cleaning.html#cb51-47" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb51-48"><a href="cleaning.html#cb51-48" tabindex="-1"></a>  <span class="fu">full_join</span>(map_dem) <span class="sc">%&gt;%</span></span>
<span id="cb51-49"><a href="cleaning.html#cb51-49" tabindex="-1"></a>  <span class="fu">left_join</span>(map_out_waves)</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="cleaning.html#cb52-1" tabindex="-1"></a>map_out</span></code></pre></div>
<pre><code>## # A tibble: 11,128 × 6
##    name        SID      value future  past o_year
##    &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 ageDementia 00045071  88.5     NA    NA      1
##  2 ageDementia 00285563  90.5     NA    NA     13
##  3 ageDementia 00668310  88.6     NA    NA      5
##  4 ageDementia 01243685  89.7     NA    NA      3
##  5 ageDementia 01797756  86.4     NA    NA     11
##  6 ageDementia 02108769  90.9     NA    NA      8
##  7 ageDementia 03227207  97.8     NA    NA     17
##  8 ageDementia 03380931  85.7     NA    NA      7
##  9 ageDementia 03806878  92.4     NA    NA      5
## 10 ageDementia 04330337 101.      NA    NA     15
## # ℹ 11,118 more rows</code></pre>
</div>
<div id="cognition-variables-1" class="section level3 hasAnchor" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Cognition Variables<a href="cleaning.html#cognition-variables-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="cleaning.html#cb54-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb54-2"><a href="cleaning.html#cb54-2" tabindex="-1"></a>map_cog <span class="ot">&lt;-</span> map_recode <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="cleaning.html#cb54-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="cleaning.html#cb54-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="cleaning.html#cb54-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="cleaning.html#cb54-6" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-7"><a href="cleaning.html#cb54-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb54-8"><a href="cleaning.html#cb54-8" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, wave) <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="cleaning.html#cb54-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb54-10"><a href="cleaning.html#cb54-10" tabindex="-1"></a>  <span class="fu">group_by</span>(name, SID) <span class="sc">%&gt;%</span></span>
<span id="cb54-11"><a href="cleaning.html#cb54-11" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb54-12"><a href="cleaning.html#cb54-12" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-13"><a href="cleaning.html#cb54-13" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb54-14"><a href="cleaning.html#cb54-14" tabindex="-1"></a>              , <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="cleaning.html#cb55-1" tabindex="-1"></a>map_cog</span></code></pre></div>
<pre><code>## # A tibble: 2,189 × 2
##    SID      cognition
##    &lt;chr&gt;        &lt;dbl&gt;
##  1 00009121      7.55
##  2 00033027      6.17
##  3 00045071      4.84
##  4 00130005      6.59
##  5 00204228      5.81
##  6 00228190      7.38
##  7 00246264      6.16
##  8 00285563      5.79
##  9 00402800      4.14
## 10 00482428      6.58
## # ℹ 2,179 more rows</code></pre>
</div>
<div id="combine-data-1" class="section level3 hasAnchor" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> Combine Data<a href="cleaning.html#combine-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="cleaning.html#cb57-1" tabindex="-1"></a>map_combined <span class="ot">&lt;-</span> map_pers <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="cleaning.html#cb57-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> wave) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="cleaning.html#cb57-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb57-4"><a href="cleaning.html#cb57-4" tabindex="-1"></a>    map_out <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="cleaning.html#cb57-5" tabindex="-1"></a>      <span class="fu">select</span>(<span class="at">Outcome =</span> name, SID, <span class="at">o_value =</span> value, o_year)</span>
<span id="cb57-6"><a href="cleaning.html#cb57-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb57-7"><a href="cleaning.html#cb57-7" tabindex="-1"></a>  <span class="fu">full_join</span>(map_cov) <span class="sc">%&gt;%</span></span>
<span id="cb57-8"><a href="cleaning.html#cb57-8" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb57-9"><a href="cleaning.html#cb57-9" tabindex="-1"></a>    map_out <span class="sc">%&gt;%</span></span>
<span id="cb57-10"><a href="cleaning.html#cb57-10" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-11"><a href="cleaning.html#cb57-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">rowSums</span>(<span class="fu">cbind</span>(future, past), <span class="at">na.rm =</span> T) <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-12"><a href="cleaning.html#cb57-12" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>future, <span class="sc">-</span>past) <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="cleaning.html#cb57-13" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb57-14"><a href="cleaning.html#cb57-14" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb57-15"><a href="cleaning.html#cb57-15" tabindex="-1"></a>  <span class="fu">full_join</span>(map_cog) <span class="sc">%&gt;%</span></span>
<span id="cb57-16"><a href="cleaning.html#cb57-16" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="cleaning.html#cb58-1" tabindex="-1"></a>map_combined</span></code></pre></div>
<pre><code>## # A tibble: 42,999 × 24
##    SID    Trait p_year p_value Outcome o_value o_year   age alcohol   BMI cancer diabetes education exercise
##    &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 00009… C          0      35 dement…     0       10  80.0       1  26.8      0        0        12        1
##  2 00045… C          0      38 ageDem…    88.5      1  87.5       1  28.2      0        1        16        1
##  3 00045… C          0      38 dement…     1        1  87.5       1  28.2      0        1        16        1
##  4 00130… C          0      31 dement…     0        4  89.8       0  27.8      0        0        15        1
##  5 00246… C          0      33 angiop…     2        8  90.0       0  24.0      0        0        16        1
##  6 00246… C          0      33 arteri…     2        8  90.0       0  24.0      0        0        16        1
##  7 00246… C          0      33 athero…     1        8  90.0       0  24.0      0        0        16        1
##  8 00246… C          0      33 braak       3        8  90.0       0  24.0      0        0        16        1
##  9 00246… C          0      33 cerad       2        8  90.0       0  24.0      0        0        16        1
## 10 00246… C          0      33 hipScl…     0        8  90.0       0  24.0      0        0        16        1
## # ℹ 42,989 more rows
## # ℹ 10 more variables: gender &lt;dbl&gt;, heartProb &lt;dbl&gt;, married &lt;dbl&gt;, mmse &lt;dbl&gt;, parkinsons &lt;dbl&gt;,
## #   race &lt;dbl&gt;, smokes &lt;dbl&gt;, stroke &lt;dbl&gt;, dementia &lt;dbl&gt;, cognition &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="cleaning.html#cb60-1" tabindex="-1"></a><span class="fu">save</span>(map_cov, map_pers, map_out, map_combined, map_cog,</span>
<span id="cb60-2"><a href="cleaning.html#cb60-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/radc-map_cleaned.RData&quot;</span>, load_path))</span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="cleaning.html#cb61-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;map&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="rush-religious-orders-study-ros" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> RUSH Religious Orders Study (ROS)<a href="cleaning.html#rush-religious-orders-study-ros" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The RUSH Religious Orders Study (ROS) is an ongoing longitudinal study that began in 1994 <span class="citation">(<a href="#ref-a2012overview"><strong>a2012overview?</strong></a>)</span>. These data are available, through application from <a href="https://www.radc.rush.edu/requests.htm" class="uri">https://www.radc.rush.edu/requests.htm</a>.</p>
<p>Older (65 and above) Catholic nuns, priests, and brothers with no prior dementia diagnosis and who agreed to annual evaluations and eventual organ donation were recruited from more than 40 groups across the United States. Additional participants are recuited each year. Additional information and documentation on the data can be found at <a href="https://www.radc.rush.edu/docs/var/variables.htm" class="uri">https://www.radc.rush.edu/docs/var/variables.htm</a>.</p>
<p>Sample sizes vary bt year from 353 participants (1994) to 1487 participants, including 797 deceased participants with autopsy data (2019, 2020). This provides 99% power to detect a zero-order correlation effect size of ~.11, two-tailed at alpha .05.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="cleaning.html#cb62-1" tabindex="-1"></a>(ros_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;ROS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="cleaning.html#cb62-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname)))</span></code></pre></div>
<pre><code>## # A tibble: 42 × 15
##    study dataset category   name    itemname year  orig_itemname description scale reverse_code recode  mini
##    &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 ROS   NA      cognition  cognit… freeRec… long… cts_wlii      word list …  &lt;NA&gt; no           ifels…    NA
##  2 ROS   NA      cognition  cognit… cuedRec… long… cts_wliii     word list …  &lt;NA&gt; no           ifels…    NA
##  3 ROS   NA      cognition  cognit… digitsF… long… cts_df        digits bac…  &lt;NA&gt; no           ifels…    NA
##  4 ROS   NA      cognition  cognit… digitsB… long… cts_db        digits for…  &lt;NA&gt; no           ifels…    NA
##  5 ROS   NA      cognition  cognit… catFlue… long… cts_catflu    category f…  &lt;NA&gt; no           ifels…    NA
##  6 ROS   NA      cognition  cognit… bosNami… long… cts_bname     Boston nam…  &lt;NA&gt; no           ifels…    NA
##  7 ROS   NA      cognition  cognit… progMat  long… cts_pmat      progressiv…  &lt;NA&gt; no           ifels…    NA
##  8 ROS   NA      cognition  cognit… digitSy… long… cts_sdmt      symbol dig…  &lt;NA&gt; no           ifels…    NA
##  9 ROS   NA      covariates age     ageBase… base… age_bl        The age at…  &lt;NA&gt; no           ifels…    NA
## 10 ROS   NA      covariates alcohol alcohol  base… alcohol_g_bl  Grams of a… &quot;\r\… no           ifels…    NA
## # ℹ 32 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="cleaning.html#cb64-1" tabindex="-1"></a>ros <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1033_long_03-24-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="cleaning.html#cb64-2" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1033_basic_03-24-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="cleaning.html#cb64-3" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_long_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="cleaning.html#cb64-4" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/rush-radc/dataset_1034_basic_03-25-2021.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="cleaning.html#cb64-5" tabindex="-1"></a>  <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;ROS&quot;</span>)</span></code></pre></div>
<div id="recoding-reverse-scoring-2" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="cleaning.html#cb65-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb65-2"><a href="cleaning.html#cb65-2" tabindex="-1"></a>  <span class="fu">print</span>(var)</span>
<span id="cb65-3"><a href="cleaning.html#cb65-3" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((ros_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb65-4"><a href="cleaning.html#cb65-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> ros <span class="sc">%&gt;%</span> </span>
<span id="cb65-5"><a href="cleaning.html#cb65-5" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> projid, <span class="at">wave =</span> fu_year, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="cleaning.html#cb65-6" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>SID, <span class="sc">-</span>wave, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="cleaning.html#cb65-7" tabindex="-1"></a>    <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb65-8"><a href="cleaning.html#cb65-8" tabindex="-1"></a>}</span>
<span id="cb65-9"><a href="cleaning.html#cb65-9" tabindex="-1"></a></span>
<span id="cb65-10"><a href="cleaning.html#cb65-10" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb65-11"><a href="cleaning.html#cb65-11" tabindex="-1"></a>ros_recode <span class="ot">&lt;-</span> ros_codebook <span class="sc">%&gt;%</span></span>
<span id="cb65-12"><a href="cleaning.html#cb65-12" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb65-13"><a href="cleaning.html#cb65-13" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;cognition&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-14"><a href="cleaning.html#cb65-14" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb65-15"><a href="cleaning.html#cb65-15" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-16"><a href="cleaning.html#cb65-16" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-17"><a href="cleaning.html#cb65-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, name, rename_fun))</span>
<span id="cb65-18"><a href="cleaning.html#cb65-18" tabindex="-1"></a></span>
<span id="cb65-19"><a href="cleaning.html#cb65-19" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb65-20"><a href="cleaning.html#cb65-20" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb65-21"><a href="cleaning.html#cb65-21" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb65-22"><a href="cleaning.html#cb65-22" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb65-23"><a href="cleaning.html#cb65-23" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb65-24"><a href="cleaning.html#cb65-24" tabindex="-1"></a>}</span>
<span id="cb65-25"><a href="cleaning.html#cb65-25" tabindex="-1"></a></span>
<span id="cb65-26"><a href="cleaning.html#cb65-26" tabindex="-1"></a>ros_recode <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span> </span>
<span id="cb65-27"><a href="cleaning.html#cb65-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb65-28"><a href="cleaning.html#cb65-28" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">as.numeric</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb65-29"><a href="cleaning.html#cb65-29" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, wave) <span class="sc">%&gt;%</span></span>
<span id="cb65-30"><a href="cleaning.html#cb65-30" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-31"><a href="cleaning.html#cb65-31" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-32"><a href="cleaning.html#cb65-32" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, wave), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb65-33"><a href="cleaning.html#cb65-33" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb65-34"><a href="cleaning.html#cb65-34" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb65-35"><a href="cleaning.html#cb65-35" tabindex="-1"></a></span>
<span id="cb65-36"><a href="cleaning.html#cb65-36" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb65-37"><a href="cleaning.html#cb65-37" tabindex="-1"></a>ros_recode <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb65-38"><a href="cleaning.html#cb65-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb65-39"><a href="cleaning.html#cb65-39" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), </span>
<span id="cb65-40"><a href="cleaning.html#cb65-40" tabindex="-1"></a>           <span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb65-41"><a href="cleaning.html#cb65-41" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb65-42"><a href="cleaning.html#cb65-42" tabindex="-1"></a></span>
<span id="cb65-43"><a href="cleaning.html#cb65-43" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb65-44"><a href="cleaning.html#cb65-44" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb65-45"><a href="cleaning.html#cb65-45" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb65-46"><a href="cleaning.html#cb65-46" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb65-47"><a href="cleaning.html#cb65-47" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb65-48"><a href="cleaning.html#cb65-48" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb65-49"><a href="cleaning.html#cb65-49" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb65-50"><a href="cleaning.html#cb65-50" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb65-51"><a href="cleaning.html#cb65-51" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb65-52"><a href="cleaning.html#cb65-52" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="covariates-2" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Covariates<a href="cleaning.html#covariates-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="cleaning.html#cb66-1" tabindex="-1"></a><span class="co"># composite WITHIN years </span></span>
<span id="cb66-2"><a href="cleaning.html#cb66-2" tabindex="-1"></a>ros_cov <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="cleaning.html#cb66-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="cleaning.html#cb66-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="cleaning.html#cb66-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb66-6"><a href="cleaning.html#cb66-6" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="cleaning.html#cb66-7" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="cleaning.html#cb66-8" tabindex="-1"></a>      <span class="fu">group_by</span>(comp_rule, SID, wave, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="cleaning.html#cb66-9" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="cleaning.html#cb66-10" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-11"><a href="cleaning.html#cb66-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, <span class="sc">~</span><span class="fu">fun_call</span>((.x)<span class="sc">$</span>value, .y))) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="cleaning.html#cb66-12" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb66-13"><a href="cleaning.html#cb66-13" tabindex="-1"></a>      <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb66-14"><a href="cleaning.html#cb66-14" tabindex="-1"></a>      ))</span>
<span id="cb66-15"><a href="cleaning.html#cb66-15" tabindex="-1"></a></span>
<span id="cb66-16"><a href="cleaning.html#cb66-16" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb66-17"><a href="cleaning.html#cb66-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb66-18"><a href="cleaning.html#cb66-18" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb66-19"><a href="cleaning.html#cb66-19" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(data, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb66-20"><a href="cleaning.html#cb66-20" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-21"><a href="cleaning.html#cb66-21" tabindex="-1"></a>    <span class="fu">distinct</span>()</span>
<span id="cb66-22"><a href="cleaning.html#cb66-22" tabindex="-1"></a>}</span>
<span id="cb66-23"><a href="cleaning.html#cb66-23" tabindex="-1"></a></span>
<span id="cb66-24"><a href="cleaning.html#cb66-24" tabindex="-1"></a><span class="co"># composite ACROSS years</span></span>
<span id="cb66-25"><a href="cleaning.html#cb66-25" tabindex="-1"></a>ros_cov <span class="ot">&lt;-</span> ros_cov <span class="sc">%&gt;%</span></span>
<span id="cb66-26"><a href="cleaning.html#cb66-26" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb66-27"><a href="cleaning.html#cb66-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">long_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(long_rule), <span class="st">&quot;skip&quot;</span>, long_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb66-28"><a href="cleaning.html#cb66-28" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb66-29"><a href="cleaning.html#cb66-29" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-30"><a href="cleaning.html#cb66-30" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-31"><a href="cleaning.html#cb66-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, long_rule), comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb66-32"><a href="cleaning.html#cb66-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb66-33"><a href="cleaning.html#cb66-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb66-34"><a href="cleaning.html#cb66-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb66-35"><a href="cleaning.html#cb66-35" tabindex="-1"></a>  <span class="fu">spread</span>(name, value) <span class="sc">%&gt;%</span></span>
<span id="cb66-36"><a href="cleaning.html#cb66-36" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SID))</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="cleaning.html#cb67-1" tabindex="-1"></a>ros_cov</span></code></pre></div>
<pre><code>## # A tibble: 1,485 × 14
##    SID       age alcohol   BMI cancer diabetes education exercise gender heartProb  mmse  race smokes stroke
##    &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 000210…  80.0       0  19.9      0        0        22        1      0         1    18     0      0      0
##  2 003377…  82.2       0  42.8      0        0        22        1      1         0    27     0      0      0
##  3 003811…  70.3       0  29.7      0        0        20        0      0         0    30     0      0     NA
##  4 004702…  72.6       1  20.0      1        0        18        1      0         0    30     0      0      0
##  5 007567…  87.3       0  33.2      0        1        20        0      1         0    23     1      1      0
##  6 009850…  78.6       0  23.7      1        0        21        1      0         0    28     0      0      0
##  7 012114…  85.2       0  25.1      0        0        12        0      1         0    24     0      1      0
##  8 012370…  72.0       0  18.8      0        0        16        1      0         0    29     0      0      0
##  9 016795…  65.2       1  36.4      0        0        22        1      0         0    30     0      0      0
## 10 021057…  85.2       1  21.5      0        0        18        1      0         0    29     0      0      0
## # ℹ 1,475 more rows</code></pre>
</div>
<div id="personality-variables-2" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Personality Variables<a href="cleaning.html#personality-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="cleaning.html#cb69-1" tabindex="-1"></a>ros_pers <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="cleaning.html#cb69-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="cleaning.html#cb69-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span> </span>
<span id="cb69-4"><a href="cleaning.html#cb69-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="cleaning.html#cb69-5" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="cleaning.html#cb69-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="cleaning.html#cb69-7" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="fu">min</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb69-8"><a href="cleaning.html#cb69-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-9"><a href="cleaning.html#cb69-9" tabindex="-1"></a>  <span class="fu">select</span>(SID, name, wave, value)</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="cleaning.html#cb70-1" tabindex="-1"></a>ros_pers</span></code></pre></div>
<pre><code>## # A tibble: 7,569 × 4
##    SID      name   wave value
##    &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 00021073 A         0    32
##  2 00337708 A         0    30
##  3 00381112 A         0    36
##  4 00470212 A         0    41
##  5 00756793 A         0    27
##  6 00985084 A         0    33
##  7 01211411 A         0    27
##  8 01237015 A         0    34
##  9 01679543 A         0    43
## 10 02105734 A         0    36
## # ℹ 7,559 more rows</code></pre>
</div>
<div id="outcome-variables-2" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Outcome Variables<a href="cleaning.html#outcome-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="cleaning.html#cb72-1" tabindex="-1"></a>ros_out_waves <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="cleaning.html#cb72-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="cleaning.html#cb72-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="cleaning.html#cb72-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb72-5"><a href="cleaning.html#cb72-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="cleaning.html#cb72-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb72-7"><a href="cleaning.html#cb72-7" tabindex="-1"></a></span>
<span id="cb72-8"><a href="cleaning.html#cb72-8" tabindex="-1"></a>ros_out <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb72-9"><a href="cleaning.html#cb72-9" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-10"><a href="cleaning.html#cb72-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb72-11"><a href="cleaning.html#cb72-11" tabindex="-1"></a>  <span class="fu">unnest</span>(data) </span>
<span id="cb72-12"><a href="cleaning.html#cb72-12" tabindex="-1"></a></span>
<span id="cb72-13"><a href="cleaning.html#cb72-13" tabindex="-1"></a>ros_dem <span class="ot">&lt;-</span> ros_out <span class="sc">%&gt;%</span> </span>
<span id="cb72-14"><a href="cleaning.html#cb72-14" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-15"><a href="cleaning.html#cb72-15" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, wave) <span class="sc">%&gt;%</span></span>
<span id="cb72-16"><a href="cleaning.html#cb72-16" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb72-17"><a href="cleaning.html#cb72-17" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-18"><a href="cleaning.html#cb72-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value),</span>
<span id="cb72-19"><a href="cleaning.html#cb72-19" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">ifelse</span>(wave <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;future&quot;</span>, <span class="st">&quot;past&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb72-20"><a href="cleaning.html#cb72-20" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, group) <span class="sc">%&gt;%</span></span>
<span id="cb72-21"><a href="cleaning.html#cb72-21" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb72-22"><a href="cleaning.html#cb72-22" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-23"><a href="cleaning.html#cb72-23" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb72-24"><a href="cleaning.html#cb72-24" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb72-25"><a href="cleaning.html#cb72-25" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb72-26"><a href="cleaning.html#cb72-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(past) <span class="sc">|</span> (past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(future)), future,</span>
<span id="cb72-27"><a href="cleaning.html#cb72-27" tabindex="-1"></a>                   <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(future), past, </span>
<span id="cb72-28"><a href="cleaning.html#cb72-28" tabindex="-1"></a>                   <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb72-29"><a href="cleaning.html#cb72-29" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb72-30"><a href="cleaning.html#cb72-30" tabindex="-1"></a></span>
<span id="cb72-31"><a href="cleaning.html#cb72-31" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb72-32"><a href="cleaning.html#cb72-32" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb72-33"><a href="cleaning.html#cb72-33" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb72-34"><a href="cleaning.html#cb72-34" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb72-35"><a href="cleaning.html#cb72-35" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-36"><a href="cleaning.html#cb72-36" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb72-37"><a href="cleaning.html#cb72-37" tabindex="-1"></a>}</span>
<span id="cb72-38"><a href="cleaning.html#cb72-38" tabindex="-1"></a></span>
<span id="cb72-39"><a href="cleaning.html#cb72-39" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb72-40"><a href="cleaning.html#cb72-40" tabindex="-1"></a>ros_out <span class="ot">&lt;-</span> ros_out <span class="sc">%&gt;%</span></span>
<span id="cb72-41"><a href="cleaning.html#cb72-41" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> name <span class="sc">!=</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-42"><a href="cleaning.html#cb72-42" tabindex="-1"></a>  <span class="fu">group_by</span>(name, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb72-43"><a href="cleaning.html#cb72-43" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-44"><a href="cleaning.html#cb72-44" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb72-45"><a href="cleaning.html#cb72-45" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, long_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb72-46"><a href="cleaning.html#cb72-46" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb72-47"><a href="cleaning.html#cb72-47" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb72-48"><a href="cleaning.html#cb72-48" tabindex="-1"></a>  <span class="fu">full_join</span>(ros_dem) <span class="sc">%&gt;%</span></span>
<span id="cb72-49"><a href="cleaning.html#cb72-49" tabindex="-1"></a>  <span class="fu">left_join</span>(ros_out_waves)</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="cleaning.html#cb73-1" tabindex="-1"></a>ros_out</span></code></pre></div>
<pre><code>## # A tibble: 9,581 × 6
##    name        SID      value future  past o_year
##    &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 ageDementia 02495739  92.5     NA    NA     13
##  2 ageDementia 07299965  80.0     NA    NA     13
##  3 ageDementia 07660182  83.7     NA    NA      4
##  4 ageDementia 10100150  84.5     NA    NA     12
##  5 ageDementia 10100286  80.7     NA    NA     18
##  6 ageDementia 10101039  90.4     NA    NA      8
##  7 ageDementia 10101589 107.      NA    NA      6
##  8 ageDementia 10101741  92.4     NA    NA     12
##  9 ageDementia 10116694  82.2     NA    NA      5
## 10 ageDementia 10200901  96.2     NA    NA     23
## # ℹ 9,571 more rows</code></pre>
</div>
<div id="cognition-variables-2" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Cognition Variables<a href="cleaning.html#cognition-variables-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="cleaning.html#cb75-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb75-2"><a href="cleaning.html#cb75-2" tabindex="-1"></a>ros_cog <span class="ot">&lt;-</span> ros_recode <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="cleaning.html#cb75-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="cleaning.html#cb75-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="cleaning.html#cb75-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb75-6"><a href="cleaning.html#cb75-6" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="cleaning.html#cb75-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb75-8"><a href="cleaning.html#cb75-8" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, wave) <span class="sc">%&gt;%</span></span>
<span id="cb75-9"><a href="cleaning.html#cb75-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb75-10"><a href="cleaning.html#cb75-10" tabindex="-1"></a>  <span class="fu">group_by</span>(name, SID) <span class="sc">%&gt;%</span></span>
<span id="cb75-11"><a href="cleaning.html#cb75-11" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb75-12"><a href="cleaning.html#cb75-12" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-13"><a href="cleaning.html#cb75-13" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb75-14"><a href="cleaning.html#cb75-14" tabindex="-1"></a>              , <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="cleaning.html#cb76-1" tabindex="-1"></a>ros_cog</span></code></pre></div>
<pre><code>## # A tibble: 1,485 × 2
##    SID      cognition
##    &lt;chr&gt;        &lt;dbl&gt;
##  1 00021073      4.19
##  2 00337708      5.89
##  3 00381112      7.02
##  4 00470212      6.68
##  5 00756793      4.35
##  6 00985084      6.83
##  7 01211411      3.83
##  8 01237015      5.64
##  9 01679543      7.23
## 10 02105734      6.64
## # ℹ 1,475 more rows</code></pre>
</div>
<div id="combine-data-2" class="section level3 hasAnchor" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> Combine Data<a href="cleaning.html#combine-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="cleaning.html#cb78-1" tabindex="-1"></a>ros_combined <span class="ot">&lt;-</span> ros_pers <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="cleaning.html#cb78-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> wave) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="cleaning.html#cb78-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb78-4"><a href="cleaning.html#cb78-4" tabindex="-1"></a>    ros_out <span class="sc">%&gt;%</span> </span>
<span id="cb78-5"><a href="cleaning.html#cb78-5" tabindex="-1"></a>      <span class="fu">select</span>(<span class="at">Outcome =</span> name, SID, <span class="at">o_value =</span> value, o_year)</span>
<span id="cb78-6"><a href="cleaning.html#cb78-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb78-7"><a href="cleaning.html#cb78-7" tabindex="-1"></a>  <span class="fu">full_join</span>(ros_cov) <span class="sc">%&gt;%</span></span>
<span id="cb78-8"><a href="cleaning.html#cb78-8" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb78-9"><a href="cleaning.html#cb78-9" tabindex="-1"></a>    ros_out <span class="sc">%&gt;%</span></span>
<span id="cb78-10"><a href="cleaning.html#cb78-10" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-11"><a href="cleaning.html#cb78-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">rowSums</span>(<span class="fu">cbind</span>(future, past), <span class="at">na.rm =</span> T) <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-12"><a href="cleaning.html#cb78-12" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>future, <span class="sc">-</span>past) <span class="sc">%&gt;%</span></span>
<span id="cb78-13"><a href="cleaning.html#cb78-13" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb78-14"><a href="cleaning.html#cb78-14" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb78-15"><a href="cleaning.html#cb78-15" tabindex="-1"></a>  <span class="fu">full_join</span>(ros_cog) <span class="sc">%&gt;%</span></span>
<span id="cb78-16"><a href="cleaning.html#cb78-16" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value))</span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="cleaning.html#cb79-1" tabindex="-1"></a>ros_combined</span></code></pre></div>
<pre><code>## # A tibble: 48,074 × 22
##    SID    Trait p_year p_value Outcome o_value o_year   age alcohol   BMI cancer diabetes education exercise
##    &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 00021… A          0      32 angiop…       3      2  80.0       0  19.9      0        0        22        1
##  2 00021… A          0      32 arteri…       0      2  80.0       0  19.9      0        0        22        1
##  3 00021… A          0      32 athero…       2      2  80.0       0  19.9      0        0        22        1
##  4 00021… A          0      32 braak         6      2  80.0       0  19.9      0        0        22        1
##  5 00021… A          0      32 cerad         1      2  80.0       0  19.9      0        0        22        1
##  6 00021… A          0      32 hipScl…       0      2  80.0       0  19.9      0        0        22        1
##  7 00021… A          0      32 lewyBo…       0      2  80.0       0  19.9      0        0        22        1
##  8 00021… A          0      32 vsclrI…       0      2  80.0       0  19.9      0        0        22        1
##  9 00021… A          0      32 vsclrM…       1      2  80.0       0  19.9      0        0        22        1
## 10 00021… A          0      32 tdp43         1      2  80.0       0  19.9      0        0        22        1
## # ℹ 48,064 more rows
## # ℹ 8 more variables: gender &lt;dbl&gt;, heartProb &lt;dbl&gt;, mmse &lt;dbl&gt;, race &lt;dbl&gt;, smokes &lt;dbl&gt;, stroke &lt;dbl&gt;,
## #   dementia &lt;dbl&gt;, cognition &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cleaning.html#cb81-1" tabindex="-1"></a><span class="fu">save</span>(ros_cov, ros_pers, ros_out, ros_combined, ros_cog,</span>
<span id="cb81-2"><a href="cleaning.html#cb81-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/ros_cleaned.RData&quot;</span>, load_path))</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="cleaning.html#cb82-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;ros&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="swedish-adoption-twin-study-of-aging-satsa" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Swedish Adoption Twin Study of Aging (SATSA)<a href="cleaning.html#swedish-adoption-twin-study-of-aging-satsa" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Swedish Adoption Twin Study of Aging (SATSA) is a longitudinal study of twin pairs from the Swedish Twin Registry that began in 1984. Data are available through the ICPSR database at <a href="https://www.icpsr.umich.edu/web/ICPSR/studies/3843" class="uri">https://www.icpsr.umich.edu/web/ICPSR/studies/3843</a>.</p>
<p>All twin-pairs on the Swedish Twin Registry who were separated at an early age were invited to be a part of the study in 1984. A control sample of twins reared together were also included. Additional waves of all participants were collected in 1987, 1990, 1993, 2004, 2007, 2010, 2012, and 2014. More information, including codebooks, scales, and variable search functions can be found at <a href="https://www.maelstrom-research.org/mica/individual-study/satsa/#" class="uri">https://www.maelstrom-research.org/mica/individual-study/satsa/#</a>.</p>
<p>Sample sizes vary by wave, ranging from 2018 participants at baseline (1984) to 379 participants (IPT7). Given that the target measures were collected at baseline, this provides 99% power to detect a zero-order correlation effect size of ~.10, two-tailed at alpha .05.</p>
<div id="load-data-2" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Load Data<a href="cleaning.html#load-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="cleaning.html#cb83-1" tabindex="-1"></a>satsa_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb83-2"><a href="cleaning.html#cb83-2" tabindex="-1"></a>  prob_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FHEART&quot;</span>, <span class="st">&quot;FPARKIN&quot;</span>, <span class="st">&quot;FSTROKE&quot;</span>)</span>
<span id="cb83-3"><a href="cleaning.html#cb83-3" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/satsa/%s&quot;</span>, data_path, x) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="cleaning.html#cb83-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> TWINNR, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb83-5"><a href="cleaning.html#cb83-5" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-6"><a href="cleaning.html#cb83-6" tabindex="-1"></a>    haven<span class="sc">::</span><span class="fu">zap_labels</span>(.)</span>
<span id="cb83-7"><a href="cleaning.html#cb83-7" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(prob_vars <span class="sc">%in%</span> <span class="fu">colnames</span>(y))){</span>
<span id="cb83-8"><a href="cleaning.html#cb83-8" tabindex="-1"></a>    y <span class="ot">&lt;-</span> y <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(<span class="fu">one_of</span>(prob_vars)), <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(.)))</span>
<span id="cb83-9"><a href="cleaning.html#cb83-9" tabindex="-1"></a>    }</span>
<span id="cb83-10"><a href="cleaning.html#cb83-10" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb83-11"><a href="cleaning.html#cb83-11" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="cleaning.html#cb84-1" tabindex="-1"></a>satsa_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;SATSA&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="cleaning.html#cb84-2" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(orig_itemname), str_to_upper)</span>
<span id="cb84-3"><a href="cleaning.html#cb84-3" tabindex="-1"></a>satsa_codebook</span></code></pre></div>
<pre><code>## # A tibble: 840 × 17
##    study dataset    category  name      itemname wave_letter  year item_stem orig_itemname description scale
##    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;
##  1 satsa SATSA_IPT1 cognition cognition blockDe… &lt;NA&gt;         1985 &lt;NA&gt;      IBLOC_R1      Block Desi… inte…
##  2 satsa SATSA_IPT2 cognition cognition blockDe… &lt;NA&gt;         1989 &lt;NA&gt;      IBLOC_R2      Block Desi… inte…
##  3 satsa SATSA_IPT3 cognition cognition blockDe… &lt;NA&gt;         1992 &lt;NA&gt;      IBLOC_R3      Block Desi… inte…
##  4 satsa SATSA_IPT4 cognition cognition blockDe… &lt;NA&gt;         1995 &lt;NA&gt;      IBLOC_R4      Block Desi… inte…
##  5 satsa SATSA_IPT5 cognition cognition blockDe… &lt;NA&gt;         1999 &lt;NA&gt;      IBLOC_R5      Block Desi… inte…
##  6 satsa SATSA_IPT6 cognition cognition blockDe… &lt;NA&gt;         2002 &lt;NA&gt;      IBLOC_R6      Block Desi… inte…
##  7 satsa SATSA_IPT7 cognition cognition blockDe… &lt;NA&gt;         2005 &lt;NA&gt;      IBLOC_R7      Block Desi… inte…
##  8 satsa SATSA_IPT1 cognition cognition digitSp… &lt;NA&gt;         1985 &lt;NA&gt;      IDGSP_R1      Digit Span… inte…
##  9 satsa SATSA_IPT2 cognition cognition digitSp… &lt;NA&gt;         1989 &lt;NA&gt;      IDGSP_R2      Digit Span… inte…
## 10 satsa SATSA_IPT3 cognition cognition digitSp… &lt;NA&gt;         1992 &lt;NA&gt;      IDGSP_R3      Digit Span… inte…
## # ℹ 830 more rows
## # ℹ 6 more variables: reverse_code &lt;chr&gt;, recode &lt;chr&gt;, mini &lt;dbl&gt;, maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;,
## #   long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="cleaning.html#cb86-1" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(satsa_codebook<span class="sc">$</span>orig_itemname) <span class="sc">%&gt;%</span> str_to_upper</span>
<span id="cb86-2"><a href="cleaning.html#cb86-2" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/satsa&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">list.files</span>(., <span class="at">pattern =</span> <span class="st">&quot;.sav&quot;</span>)</span>
<span id="cb86-3"><a href="cleaning.html#cb86-3" tabindex="-1"></a>satsa <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">datasets =</span> datasets) <span class="sc">%&gt;%</span></span>
<span id="cb86-4"><a href="cleaning.html#cb86-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(datasets, satsa_read_fun),</span>
<span id="cb86-5"><a href="cleaning.html#cb86-5" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="fu">map_dbl</span>(data, ncol)) <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="cleaning.html#cb86-6" tabindex="-1"></a>  <span class="fu">filter</span>(ncol <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb86-7"><a href="cleaning.html#cb86-7" tabindex="-1"></a></span>
<span id="cb86-8"><a href="cleaning.html#cb86-8" tabindex="-1"></a>satsa <span class="ot">&lt;-</span> <span class="fu">reduce</span>(satsa<span class="sc">$</span>data, full_join)</span>
<span id="cb86-9"><a href="cleaning.html#cb86-9" tabindex="-1"></a>satsa <span class="ot">&lt;-</span> satsa <span class="sc">%&gt;%</span></span>
<span id="cb86-10"><a href="cleaning.html#cb86-10" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.factor, <span class="sc">~</span><span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">&quot;^</span><span class="sc">\\</span><span class="st">(0*([0-9]+)</span><span class="sc">\\</span><span class="st">).+$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, .))) </span>
<span id="cb86-11"><a href="cleaning.html#cb86-11" tabindex="-1"></a>satsa_long <span class="ot">&lt;-</span> satsa <span class="sc">%&gt;%</span> </span>
<span id="cb86-12"><a href="cleaning.html#cb86-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb86-13"><a href="cleaning.html#cb86-13" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb86-14"><a href="cleaning.html#cb86-14" tabindex="-1"></a>    , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb86-15"><a href="cleaning.html#cb86-15" tabindex="-1"></a>    , <span class="at">cols =</span> <span class="sc">-</span>SID</span>
<span id="cb86-16"><a href="cleaning.html#cb86-16" tabindex="-1"></a>    <span class="co"># , values_drop_na = T</span></span>
<span id="cb86-17"><a href="cleaning.html#cb86-17" tabindex="-1"></a>    )</span>
<span id="cb86-18"><a href="cleaning.html#cb86-18" tabindex="-1"></a><span class="fu">save</span>(satsa, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/satsa_raw.RData&quot;</span>, load_path))</span>
<span id="cb86-19"><a href="cleaning.html#cb86-19" tabindex="-1"></a><span class="fu">rm</span>(satsa)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-3" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="cleaning.html#cb87-1" tabindex="-1"></a>satsa_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;SATSA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb87-2"><a href="cleaning.html#cb87-2" tabindex="-1"></a></span>
<span id="cb87-3"><a href="cleaning.html#cb87-3" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb87-4"><a href="cleaning.html#cb87-4" tabindex="-1"></a>satsa_recode <span class="ot">&lt;-</span> satsa_codebook <span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="cleaning.html#cb87-5" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb87-6"><a href="cleaning.html#cb87-6" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;cognition&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb87-7"><a href="cleaning.html#cb87-7" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb87-8"><a href="cleaning.html#cb87-8" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb87-9"><a href="cleaning.html#cb87-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-10"><a href="cleaning.html#cb87-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(satsa_long)))</span>
<span id="cb87-11"><a href="cleaning.html#cb87-11" tabindex="-1"></a></span>
<span id="cb87-12"><a href="cleaning.html#cb87-12" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb87-13"><a href="cleaning.html#cb87-13" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb87-14"><a href="cleaning.html#cb87-14" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb87-15"><a href="cleaning.html#cb87-15" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb87-16"><a href="cleaning.html#cb87-16" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb87-17"><a href="cleaning.html#cb87-17" tabindex="-1"></a>}</span>
<span id="cb87-18"><a href="cleaning.html#cb87-18" tabindex="-1"></a></span>
<span id="cb87-19"><a href="cleaning.html#cb87-19" tabindex="-1"></a>satsa_recode <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span> </span>
<span id="cb87-20"><a href="cleaning.html#cb87-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb87-21"><a href="cleaning.html#cb87-21" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year) <span class="sc">%&gt;%</span></span>
<span id="cb87-22"><a href="cleaning.html#cb87-22" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-23"><a href="cleaning.html#cb87-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-24"><a href="cleaning.html#cb87-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb87-25"><a href="cleaning.html#cb87-25" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb87-26"><a href="cleaning.html#cb87-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb87-27"><a href="cleaning.html#cb87-27" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value))))</span>
<span id="cb87-28"><a href="cleaning.html#cb87-28" tabindex="-1"></a></span>
<span id="cb87-29"><a href="cleaning.html#cb87-29" tabindex="-1"></a></span>
<span id="cb87-30"><a href="cleaning.html#cb87-30" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb87-31"><a href="cleaning.html#cb87-31" tabindex="-1"></a>satsa_recode <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span></span>
<span id="cb87-32"><a href="cleaning.html#cb87-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb87-33"><a href="cleaning.html#cb87-33" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb87-34"><a href="cleaning.html#cb87-34" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb87-35"><a href="cleaning.html#cb87-35" tabindex="-1"></a></span>
<span id="cb87-36"><a href="cleaning.html#cb87-36" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb87-37"><a href="cleaning.html#cb87-37" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb87-38"><a href="cleaning.html#cb87-38" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb87-39"><a href="cleaning.html#cb87-39" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb87-40"><a href="cleaning.html#cb87-40" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb87-41"><a href="cleaning.html#cb87-41" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb87-42"><a href="cleaning.html#cb87-42" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb87-43"><a href="cleaning.html#cb87-43" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb87-44"><a href="cleaning.html#cb87-44" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb87-45"><a href="cleaning.html#cb87-45" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-3" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Covariates<a href="cleaning.html#covariates-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="cleaning.html#cb88-1" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/satsa_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="cleaning.html#cb89-1" tabindex="-1"></a>satsa_cov <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span> <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>)</span>
<span id="cb89-2"><a href="cleaning.html#cb89-2" tabindex="-1"></a><span class="co"># bring in year or birth for cleaning</span></span>
<span id="cb89-3"><a href="cleaning.html#cb89-3" tabindex="-1"></a>yrBrth <span class="ot">&lt;-</span> satsa_cov <span class="sc">%&gt;%</span> </span>
<span id="cb89-4"><a href="cleaning.html#cb89-4" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;yearBrth&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb89-5"><a href="cleaning.html#cb89-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb89-6"><a href="cleaning.html#cb89-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb89-7"><a href="cleaning.html#cb89-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">yearBrth =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb89-8"><a href="cleaning.html#cb89-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-9"><a href="cleaning.html#cb89-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yearBrth =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(yearBrth), <span class="cn">NA</span>, yearBrth))</span>
<span id="cb89-10"><a href="cleaning.html#cb89-10" tabindex="-1"></a></span>
<span id="cb89-11"><a href="cleaning.html#cb89-11" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb89-12"><a href="cleaning.html#cb89-12" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb89-13"><a href="cleaning.html#cb89-13" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb89-14"><a href="cleaning.html#cb89-14" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb89-15"><a href="cleaning.html#cb89-15" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year, long_rule) <span class="sc">%&gt;%</span> </span>
<span id="cb89-16"><a href="cleaning.html#cb89-16" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb89-17"><a href="cleaning.html#cb89-17" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb89-18"><a href="cleaning.html#cb89-18" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb89-19"><a href="cleaning.html#cb89-19" tabindex="-1"></a>}</span>
<span id="cb89-20"><a href="cleaning.html#cb89-20" tabindex="-1"></a></span>
<span id="cb89-21"><a href="cleaning.html#cb89-21" tabindex="-1"></a>satsa_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;SATSA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb89-22"><a href="cleaning.html#cb89-22" tabindex="-1"></a></span>
<span id="cb89-23"><a href="cleaning.html#cb89-23" tabindex="-1"></a>satsa_cov <span class="ot">&lt;-</span> satsa_cov <span class="sc">%&gt;%</span></span>
<span id="cb89-24"><a href="cleaning.html#cb89-24" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb89-25"><a href="cleaning.html#cb89-25" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="fu">max</span>(satsa_waves<span class="sc">$</span>Used) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-26"><a href="cleaning.html#cb89-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule) <span class="sc">|</span> comp_rule <span class="sc">==</span> <span class="st">&quot;none&quot;</span>, <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb89-27"><a href="cleaning.html#cb89-27" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb89-28"><a href="cleaning.html#cb89-28" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-29"><a href="cleaning.html#cb89-29" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-30"><a href="cleaning.html#cb89-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb89-31"><a href="cleaning.html#cb89-31" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb89-32"><a href="cleaning.html#cb89-32" tabindex="-1"></a></span>
<span id="cb89-33"><a href="cleaning.html#cb89-33" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb89-34"><a href="cleaning.html#cb89-34" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb89-35"><a href="cleaning.html#cb89-35" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb89-36"><a href="cleaning.html#cb89-36" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb89-37"><a href="cleaning.html#cb89-37" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb89-38"><a href="cleaning.html#cb89-38" tabindex="-1"></a>}</span>
<span id="cb89-39"><a href="cleaning.html#cb89-39" tabindex="-1"></a></span>
<span id="cb89-40"><a href="cleaning.html#cb89-40" tabindex="-1"></a>satsa_cov <span class="ot">&lt;-</span> satsa_cov <span class="sc">%&gt;%</span></span>
<span id="cb89-41"><a href="cleaning.html#cb89-41" tabindex="-1"></a>  <span class="fu">group_by</span>(name, long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb89-42"><a href="cleaning.html#cb89-42" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-43"><a href="cleaning.html#cb89-43" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-44"><a href="cleaning.html#cb89-44" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, long_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb89-45"><a href="cleaning.html#cb89-45" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb89-46"><a href="cleaning.html#cb89-46" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb89-47"><a href="cleaning.html#cb89-47" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb89-48"><a href="cleaning.html#cb89-48" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(<span class="at">value =</span> max))  <span class="sc">%&gt;%</span></span>
<span id="cb89-49"><a href="cleaning.html#cb89-49" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BMI =</span> weight<span class="sc">/</span>((height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="cleaning.html#cb90-1" tabindex="-1"></a>satsa_cov</span></code></pre></div>
<pre><code>## # A tibble: 3,840 × 18
##      SID smokes alcohol cancer diabetes heartProb married parkinsons respProb stroke gender education  mmse
##    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1   181      0      NA     NA       NA        NA      NA         NA       NA     NA      0        NA    NA
##  2   182      0      NA     NA       NA        NA      NA         NA       NA     NA      0        NA    NA
##  3  1101      0      NA     NA       NA        NA      NA         NA       NA     NA      0        NA    NA
##  4  1102      0      NA     NA       NA        NA      NA         NA       NA     NA      0        NA    NA
##  5  1121      0      NA     NA       NA        NA      NA         NA       NA     NA      1        NA    NA
##  6  1122      0      NA     NA       NA        NA      NA         NA       NA     NA      1        NA    NA
##  7  1151      0      NA     NA       NA        NA      NA         NA       NA     NA      1        NA    NA
##  8  1152      0      NA     NA       NA        NA      NA         NA       NA     NA      1        NA    NA
##  9  1211      0      NA     NA       NA        NA      NA         NA       NA     NA      1        NA    NA
## 10  1212      0      NA     NA       NA        NA      NA         NA       NA     NA      1        NA    NA
## # ℹ 3,830 more rows
## # ℹ 5 more variables: yearBrth &lt;dbl&gt;, SRhealth &lt;dbl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, BMI &lt;dbl&gt;</code></pre>
</div>
<div id="personality-variables-3" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Personality Variables<a href="cleaning.html#personality-variables-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="cleaning.html#cb92-1" tabindex="-1"></a>satsa_pers <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="cleaning.html#cb92-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="cleaning.html#cb92-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb92-4"><a href="cleaning.html#cb92-4" tabindex="-1"></a>  <span class="fu">left_join</span>(p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;SATSA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">name =</span> p_item, Used)) <span class="sc">%&gt;%</span></span>
<span id="cb92-5"><a href="cleaning.html#cb92-5" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> Used <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="cleaning.html#cb92-6" tabindex="-1"></a>  <span class="fu">distinct</span>() </span>
<span id="cb92-7"><a href="cleaning.html#cb92-7" tabindex="-1"></a></span>
<span id="cb92-8"><a href="cleaning.html#cb92-8" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb92-9"><a href="cleaning.html#cb92-9" tabindex="-1"></a>satsa_alpha <span class="ot">&lt;-</span> satsa_pers <span class="sc">%&gt;%</span></span>
<span id="cb92-10"><a href="cleaning.html#cb92-10" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb92-11"><a href="cleaning.html#cb92-11" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb92-12"><a href="cleaning.html#cb92-12" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-13"><a href="cleaning.html#cb92-13" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-14"><a href="cleaning.html#cb92-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">spread</span>(itemname, value)),</span>
<span id="cb92-15"><a href="cleaning.html#cb92-15" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb92-16"><a href="cleaning.html#cb92-16" tabindex="-1"></a></span>
<span id="cb92-17"><a href="cleaning.html#cb92-17" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb92-18"><a href="cleaning.html#cb92-18" tabindex="-1"></a>satsa_pers <span class="ot">&lt;-</span> satsa_pers <span class="sc">%&gt;%</span></span>
<span id="cb92-19"><a href="cleaning.html#cb92-19" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, year) <span class="sc">%&gt;%</span></span>
<span id="cb92-20"><a href="cleaning.html#cb92-20" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb92-21"><a href="cleaning.html#cb92-21" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="cleaning.html#cb93-1" tabindex="-1"></a>satsa_pers</span></code></pre></div>
<pre><code>## # A tibble: 14,109 × 4
##      SID name   year value
##    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  1292 A      1984  4   
##  2  1292 C      1984  4   
##  3  1292 E      1984  3.67
##  4  1292 N      1984  4.33
##  5  1292 O      1984  3.5 
##  6  1292 SWL    1984  2.54
##  7  1701 C      1984  5   
##  8  1701 E      1984  3.89
##  9  1701 N      1984  4   
## 10  1701 O      1984  1   
## # ℹ 14,099 more rows</code></pre>
</div>
<div id="outcome-variables-3" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="cleaning.html#cb95-1" tabindex="-1"></a>satsa_out <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="cleaning.html#cb95-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="cleaning.html#cb95-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="cleaning.html#cb95-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="cleaning.html#cb95-5" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="fu">crossing</span>(<span class="at">p_year =</span> satsa_waves<span class="sc">$</span>Used, <span class="at">name =</span> <span class="fu">unique</span>((.)<span class="sc">$</span>name)))</span>
<span id="cb95-6"><a href="cleaning.html#cb95-6" tabindex="-1"></a></span>
<span id="cb95-7"><a href="cleaning.html#cb95-7" tabindex="-1"></a>satsa_out_waves <span class="ot">&lt;-</span> satsa_out <span class="sc">%&gt;%</span></span>
<span id="cb95-8"><a href="cleaning.html#cb95-8" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb95-9"><a href="cleaning.html#cb95-9" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(year[<span class="sc">!</span><span class="fu">is.na</span>(value)])) <span class="sc">%&gt;%</span></span>
<span id="cb95-10"><a href="cleaning.html#cb95-10" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb95-11"><a href="cleaning.html#cb95-11" tabindex="-1"></a></span>
<span id="cb95-12"><a href="cleaning.html#cb95-12" tabindex="-1"></a>satsa_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;SATSA&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb95-13"><a href="cleaning.html#cb95-13" tabindex="-1"></a></span>
<span id="cb95-14"><a href="cleaning.html#cb95-14" tabindex="-1"></a>satsa_out <span class="ot">&lt;-</span> satsa_out <span class="sc">%&gt;%</span></span>
<span id="cb95-15"><a href="cleaning.html#cb95-15" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb95-16"><a href="cleaning.html#cb95-16" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, year, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb95-17"><a href="cleaning.html#cb95-17" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb95-18"><a href="cleaning.html#cb95-18" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-19"><a href="cleaning.html#cb95-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.nan</span>(value)<span class="sc">|</span><span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb95-20"><a href="cleaning.html#cb95-20" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, name) <span class="sc">%&gt;%</span></span>
<span id="cb95-21"><a href="cleaning.html#cb95-21" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb95-22"><a href="cleaning.html#cb95-22" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-23"><a href="cleaning.html#cb95-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb95-24"><a href="cleaning.html#cb95-24" tabindex="-1"></a>  <span class="fu">left_join</span>(satsa_out_waves)</span></code></pre></div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="cleaning.html#cb96-1" tabindex="-1"></a>satsa_out</span></code></pre></div>
<pre><code>## # A tibble: 3,840 × 5
##      SID p_year name     value o_year
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1   181   1984 dementia     0   2005
##  2   182   1984 dementia     0   2005
##  3  1101   1984 dementia     0   2005
##  4  1102   1984 dementia     0   2005
##  5  1121   1984 dementia     0   2005
##  6  1122   1984 dementia     0   2005
##  7  1151   1984 dementia     0   2005
##  8  1152   1984 dementia     0   2005
##  9  1211   1984 dementia     0   2005
## 10  1212   1984 dementia     0   2005
## # ℹ 3,830 more rows</code></pre>
</div>
<div id="cognition-variables-3" class="section level3 hasAnchor" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> Cognition Variables<a href="cleaning.html#cognition-variables-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="cleaning.html#cb98-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb98-2"><a href="cleaning.html#cb98-2" tabindex="-1"></a>satsa_cog <span class="ot">&lt;-</span> satsa_recode <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="cleaning.html#cb98-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="cleaning.html#cb98-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb98-5"><a href="cleaning.html#cb98-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb98-6"><a href="cleaning.html#cb98-6" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">1985</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="cleaning.html#cb98-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="cleaning.html#cb98-8" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, year) <span class="sc">%&gt;%</span></span>
<span id="cb98-9"><a href="cleaning.html#cb98-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb98-10"><a href="cleaning.html#cb98-10" tabindex="-1"></a>  <span class="fu">group_by</span>(name, SID) <span class="sc">%&gt;%</span></span>
<span id="cb98-11"><a href="cleaning.html#cb98-11" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb98-12"><a href="cleaning.html#cb98-12" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-13"><a href="cleaning.html#cb98-13" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb98-14"><a href="cleaning.html#cb98-14" tabindex="-1"></a>              , <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
</div>
<div id="combine-data-3" class="section level3 hasAnchor" number="2.4.7">
<h3><span class="header-section-number">2.4.7</span> Combine Data<a href="cleaning.html#combine-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="cleaning.html#cb99-1" tabindex="-1"></a>satsa_combined <span class="ot">&lt;-</span> satsa_pers <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="cleaning.html#cb99-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="cleaning.html#cb99-3" tabindex="-1"></a>  <span class="fu">full_join</span>(satsa_out <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value)) <span class="sc">%&gt;%</span></span>
<span id="cb99-4"><a href="cleaning.html#cb99-4" tabindex="-1"></a>  <span class="fu">full_join</span>(satsa_cov) <span class="sc">%&gt;%</span></span>
<span id="cb99-5"><a href="cleaning.html#cb99-5" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb99-6"><a href="cleaning.html#cb99-6" tabindex="-1"></a>    satsa_out <span class="sc">%&gt;%</span></span>
<span id="cb99-7"><a href="cleaning.html#cb99-7" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-8"><a href="cleaning.html#cb99-8" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb99-9"><a href="cleaning.html#cb99-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb99-10"><a href="cleaning.html#cb99-10" tabindex="-1"></a>  <span class="fu">full_join</span>(satsa_cog) <span class="sc">%&gt;%</span></span>
<span id="cb99-11"><a href="cleaning.html#cb99-11" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value)) <span class="sc">%&gt;%</span></span>
<span id="cb99-12"><a href="cleaning.html#cb99-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> p_year <span class="sc">-</span> yearBrth</span>
<span id="cb99-13"><a href="cleaning.html#cb99-13" tabindex="-1"></a>         , <span class="at">o_year =</span> <span class="dv">2005</span>)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="cleaning.html#cb100-1" tabindex="-1"></a>satsa_combined</span></code></pre></div>
<pre><code>## # A tibble: 14,109 × 27
##      SID Trait p_year p_value Outcome  o_value o_year smokes alcohol cancer diabetes heartProb married
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1  1292 A       1984    4    dementia       0   2005      0       0      1        0         1       1
##  2  1292 C       1984    4    dementia       0   2005      0       0      1        0         1       1
##  3  1292 E       1984    3.67 dementia       0   2005      0       0      1        0         1       1
##  4  1292 N       1984    4.33 dementia       0   2005      0       0      1        0         1       1
##  5  1292 O       1984    3.5  dementia       0   2005      0       0      1        0         1       1
##  6  1292 SWL     1984    2.54 dementia       0   2005      0       0      1        0         1       1
##  7  1701 C       1984    5    dementia       0   2005      0       0      0        0         1      NA
##  8  1701 E       1984    3.89 dementia       0   2005      0       0      0        0         1      NA
##  9  1701 N       1984    4    dementia       0   2005      0       0      0        0         1      NA
## 10  1701 O       1984    1    dementia       0   2005      0       0      0        0         1      NA
## # ℹ 14,099 more rows
## # ℹ 14 more variables: parkinsons &lt;dbl&gt;, respProb &lt;dbl&gt;, stroke &lt;dbl&gt;, gender &lt;dbl&gt;, education &lt;dbl&gt;,
## #   mmse &lt;dbl&gt;, yearBrth &lt;dbl&gt;, SRhealth &lt;dbl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, BMI &lt;dbl&gt;, dementia &lt;dbl&gt;,
## #   cognition &lt;dbl&gt;, age &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="cleaning.html#cb102-1" tabindex="-1"></a><span class="fu">save</span>(satsa_cov, satsa_alpha, satsa_pers, satsa_out, satsa_combined, satsa_cog,</span>
<span id="cb102-2"><a href="cleaning.html#cb102-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/satsa_cleaned.RData&quot;</span>, load_path))</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="cleaning.html#cb103-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;satsa&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="adrc-memory-and-aging-project-adrc-map" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> ADRC Memory and Aging Project (ADRC-MAP)<a href="cleaning.html#adrc-memory-and-aging-project-adrc-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Alzheimer Disease Research Center Memory and Aging Project (ADRC-MAP) is an ongoing longitudinal study of memory and Alzheimer’s Disease that began in 1979. Data are available on a study-by-study basis through application from <a href="https://knightadrc.wustl.edu/Research/ResourceRequest.htm" class="uri">https://knightadrc.wustl.edu/Research/ResourceRequest.htm</a>.</p>
<p>Participants were recruited from the Charles and Joanne F. Knight Alzheimer’s Disease Research Center at Washington University in St. Louis as part of an ongoing study of disease progression. The current study uses a subset of approximately 1200 of these participants who completed personality surveys as part of a substudy (see Duchek et al., 2019). More information on the study can be found at <a href="https://knightadrc.wustl.edu/Research/PDFs/Clinical%20Core%20list%20of%20measures.pdf" class="uri">https://knightadrc.wustl.edu/Research/PDFs/Clinical%20Core%20list%20of%20measures.pdf</a>.</p>
<p>Sample sizes vary over time, from approximately 400 to 1200. This provides 99% power to detect a zero-order correlation effect size of ~.15, two-tailed at alpha .05.</p>
<div id="load-data-3" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Load Data<a href="cleaning.html#load-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="cleaning.html#cb104-1" tabindex="-1"></a>(adrc_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;ADRC&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## # A tibble: 106 × 15
##    study dataset category  name     itemname year  orig_itemname description scale reverse_code recode  mini
##    &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 ADRC  NA      cognition cogniti… waisBlc… long… PSY021        &quot;WAIS BLOC… Rang… no           ifels…    NA
##  2 ADRC  NA      cognition cogniti… waisInfo long… PSY019        &quot;WAIS INFO… Rang… no           ifels…    NA
##  3 ADRC  NA      cognition cogniti… waisRDi… long… DIGSYM        &quot;WAIS-R DI… Rang… no           ifels…    NA
##  4 ADRC  NA      cognition cogniti… digFrwd… long… DIGFORCT      &quot;NUMBER SP… Rang… no           ifels…    NA
##  5 ADRC  NA      cognition cogniti… digBckw… long… DIGBACCT      &quot;NUMBER SP… Rang… no           ifels…    NA
##  6 ADRC  NA      cognition cogniti… trailMa… long… TRAILA        &quot;The score… Rang… no           ifels…    NA
##  7 ADRC  NA      cognition cogniti… trailMa… long… TRAILB        &quot;The score… Rang… no           ifels…    NA
##  8 ADRC  NA      cognition cogniti… cuedRec… long… SRT1C         &quot;Free &amp; Cu… Rang… no           ifels…    NA
##  9 ADRC  NA      cognition cogniti… cuedRec… long… SRT2C         &quot;Free &amp; Cu… Rang… no           ifels…    NA
## 10 ADRC  NA      cognition cogniti… cuedRec… long… SRT3C         &quot;Free &amp; Cu… Rang… no           ifels…    NA
## # ℹ 96 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="cleaning.html#cb106-1" tabindex="-1"></a>adrc_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(file){</span>
<span id="cb106-2"><a href="cleaning.html#cb106-2" tabindex="-1"></a>  <span class="fu">print</span>(file)</span>
<span id="cb106-3"><a href="cleaning.html#cb106-3" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/adrc-map/%s&quot;</span>, data_path, file) <span class="sc">%&gt;%</span> <span class="fu">read_excel</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb106-4"><a href="cleaning.html#cb106-4" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> id, <span class="fu">one_of</span>(<span class="fu">c</span>(<span class="st">&quot;TESTDATE&quot;</span>, old.names)), <span class="fu">contains</span>(<span class="st">&quot;NEO Date&quot;</span>))</span>
<span id="cb106-5"><a href="cleaning.html#cb106-5" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;TESTDATE&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(d)){ <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">class</span>(d<span class="sc">$</span>TESTDATE) <span class="sc">!=</span> <span class="st">&quot;numeric&quot;</span>)){d<span class="sc">$</span>TESTDATE <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(d<span class="sc">$</span>TESTDATE)}}</span>
<span id="cb106-6"><a href="cleaning.html#cb106-6" tabindex="-1"></a>  d</span>
<span id="cb106-7"><a href="cleaning.html#cb106-7" tabindex="-1"></a>}</span>
<span id="cb106-8"><a href="cleaning.html#cb106-8" tabindex="-1"></a></span>
<span id="cb106-9"><a href="cleaning.html#cb106-9" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(adrc_codebook<span class="sc">$</span>orig_itemname)</span>
<span id="cb106-10"><a href="cleaning.html#cb106-10" tabindex="-1"></a>adrc <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">file =</span> <span class="fu">list.files</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/adrc-map&quot;</span>, data_path), <span class="at">pattern =</span> <span class="st">&quot;.xlsx&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-11"><a href="cleaning.html#cb106-11" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;NEO&quot;</span>, file)) <span class="sc">%&gt;%</span></span>
<span id="cb106-12"><a href="cleaning.html#cb106-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(file, adrc_read_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb106-13"><a href="cleaning.html#cb106-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">map_dbl</span>(data, ncol) <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb106-14"><a href="cleaning.html#cb106-14" tabindex="-1"></a></span>
<span id="cb106-15"><a href="cleaning.html#cb106-15" tabindex="-1"></a>waves <span class="ot">&lt;-</span> adrc <span class="sc">%&gt;%</span></span>
<span id="cb106-16"><a href="cleaning.html#cb106-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(SID, <span class="fu">one_of</span>(<span class="st">&quot;TESTDATE&quot;</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb106-17"><a href="cleaning.html#cb106-17" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>file) <span class="sc">%&gt;%</span></span>
<span id="cb106-18"><a href="cleaning.html#cb106-18" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb106-19"><a href="cleaning.html#cb106-19" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb106-20"><a href="cleaning.html#cb106-20" tabindex="-1"></a>  <span class="co"># mutate(year = lubridate::year(TESTDATE)) %&gt;%</span></span>
<span id="cb106-21"><a href="cleaning.html#cb106-21" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-22"><a href="cleaning.html#cb106-22" tabindex="-1"></a>  <span class="fu">arrange</span>(SID, TESTDATE) <span class="sc">%&gt;%</span></span>
<span id="cb106-23"><a href="cleaning.html#cb106-23" tabindex="-1"></a>  <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb106-24"><a href="cleaning.html#cb106-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">frstyear =</span> <span class="fu">min</span>(TESTDATE)) <span class="sc">%&gt;%</span></span>
<span id="cb106-25"><a href="cleaning.html#cb106-25" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-26"><a href="cleaning.html#cb106-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> TESTDATE, </span>
<span id="cb106-27"><a href="cleaning.html#cb106-27" tabindex="-1"></a>         <span class="at">wave =</span> year <span class="sc">-</span> frstyear <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb106-28"><a href="cleaning.html#cb106-28" tabindex="-1"></a></span>
<span id="cb106-29"><a href="cleaning.html#cb106-29" tabindex="-1"></a>adrc_long <span class="ot">&lt;-</span> <span class="fu">reduce</span>(adrc<span class="sc">$</span>data, full_join) <span class="sc">%&gt;%</span></span>
<span id="cb106-30"><a href="cleaning.html#cb106-30" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-31"><a href="cleaning.html#cb106-31" tabindex="-1"></a>  <span class="fu">select</span>(SID, <span class="at">year =</span> TESTDATE, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb106-32"><a href="cleaning.html#cb106-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BIRTH =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(BIRTH)) <span class="sc">%&gt;%</span></span>
<span id="cb106-33"><a href="cleaning.html#cb106-33" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>SID, <span class="sc">-</span>year)</span>
<span id="cb106-34"><a href="cleaning.html#cb106-34" tabindex="-1"></a>               , <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb106-35"><a href="cleaning.html#cb106-35" tabindex="-1"></a>               , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb106-36"><a href="cleaning.html#cb106-36" tabindex="-1"></a></span>
<span id="cb106-37"><a href="cleaning.html#cb106-37" tabindex="-1"></a><span class="co"># load personality data separately</span></span>
<span id="cb106-38"><a href="cleaning.html#cb106-38" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> (adrc_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>))<span class="sc">$</span>orig_itemname</span>
<span id="cb106-39"><a href="cleaning.html#cb106-39" tabindex="-1"></a>adrc_pers <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/adrc-map/NEO - Raw Scores_FINAL.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb106-40"><a href="cleaning.html#cb106-40" tabindex="-1"></a>  <span class="fu">read_xlsx</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-41"><a href="cleaning.html#cb106-41" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">SID =</span> id, <span class="at">date =</span> <span class="st">`</span><span class="at">NEO Date 1</span><span class="st">`</span>, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb106-42"><a href="cleaning.html#cb106-42" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;[//]&quot;</span>, date), <span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(date, <span class="at">format =</span> <span class="st">&quot;%m/%d/%Y&quot;</span>)), date),</span>
<span id="cb106-43"><a href="cleaning.html#cb106-43" tabindex="-1"></a>         <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">as.numeric</span>(date), <span class="at">origin=</span><span class="st">&quot;1899-12-30&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-44"><a href="cleaning.html#cb106-44" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(date))</span>
<span id="cb106-45"><a href="cleaning.html#cb106-45" tabindex="-1"></a><span class="co"># get waves for participants</span></span>
<span id="cb106-46"><a href="cleaning.html#cb106-46" tabindex="-1"></a>adrc_pers_waves <span class="ot">&lt;-</span> adrc_pers <span class="sc">%&gt;%</span></span>
<span id="cb106-47"><a href="cleaning.html#cb106-47" tabindex="-1"></a>  <span class="fu">select</span>(SID, <span class="at">p_year =</span> date) <span class="sc">%&gt;%</span></span>
<span id="cb106-48"><a href="cleaning.html#cb106-48" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-49"><a href="cleaning.html#cb106-49" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(p_year))</span></code></pre></div>
</div>
<div id="recode-reverse-scoring" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Recode &amp; Reverse-Scoring<a href="cleaning.html#recode-reverse-scoring" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="cleaning.html#cb107-1" tabindex="-1"></a>adrc_recode <span class="ot">&lt;-</span> adrc_codebook <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="cleaning.html#cb107-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;cognition&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(orig_itemname)) <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="cleaning.html#cb107-3" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="cleaning.html#cb107-4" tabindex="-1"></a>  <span class="fu">right_join</span>(adrc_long) <span class="sc">%&gt;%</span></span>
<span id="cb107-5"><a href="cleaning.html#cb107-5" tabindex="-1"></a>  <span class="fu">left_join</span>(adrc_pers_waves)</span>
<span id="cb107-6"><a href="cleaning.html#cb107-6" tabindex="-1"></a></span>
<span id="cb107-7"><a href="cleaning.html#cb107-7" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb107-8"><a href="cleaning.html#cb107-8" tabindex="-1"></a></span>
<span id="cb107-9"><a href="cleaning.html#cb107-9" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb107-10"><a href="cleaning.html#cb107-10" tabindex="-1"></a>  <span class="co"># print(rule)</span></span>
<span id="cb107-11"><a href="cleaning.html#cb107-11" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb107-12"><a href="cleaning.html#cb107-12" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb107-13"><a href="cleaning.html#cb107-13" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb107-14"><a href="cleaning.html#cb107-14" tabindex="-1"></a>}</span>
<span id="cb107-15"><a href="cleaning.html#cb107-15" tabindex="-1"></a></span>
<span id="cb107-16"><a href="cleaning.html#cb107-16" tabindex="-1"></a>adrc_recode <span class="ot">&lt;-</span> adrc_recode <span class="sc">%&gt;%</span></span>
<span id="cb107-17"><a href="cleaning.html#cb107-17" tabindex="-1"></a>  <span class="fu">group_by</span>(recode, year) <span class="sc">%&gt;%</span></span>
<span id="cb107-18"><a href="cleaning.html#cb107-18" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-19"><a href="cleaning.html#cb107-19" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-20"><a href="cleaning.html#cb107-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb107-21"><a href="cleaning.html#cb107-21" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb107-22"><a href="cleaning.html#cb107-22" tabindex="-1"></a></span>
<span id="cb107-23"><a href="cleaning.html#cb107-23" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb107-24"><a href="cleaning.html#cb107-24" tabindex="-1"></a>adrc_recode <span class="ot">&lt;-</span> adrc_recode <span class="sc">%&gt;%</span></span>
<span id="cb107-25"><a href="cleaning.html#cb107-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb107-26"><a href="cleaning.html#cb107-26" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi))) <span class="sc">%&gt;%</span></span>
<span id="cb107-27"><a href="cleaning.html#cb107-27" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb107-28"><a href="cleaning.html#cb107-28" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-29"><a href="cleaning.html#cb107-29" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb107-30"><a href="cleaning.html#cb107-30" tabindex="-1"></a></span>
<span id="cb107-31"><a href="cleaning.html#cb107-31" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb107-32"><a href="cleaning.html#cb107-32" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb107-33"><a href="cleaning.html#cb107-33" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb107-34"><a href="cleaning.html#cb107-34" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb107-35"><a href="cleaning.html#cb107-35" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb107-36"><a href="cleaning.html#cb107-36" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb107-37"><a href="cleaning.html#cb107-37" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb107-38"><a href="cleaning.html#cb107-38" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb107-39"><a href="cleaning.html#cb107-39" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb107-40"><a href="cleaning.html#cb107-40" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-4" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Covariates<a href="cleaning.html#covariates-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="cleaning.html#cb108-1" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/adrc_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="cleaning.html#cb109-1" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb109-2"><a href="cleaning.html#cb109-2" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb109-3"><a href="cleaning.html#cb109-3" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="cleaning.html#cb109-4" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb109-5"><a href="cleaning.html#cb109-5" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year, p_year, long_rule) <span class="sc">%&gt;%</span> </span>
<span id="cb109-6"><a href="cleaning.html#cb109-6" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb109-7"><a href="cleaning.html#cb109-7" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-8"><a href="cleaning.html#cb109-8" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb109-9"><a href="cleaning.html#cb109-9" tabindex="-1"></a>}</span>
<span id="cb109-10"><a href="cleaning.html#cb109-10" tabindex="-1"></a></span>
<span id="cb109-11"><a href="cleaning.html#cb109-11" tabindex="-1"></a>adrc_cov <span class="ot">&lt;-</span> adrc_recode <span class="sc">%&gt;%</span></span>
<span id="cb109-12"><a href="cleaning.html#cb109-12" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-13"><a href="cleaning.html#cb109-13" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb109-14"><a href="cleaning.html#cb109-14" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb109-15"><a href="cleaning.html#cb109-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule) <span class="sc">|</span> comp_rule <span class="sc">==</span> <span class="st">&quot;none&quot;</span>, <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb109-16"><a href="cleaning.html#cb109-16" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb109-17"><a href="cleaning.html#cb109-17" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb109-18"><a href="cleaning.html#cb109-18" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb109-19"><a href="cleaning.html#cb109-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb109-20"><a href="cleaning.html#cb109-20" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb109-21"><a href="cleaning.html#cb109-21" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span>
<span id="cb109-22"><a href="cleaning.html#cb109-22" tabindex="-1"></a></span>
<span id="cb109-23"><a href="cleaning.html#cb109-23" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb109-24"><a href="cleaning.html#cb109-24" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb109-25"><a href="cleaning.html#cb109-25" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb109-26"><a href="cleaning.html#cb109-26" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb109-27"><a href="cleaning.html#cb109-27" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb109-28"><a href="cleaning.html#cb109-28" tabindex="-1"></a>}</span>
<span id="cb109-29"><a href="cleaning.html#cb109-29" tabindex="-1"></a></span>
<span id="cb109-30"><a href="cleaning.html#cb109-30" tabindex="-1"></a>adrc_cov <span class="ot">&lt;-</span> adrc_cov <span class="sc">%&gt;%</span></span>
<span id="cb109-31"><a href="cleaning.html#cb109-31" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb109-32"><a href="cleaning.html#cb109-32" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb109-33"><a href="cleaning.html#cb109-33" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb109-34"><a href="cleaning.html#cb109-34" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-35"><a href="cleaning.html#cb109-35" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, long_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb109-36"><a href="cleaning.html#cb109-36" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb109-37"><a href="cleaning.html#cb109-37" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb109-38"><a href="cleaning.html#cb109-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb109-39"><a href="cleaning.html#cb109-39" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(<span class="at">value =</span> max)) <span class="sc">%&gt;%</span></span>
<span id="cb109-40"><a href="cleaning.html#cb109-40" tabindex="-1"></a>  <span class="fu">right_join</span>(adrc_pers_waves) <span class="sc">%&gt;%</span></span>
<span id="cb109-41"><a href="cleaning.html#cb109-41" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> p_year <span class="sc">-</span> yearBrth)</span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="cleaning.html#cb110-1" tabindex="-1"></a>adrc_cov</span></code></pre></div>
<pre><code>## # A tibble: 1,162 × 15
##      SID gender yearBrth alcohol cancer diabetes education heartProb married  race smokes stroke weight
##    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1  1070      0     1918       1      1        0        17         1       1     0      0      0    187
##  2  1088      0     1916       1      1        0        16         1       1     0      0      0    217
##  3  1380      1     1913       1      1        0        16         1       0     0      0      0    129
##  4 10018      0     1929       0      0        0        14         1       1     0      1      0    156
##  5 10034      0     1930       0      1        0        16         0       1     0      0      0    193
##  6 10037      1     1923       1      1        0        13         1       1     0      1      0    179
##  7 10038      0     1927       1      0        0        18         0       1     0      0      0    205
##  8 10045      1     1931       1      1        0        16         0       1     0      1      0    160
##  9 10054      1     1930       0      1        0        13         1       1     0      1      0    173
## 10 10064      0     1928       1      1        0        20         1       1     0      1      0    199
## # ℹ 1,152 more rows
## # ℹ 2 more variables: p_year &lt;dbl&gt;, age &lt;dbl&gt;</code></pre>
</div>
<div id="personality-variables-4" class="section level3 hasAnchor" number="2.5.4">
<h3><span class="header-section-number">2.5.4</span> Personality Variables<a href="cleaning.html#personality-variables-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="cleaning.html#cb112-1" tabindex="-1"></a><span class="co"># bring in codebook info</span></span>
<span id="cb112-2"><a href="cleaning.html#cb112-2" tabindex="-1"></a>adrc_pers <span class="ot">&lt;-</span> adrc_pers <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="cleaning.html#cb112-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="st">`</span><span class="at">1S1</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">1S60</span><span class="st">`</span></span>
<span id="cb112-4"><a href="cleaning.html#cb112-4" tabindex="-1"></a>               , <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb112-5"><a href="cleaning.html#cb112-5" tabindex="-1"></a>               , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb112-6"><a href="cleaning.html#cb112-6" tabindex="-1"></a>               , <span class="at">values_drop_na =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb112-7"><a href="cleaning.html#cb112-7" tabindex="-1"></a>  <span class="fu">left_join</span>(adrc_codebook <span class="sc">%&gt;%</span> <span class="fu">select</span>(name<span class="sc">:</span>orig_itemname, reverse_code<span class="sc">:</span>maxi))</span>
<span id="cb112-8"><a href="cleaning.html#cb112-8" tabindex="-1"></a></span>
<span id="cb112-9"><a href="cleaning.html#cb112-9" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y){</span>
<span id="cb112-10"><a href="cleaning.html#cb112-10" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb112-11"><a href="cleaning.html#cb112-11" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb112-12"><a href="cleaning.html#cb112-12" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb112-13"><a href="cleaning.html#cb112-13" tabindex="-1"></a>}</span>
<span id="cb112-14"><a href="cleaning.html#cb112-14" tabindex="-1"></a></span>
<span id="cb112-15"><a href="cleaning.html#cb112-15" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb112-16"><a href="cleaning.html#cb112-16" tabindex="-1"></a>adrc_pers <span class="ot">&lt;-</span> adrc_pers <span class="sc">%&gt;%</span></span>
<span id="cb112-17"><a href="cleaning.html#cb112-17" tabindex="-1"></a>  <span class="fu">group_by</span>(recode) <span class="sc">%&gt;%</span></span>
<span id="cb112-18"><a href="cleaning.html#cb112-18" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb112-19"><a href="cleaning.html#cb112-19" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb112-20"><a href="cleaning.html#cb112-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(recode, data, recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb112-21"><a href="cleaning.html#cb112-21" tabindex="-1"></a>  <span class="fu">unnest</span>(data) </span>
<span id="cb112-22"><a href="cleaning.html#cb112-22" tabindex="-1"></a></span>
<span id="cb112-23"><a href="cleaning.html#cb112-23" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb112-24"><a href="cleaning.html#cb112-24" tabindex="-1"></a>adrc_pers <span class="ot">&lt;-</span> adrc_pers <span class="sc">%&gt;%</span></span>
<span id="cb112-25"><a href="cleaning.html#cb112-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">tolower</span>(reverse_code) <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb112-26"><a href="cleaning.html#cb112-26" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))</span>
<span id="cb112-27"><a href="cleaning.html#cb112-27" tabindex="-1"></a></span>
<span id="cb112-28"><a href="cleaning.html#cb112-28" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb112-29"><a href="cleaning.html#cb112-29" tabindex="-1"></a>adrc_alpha <span class="ot">&lt;-</span> adrc_pers <span class="sc">%&gt;%</span></span>
<span id="cb112-30"><a href="cleaning.html#cb112-30" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, date, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb112-31"><a href="cleaning.html#cb112-31" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb112-32"><a href="cleaning.html#cb112-32" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb112-33"><a href="cleaning.html#cb112-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value)),</span>
<span id="cb112-34"><a href="cleaning.html#cb112-34" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID, <span class="sc">-</span>date)), <span class="cn">NA_real_</span>)))</span>
<span id="cb112-35"><a href="cleaning.html#cb112-35" tabindex="-1"></a></span>
<span id="cb112-36"><a href="cleaning.html#cb112-36" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb112-37"><a href="cleaning.html#cb112-37" tabindex="-1"></a>adrc_pers <span class="ot">&lt;-</span> adrc_pers <span class="sc">%&gt;%</span></span>
<span id="cb112-38"><a href="cleaning.html#cb112-38" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, date) <span class="sc">%&gt;%</span></span>
<span id="cb112-39"><a href="cleaning.html#cb112-39" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T))  <span class="sc">%&gt;%</span></span>
<span id="cb112-40"><a href="cleaning.html#cb112-40" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb112-41"><a href="cleaning.html#cb112-41" tabindex="-1"></a>  <span class="fu">left_join</span>(adrc_pers_waves)</span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="cleaning.html#cb113-1" tabindex="-1"></a>adrc_pers</span></code></pre></div>
<pre><code>## # A tibble: 5,730 × 5
##      SID name  date       value p_year
##    &lt;dbl&gt; &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;
##  1  1070 A     2003-10-28  4.08   2003
##  2  1070 C     2003-10-28  4.83   2003
##  3  1070 E     2003-10-28  4.08   2003
##  4  1070 N     2003-10-28  1.08   2003
##  5  1070 O     2003-10-28  3.17   2003
##  6  1088 A     2005-04-18  4.5    2005
##  7  1088 C     2005-04-18  3.42   2005
##  8  1088 E     2005-04-18  3.08   2005
##  9  1088 N     2005-04-18  1.25   2005
## 10  1088 O     2005-04-18  3.08   2005
## # ℹ 5,720 more rows</code></pre>
</div>
<div id="outcome-variables-4" class="section level3 hasAnchor" number="2.5.5">
<h3><span class="header-section-number">2.5.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="cleaning.html#cb115-1" tabindex="-1"></a>adrc_out <span class="ot">&lt;-</span> adrc_recode <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="cleaning.html#cb115-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="cleaning.html#cb115-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb115-4"><a href="cleaning.html#cb115-4" tabindex="-1"></a></span>
<span id="cb115-5"><a href="cleaning.html#cb115-5" tabindex="-1"></a>adrc_out_waves <span class="ot">&lt;-</span> adrc_out <span class="sc">%&gt;%</span></span>
<span id="cb115-6"><a href="cleaning.html#cb115-6" tabindex="-1"></a>  <span class="fu">select</span>(year, SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb115-7"><a href="cleaning.html#cb115-7" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb115-8"><a href="cleaning.html#cb115-8" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-9"><a href="cleaning.html#cb115-9" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb115-10"><a href="cleaning.html#cb115-10" tabindex="-1"></a></span>
<span id="cb115-11"><a href="cleaning.html#cb115-11" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb115-12"><a href="cleaning.html#cb115-12" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb115-13"><a href="cleaning.html#cb115-13" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb115-14"><a href="cleaning.html#cb115-14" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb115-15"><a href="cleaning.html#cb115-15" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year, long_rule, p_year) <span class="sc">%&gt;%</span> </span>
<span id="cb115-16"><a href="cleaning.html#cb115-16" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb115-17"><a href="cleaning.html#cb115-17" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb115-18"><a href="cleaning.html#cb115-18" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb115-19"><a href="cleaning.html#cb115-19" tabindex="-1"></a>}</span>
<span id="cb115-20"><a href="cleaning.html#cb115-20" tabindex="-1"></a></span>
<span id="cb115-21"><a href="cleaning.html#cb115-21" tabindex="-1"></a>adrc_out <span class="ot">&lt;-</span> adrc_out <span class="sc">%&gt;%</span></span>
<span id="cb115-22"><a href="cleaning.html#cb115-22" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb115-23"><a href="cleaning.html#cb115-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule) <span class="sc">|</span> comp_rule <span class="sc">==</span> <span class="st">&quot;none&quot;</span>, <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb115-24"><a href="cleaning.html#cb115-24" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb115-25"><a href="cleaning.html#cb115-25" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-26"><a href="cleaning.html#cb115-26" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-27"><a href="cleaning.html#cb115-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb115-28"><a href="cleaning.html#cb115-28" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb115-29"><a href="cleaning.html#cb115-29" tabindex="-1"></a></span>
<span id="cb115-30"><a href="cleaning.html#cb115-30" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb115-31"><a href="cleaning.html#cb115-31" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb115-32"><a href="cleaning.html#cb115-32" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb115-33"><a href="cleaning.html#cb115-33" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb115-34"><a href="cleaning.html#cb115-34" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb115-35"><a href="cleaning.html#cb115-35" tabindex="-1"></a>}</span>
<span id="cb115-36"><a href="cleaning.html#cb115-36" tabindex="-1"></a></span>
<span id="cb115-37"><a href="cleaning.html#cb115-37" tabindex="-1"></a>adrc_out <span class="ot">&lt;-</span> adrc_out <span class="sc">%&gt;%</span></span>
<span id="cb115-38"><a href="cleaning.html#cb115-38" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-39"><a href="cleaning.html#cb115-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">ifelse</span>(year <span class="sc">&lt;=</span> p_year, <span class="st">&quot;past&quot;</span>, <span class="st">&quot;future&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb115-40"><a href="cleaning.html#cb115-40" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, group, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb115-41"><a href="cleaning.html#cb115-41" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb115-42"><a href="cleaning.html#cb115-42" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-43"><a href="cleaning.html#cb115-43" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb115-44"><a href="cleaning.html#cb115-44" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb115-45"><a href="cleaning.html#cb115-45" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb115-46"><a href="cleaning.html#cb115-46" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(past) <span class="sc">|</span> (past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(future)), future,</span>
<span id="cb115-47"><a href="cleaning.html#cb115-47" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(future), past, </span>
<span id="cb115-48"><a href="cleaning.html#cb115-48" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb115-49"><a href="cleaning.html#cb115-49" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-50"><a href="cleaning.html#cb115-50" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb115-51"><a href="cleaning.html#cb115-51" tabindex="-1"></a>    adrc_out <span class="sc">%&gt;%</span></span>
<span id="cb115-52"><a href="cleaning.html#cb115-52" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">&quot;dementia&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value) <span class="sc">&amp;</span> year <span class="sc">&gt;=</span> p_year) <span class="sc">%&gt;%</span> </span>
<span id="cb115-53"><a href="cleaning.html#cb115-53" tabindex="-1"></a>      <span class="fu">group_by</span>(long_rule, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb115-54"><a href="cleaning.html#cb115-54" tabindex="-1"></a>      <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb115-55"><a href="cleaning.html#cb115-55" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb115-56"><a href="cleaning.html#cb115-56" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, long_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb115-57"><a href="cleaning.html#cb115-57" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb115-58"><a href="cleaning.html#cb115-58" tabindex="-1"></a>      <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb115-59"><a href="cleaning.html#cb115-59" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb115-60"><a href="cleaning.html#cb115-60" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb115-61"><a href="cleaning.html#cb115-61" tabindex="-1"></a>  <span class="fu">left_join</span>(adrc_out_waves)</span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="cleaning.html#cb116-1" tabindex="-1"></a>adrc_out</span></code></pre></div>
<pre><code>## # A tibble: 2,575 × 8
##      SID name     p_year future  past  `NA` value o_year
##    &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  1070 dementia   2003      1     0    NA     1   2019
##  2  1088 dementia   2005      1     1    NA    NA   2015
##  3  1380 dementia   2003      1     0    NA     1   2013
##  4 10018 dementia   2005      0     0    NA     0   2018
##  5 10034 dementia   2004      0     0    NA     0   2020
##  6 10037 dementia   2006      1     0    NA     1   2019
##  7 10038 dementia   2003      1     0    NA     1   2016
##  8 10045 dementia   2003      1     1    NA    NA   2018
##  9 10054 dementia   2008      0     0    NA     0   2012
## 10 10064 dementia   2003      1     0    NA     1   2018
## # ℹ 2,565 more rows</code></pre>
</div>
<div id="cognition-variables-4" class="section level3 hasAnchor" number="2.5.6">
<h3><span class="header-section-number">2.5.6</span> Cognition Variables<a href="cleaning.html#cognition-variables-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="cleaning.html#cb118-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb118-2"><a href="cleaning.html#cb118-2" tabindex="-1"></a>adrc_cog <span class="ot">&lt;-</span> adrc_recode <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="cleaning.html#cb118-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="cleaning.html#cb118-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb118-5"><a href="cleaning.html#cb118-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb118-6"><a href="cleaning.html#cb118-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_year)) <span class="sc">%&gt;%</span></span>
<span id="cb118-7"><a href="cleaning.html#cb118-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb118-8"><a href="cleaning.html#cb118-8" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, year) <span class="sc">%&gt;%</span></span>
<span id="cb118-9"><a href="cleaning.html#cb118-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb118-10"><a href="cleaning.html#cb118-10" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, itemname) <span class="sc">%&gt;%</span></span>
<span id="cb118-11"><a href="cleaning.html#cb118-11" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> (p_year <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span>(p_year <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb118-12"><a href="cleaning.html#cb118-12" tabindex="-1"></a>  <span class="fu">group_by</span>(name, SID) <span class="sc">%&gt;%</span></span>
<span id="cb118-13"><a href="cleaning.html#cb118-13" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb118-14"><a href="cleaning.html#cb118-14" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-15"><a href="cleaning.html#cb118-15" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb118-16"><a href="cleaning.html#cb118-16" tabindex="-1"></a>              , <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="cleaning.html#cb119-1" tabindex="-1"></a>adrc_cog</span></code></pre></div>
<pre><code>## # A tibble: 1,023 × 2
##      SID cognition
##    &lt;dbl&gt;     &lt;dbl&gt;
##  1  1070      4.62
##  2  1088      3.40
##  3  1380      2.36
##  4 10018      5.59
##  5 10034      5.30
##  6 10037      4.64
##  7 10038      6.60
##  8 10045      8.52
##  9 10054      2.41
## 10 10064      7.36
## # ℹ 1,013 more rows</code></pre>
</div>
<div id="combine-data-4" class="section level3 hasAnchor" number="2.5.7">
<h3><span class="header-section-number">2.5.7</span> Combine Data<a href="cleaning.html#combine-data-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="cleaning.html#cb121-1" tabindex="-1"></a>adrc_combined <span class="ot">&lt;-</span> adrc_pers <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="cleaning.html#cb121-2" tabindex="-1"></a>  <span class="fu">select</span>(SID, <span class="at">Trait =</span> name, <span class="at">p_value =</span> value, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="cleaning.html#cb121-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb121-4"><a href="cleaning.html#cb121-4" tabindex="-1"></a>    adrc_out <span class="sc">%&gt;%</span> </span>
<span id="cb121-5"><a href="cleaning.html#cb121-5" tabindex="-1"></a>      <span class="fu">select</span>(SID, o_year, <span class="at">Outcome =</span> name, <span class="at">o_value =</span> value)</span>
<span id="cb121-6"><a href="cleaning.html#cb121-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb121-7"><a href="cleaning.html#cb121-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(o_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(p_value)) <span class="sc">%&gt;%</span></span>
<span id="cb121-8"><a href="cleaning.html#cb121-8" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb121-9"><a href="cleaning.html#cb121-9" tabindex="-1"></a>  <span class="fu">left_join</span>(adrc_cov) <span class="sc">%&gt;%</span></span>
<span id="cb121-10"><a href="cleaning.html#cb121-10" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb121-11"><a href="cleaning.html#cb121-11" tabindex="-1"></a>    adrc_out <span class="sc">%&gt;%</span></span>
<span id="cb121-12"><a href="cleaning.html#cb121-12" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-13"><a href="cleaning.html#cb121-13" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">rowSums</span>(<span class="fu">cbind</span>(future, past), <span class="at">na.rm =</span> T) <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb121-14"><a href="cleaning.html#cb121-14" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>future, <span class="sc">-</span>past) <span class="sc">%&gt;%</span></span>
<span id="cb121-15"><a href="cleaning.html#cb121-15" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb121-16"><a href="cleaning.html#cb121-16" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb121-17"><a href="cleaning.html#cb121-17" tabindex="-1"></a>  <span class="fu">left_join</span>(adrc_cog) <span class="sc">%&gt;%</span></span>
<span id="cb121-18"><a href="cleaning.html#cb121-18" tabindex="-1"></a>  <span class="fu">left_join</span>(adrc_out_waves <span class="sc">%&gt;%</span> <span class="fu">select</span>(SID, <span class="at">Outcome =</span> name, o_year))</span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="cleaning.html#cb122-1" tabindex="-1"></a>adrc_combined</span></code></pre></div>
<pre><code>## # A tibble: 11,145 × 23
##      SID Trait p_value p_year o_year Outcome       o_value gender yearBrth alcohol cancer diabetes education
##    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1  1070 A        4.08   2003   2019 dementia            1      0     1918       1      1        0        17
##  2  1070 C        4.83   2003   2019 dementia            1      0     1918       1      1        0        17
##  3  1070 E        4.08   2003   2019 dementia            1      0     1918       1      1        0        17
##  4  1070 N        1.08   2003   2019 dementia            1      0     1918       1      1        0        17
##  5  1070 O        3.17   2003   2019 dementia            1      0     1918       1      1        0        17
##  6  1088 A        4.5    2005   2015 angiopathy          0      0     1916       1      1        0        16
##  7  1088 A        4.5    2005   2015 arterioloscl…       1      0     1916       1      1        0        16
##  8  1088 A        4.5    2005   2015 atherosclero…       2      0     1916       1      1        0        16
##  9  1088 A        4.5    2005   2015 braak               3      0     1916       1      1        0        16
## 10  1088 A        4.5    2005   2015 hipSclerosis        0      0     1916       1      1        0        16
## # ℹ 11,135 more rows
## # ℹ 10 more variables: heartProb &lt;dbl&gt;, married &lt;dbl&gt;, race &lt;dbl&gt;, smokes &lt;dbl&gt;, stroke &lt;dbl&gt;,
## #   weight &lt;dbl&gt;, age &lt;dbl&gt;, `NA` &lt;dbl&gt;, dementia &lt;dbl&gt;, cognition &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="cleaning.html#cb124-1" tabindex="-1"></a><span class="fu">save</span>(adrc_cov, adrc_alpha, adrc_pers, adrc_out, adrc_combined, adrc_cog,</span>
<span id="cb124-2"><a href="cleaning.html#cb124-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/adrc_cleaned.RData&quot;</span>, load_path))</span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="cleaning.html#cb125-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;adrc&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="einstein-aging-study" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Einstein Aging Study<a href="cleaning.html#einstein-aging-study" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Einstein Aging Study (EAS) is an ongoing longitudinal study of the aging brain. The EAS began in 1980 and has enrolled more than 2,600 participants since then. Data are available through application at <a href="http://www.einstein.yu.edu/departments/neurology/clinical-research-program/eas/data-sharing.aspx" class="uri">http://www.einstein.yu.edu/departments/neurology/clinical-research-program/eas/data-sharing.aspx</a>.</p>
<p>Since 1993, the EAS has systematically recruited a representative aging sample in the Bronx, New York, As of 2017, 2,600 participants were enrolled in the study. As of 2010, approximately 200 of the enrolled participants had autopsy data. More information on the study can be found at <a href="http://www.einstein.yu.edu/departments/neurology/clinical-research-program/EAS/" class="uri">http://www.einstein.yu.edu/departments/neurology/clinical-research-program/EAS/</a>.</p>
<p>Sample sizes vary over time, with ranges across waves not publically available. However, we suspect approximately 2,000 participants to have basic personality and dementia diagnoses, with between 150 and 300 participants having full autopsy data collected after personality was introduced into the study. This yields 99% power to detect a zero-order correlation effect size of .10 and .24, respectively, two-tailed at alpha .05.</p>
<div id="load-data-4" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Load Data<a href="cleaning.html#load-data-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="cleaning.html#cb126-1" tabindex="-1"></a>(eas_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;EAS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## # A tibble: 78 × 15
##    study dataset  category   name   itemname year  orig_itemname description scale reverse_code recode  mini
##    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 EAS   behavior cognition  cogni… waisBlk… long… Blockraw      &quot;WAIS III:… &quot;int… &lt;NA&gt;         ifels…    NA
##  2 EAS   behavior cognition  cogni… trailma… long… Tr-A1         &quot;Other Wor… &quot;int… &lt;NA&gt;         ifels…    NA
##  3 EAS   behavior cognition  cogni… trailma… long… Tr-B1         &quot;Other Wor… &quot;int… &lt;NA&gt;         ifels…    NA
##  4 EAS   behavior cognition  cogni… digitSym long… Symraw        &quot;Digit Sym… &quot;int… &lt;NA&gt;         ifels…    NA
##  5 EAS   behavior cognition  cogni… recall   long… TotRecall     &quot;total Rec… &quot;int… &lt;NA&gt;         ifels…    NA
##  6 EAS   behavior cognition  cogni… SPN      long… Spnraw        &quot;Digit Spa… &quot;int… &lt;NA&gt;         ifels…    NA
##  7 EAS   behavior cognition  cogni… CAT      long… CAT            &lt;NA&gt;       &quot;int… &lt;NA&gt;         ifels…    NA
##  8 EAS   behavior cognition  cogni… FAS      long… FAS            &lt;NA&gt;       &quot;int… &lt;NA&gt;         ifels…    NA
##  9 EAS   behavior covariates alcoh… alcohol… base… SAB262        &quot;What was … &quot;1=N… no           ifels…    NA
## 10 EAS   behavior covariates alcoh… alcohol… base… SAB263        &quot;What was … &quot;1=N… no           ifels…    NA
## # ℹ 68 more rows
## # ℹ 3 more variables: maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="cleaning.html#cb128-1" tabindex="-1"></a>old.names1 <span class="ot">&lt;-</span> <span class="fu">unique</span>((eas_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">&quot;behavior&quot;</span>))<span class="sc">$</span>orig_itemname)</span>
<span id="cb128-2"><a href="cleaning.html#cb128-2" tabindex="-1"></a>old.names2 <span class="ot">&lt;-</span> <span class="fu">unique</span>((eas_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">&quot;neuropath&quot;</span>))<span class="sc">$</span>orig_itemname)</span>
<span id="cb128-3"><a href="cleaning.html#cb128-3" tabindex="-1"></a>old.names3 <span class="ot">&lt;-</span> <span class="fu">unique</span>((eas_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(dataset <span class="sc">==</span> <span class="st">&quot;activity&quot;</span>))<span class="sc">$</span>orig_itemname)</span>
<span id="cb128-4"><a href="cleaning.html#cb128-4" tabindex="-1"></a>eas <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/eas/Behavior_with_Master_Data_2021_10_25.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb128-5"><a href="cleaning.html#cb128-5" tabindex="-1"></a>  <span class="fu">read_excel</span>(., <span class="at">sheet =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-6"><a href="cleaning.html#cb128-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(BehaviorDate)) <span class="sc">%&gt;%</span></span>
<span id="cb128-7"><a href="cleaning.html#cb128-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">SID =</span> Id, <span class="at">wave =</span> Wave, year, <span class="fu">one_of</span>(old.names1)) <span class="sc">%&gt;%</span></span>
<span id="cb128-8"><a href="cleaning.html#cb128-8" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb128-9"><a href="cleaning.html#cb128-9" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">&quot;%s/eas/Neuropath_and_Behavior_Data_2021_09_26 (3).xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb128-10"><a href="cleaning.html#cb128-10" tabindex="-1"></a>      <span class="fu">read_excel</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb128-11"><a href="cleaning.html#cb128-11" tabindex="-1"></a>      <span class="fu">select</span>(<span class="at">SID =</span> <span class="st">`</span><span class="at">Clin#</span><span class="st">`</span>, <span class="at">year =</span> DOD, <span class="at">wave =</span> Wave, <span class="fu">one_of</span>(old.names2)) <span class="sc">%&gt;%</span></span>
<span id="cb128-12"><a href="cleaning.html#cb128-12" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">comb_dx =</span> <span class="fu">ifelse</span>(<span class="fu">c</span>(<span class="st">&quot;VaD&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;AGD&quot;</span>) <span class="sc">%in%</span> Dx1 <span class="sc">|</span> <span class="fu">c</span>(<span class="st">&quot;VaD&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;AGD&quot;</span>) <span class="sc">%in%</span> Dx2 <span class="sc">|</span> </span>
<span id="cb128-13"><a href="cleaning.html#cb128-13" tabindex="-1"></a>                                <span class="fu">c</span>(<span class="st">&quot;VaD&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;AGD&quot;</span>) <span class="sc">%in%</span> Dx3 <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;VaD&quot;</span>, <span class="st">`</span><span class="at">OTHER Dx</span><span class="st">`</span>) <span class="sc">|</span> </span>
<span id="cb128-14"><a href="cleaning.html#cb128-14" tabindex="-1"></a>                                <span class="fu">grepl</span>(<span class="st">&quot;AD&quot;</span>, <span class="st">`</span><span class="at">OTHER Dx</span><span class="st">`</span>) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;AGD&quot;</span>, <span class="st">`</span><span class="at">OTHER Dx</span><span class="st">`</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb128-15"><a href="cleaning.html#cb128-15" tabindex="-1"></a>             , <span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb128-16"><a href="cleaning.html#cb128-16" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>(Dx1<span class="sc">:</span><span class="st">`</span><span class="at">OTHER Dx</span><span class="st">`</span>))</span>
<span id="cb128-17"><a href="cleaning.html#cb128-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-18"><a href="cleaning.html#cb128-18" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb128-19"><a href="cleaning.html#cb128-19" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">&quot;%s/eas/Northwestern_supp_Physical_Activities_2021_10_25-1.xlsx&quot;</span>, data_path) <span class="sc">%&gt;%</span> </span>
<span id="cb128-20"><a href="cleaning.html#cb128-20" tabindex="-1"></a>      <span class="fu">read_excel</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb128-21"><a href="cleaning.html#cb128-21" tabindex="-1"></a>      <span class="fu">select</span>(<span class="at">SID =</span> Id, <span class="at">wave =</span> Wave, <span class="fu">one_of</span>(old.names3))</span>
<span id="cb128-22"><a href="cleaning.html#cb128-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-23"><a href="cleaning.html#cb128-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">ifelse</span>(Gender <span class="sc">==</span> <span class="st">&quot;F&quot;</span>, <span class="dv">1</span>, <span class="fu">ifelse</span>(Gender <span class="sc">==</span> <span class="st">&quot;M&quot;</span>, <span class="dv">0</span>, <span class="cn">NA</span>)))</span>
<span id="cb128-24"><a href="cleaning.html#cb128-24" tabindex="-1"></a></span>
<span id="cb128-25"><a href="cleaning.html#cb128-25" tabindex="-1"></a>eas_waves <span class="ot">&lt;-</span> eas <span class="sc">%&gt;%</span> <span class="fu">select</span>(SID, wave, year) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb128-26"><a href="cleaning.html#cb128-26" tabindex="-1"></a></span>
<span id="cb128-27"><a href="cleaning.html#cb128-27" tabindex="-1"></a>eas_long <span class="ot">&lt;-</span> eas <span class="sc">%&gt;%</span></span>
<span id="cb128-28"><a href="cleaning.html#cb128-28" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb128-29"><a href="cleaning.html#cb128-29" tabindex="-1"></a>               , <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb128-30"><a href="cleaning.html#cb128-30" tabindex="-1"></a>               , <span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>SID, <span class="sc">-</span>wave, <span class="sc">-</span>year))</span></code></pre></div>
</div>
<div id="recode-reverse-scoring-1" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Recode &amp; Reverse-Scoring<a href="cleaning.html#recode-reverse-scoring-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="cleaning.html#cb129-1" tabindex="-1"></a>eas_recode <span class="ot">&lt;-</span> eas_codebook <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="cleaning.html#cb129-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;cognition&quot;</span>, <span class="st">&quot;pers&quot;</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(orig_itemname)) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="cleaning.html#cb129-3" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb129-4"><a href="cleaning.html#cb129-4" tabindex="-1"></a>  <span class="fu">right_join</span>(eas_long) </span>
<span id="cb129-5"><a href="cleaning.html#cb129-5" tabindex="-1"></a></span>
<span id="cb129-6"><a href="cleaning.html#cb129-6" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb129-7"><a href="cleaning.html#cb129-7" tabindex="-1"></a></span>
<span id="cb129-8"><a href="cleaning.html#cb129-8" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb129-9"><a href="cleaning.html#cb129-9" tabindex="-1"></a>  <span class="fu">print</span>(rule)</span>
<span id="cb129-10"><a href="cleaning.html#cb129-10" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb129-11"><a href="cleaning.html#cb129-11" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb129-12"><a href="cleaning.html#cb129-12" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb129-13"><a href="cleaning.html#cb129-13" tabindex="-1"></a>}</span>
<span id="cb129-14"><a href="cleaning.html#cb129-14" tabindex="-1"></a></span>
<span id="cb129-15"><a href="cleaning.html#cb129-15" tabindex="-1"></a>eas_recode <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb129-16"><a href="cleaning.html#cb129-16" tabindex="-1"></a>  <span class="fu">group_by</span>(recode, year) <span class="sc">%&gt;%</span></span>
<span id="cb129-17"><a href="cleaning.html#cb129-17" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-18"><a href="cleaning.html#cb129-18" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-19"><a href="cleaning.html#cb129-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb129-20"><a href="cleaning.html#cb129-20" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb129-21"><a href="cleaning.html#cb129-21" tabindex="-1"></a></span>
<span id="cb129-22"><a href="cleaning.html#cb129-22" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb129-23"><a href="cleaning.html#cb129-23" tabindex="-1"></a>eas_recode <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb129-24"><a href="cleaning.html#cb129-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb129-25"><a href="cleaning.html#cb129-25" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi))) <span class="sc">%&gt;%</span></span>
<span id="cb129-26"><a href="cleaning.html#cb129-26" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span></span>
<span id="cb129-27"><a href="cleaning.html#cb129-27" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb129-28"><a href="cleaning.html#cb129-28" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb129-29"><a href="cleaning.html#cb129-29" tabindex="-1"></a></span>
<span id="cb129-30"><a href="cleaning.html#cb129-30" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb129-31"><a href="cleaning.html#cb129-31" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb129-32"><a href="cleaning.html#cb129-32" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb129-33"><a href="cleaning.html#cb129-33" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb129-34"><a href="cleaning.html#cb129-34" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb129-35"><a href="cleaning.html#cb129-35" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb129-36"><a href="cleaning.html#cb129-36" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb129-37"><a href="cleaning.html#cb129-37" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb129-38"><a href="cleaning.html#cb129-38" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb129-39"><a href="cleaning.html#cb129-39" tabindex="-1"></a>}</span>
<span id="cb129-40"><a href="cleaning.html#cb129-40" tabindex="-1"></a></span>
<span id="cb129-41"><a href="cleaning.html#cb129-41" tabindex="-1"></a>eas_p_waves <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span> </span>
<span id="cb129-42"><a href="cleaning.html#cb129-42" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-43"><a href="cleaning.html#cb129-43" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb129-44"><a href="cleaning.html#cb129-44" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb129-45"><a href="cleaning.html#cb129-45" tabindex="-1"></a>  <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb129-46"><a href="cleaning.html#cb129-46" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">min</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb129-47"><a href="cleaning.html#cb129-47" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb129-48"><a href="cleaning.html#cb129-48" tabindex="-1"></a>  <span class="fu">select</span>(SID, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb129-49"><a href="cleaning.html#cb129-49" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
</div>
<div id="covariates-5" class="section level3 hasAnchor" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Covariates<a href="cleaning.html#covariates-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="cleaning.html#cb130-1" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb130-2"><a href="cleaning.html#cb130-2" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb130-3"><a href="cleaning.html#cb130-3" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="cleaning.html#cb130-4" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb130-5"><a href="cleaning.html#cb130-5" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year, p_year, long_rule) <span class="sc">%&gt;%</span> </span>
<span id="cb130-6"><a href="cleaning.html#cb130-6" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb130-7"><a href="cleaning.html#cb130-7" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-8"><a href="cleaning.html#cb130-8" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb130-9"><a href="cleaning.html#cb130-9" tabindex="-1"></a>}</span>
<span id="cb130-10"><a href="cleaning.html#cb130-10" tabindex="-1"></a></span>
<span id="cb130-11"><a href="cleaning.html#cb130-11" tabindex="-1"></a>eas_cov <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb130-12"><a href="cleaning.html#cb130-12" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-13"><a href="cleaning.html#cb130-13" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb130-14"><a href="cleaning.html#cb130-14" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_p_waves) <span class="sc">%&gt;%</span></span>
<span id="cb130-15"><a href="cleaning.html#cb130-15" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year) <span class="sc">%&gt;%</span></span>
<span id="cb130-16"><a href="cleaning.html#cb130-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule) <span class="sc">|</span> comp_rule <span class="sc">==</span> <span class="st">&quot;none&quot;</span>, <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb130-17"><a href="cleaning.html#cb130-17" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb130-18"><a href="cleaning.html#cb130-18" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb130-19"><a href="cleaning.html#cb130-19" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb130-20"><a href="cleaning.html#cb130-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb130-21"><a href="cleaning.html#cb130-21" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb130-22"><a href="cleaning.html#cb130-22" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule)</span>
<span id="cb130-23"><a href="cleaning.html#cb130-23" tabindex="-1"></a></span>
<span id="cb130-24"><a href="cleaning.html#cb130-24" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, rule){</span>
<span id="cb130-25"><a href="cleaning.html#cb130-25" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb130-26"><a href="cleaning.html#cb130-26" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb130-27"><a href="cleaning.html#cb130-27" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb130-28"><a href="cleaning.html#cb130-28" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb130-29"><a href="cleaning.html#cb130-29" tabindex="-1"></a>}</span>
<span id="cb130-30"><a href="cleaning.html#cb130-30" tabindex="-1"></a></span>
<span id="cb130-31"><a href="cleaning.html#cb130-31" tabindex="-1"></a>eas_cov <span class="ot">&lt;-</span> eas_cov <span class="sc">%&gt;%</span></span>
<span id="cb130-32"><a href="cleaning.html#cb130-32" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb130-33"><a href="cleaning.html#cb130-33" tabindex="-1"></a>  <span class="fu">group_by</span>(long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb130-34"><a href="cleaning.html#cb130-34" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb130-35"><a href="cleaning.html#cb130-35" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-36"><a href="cleaning.html#cb130-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, long_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb130-37"><a href="cleaning.html#cb130-37" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb130-38"><a href="cleaning.html#cb130-38" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb130-39"><a href="cleaning.html#cb130-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb130-40"><a href="cleaning.html#cb130-40" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(<span class="at">value =</span> max)) <span class="sc">%&gt;%</span></span>
<span id="cb130-41"><a href="cleaning.html#cb130-41" tabindex="-1"></a>  <span class="fu">right_join</span>(eas_p_waves) </span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="cleaning.html#cb131-1" tabindex="-1"></a>eas_cov</span></code></pre></div>
<pre><code>## # A tibble: 799 × 17
##      SID alcohol cancer diabetes heartProb hypertension married  race smokes stroke exercise   BMI   age
##    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  6075       0      0        0         0            0       1     0      0      0       NA  21.1  73.4
##  2  8024       1      0        0         0            0       1     0      1      0       NA  28.8  94.8
##  3  8027       1      0        0         0            0       1     0      0      0       NA  20.4  93.0
##  4  8265       1      1        1         0            1       1     0      1      0       NA  28.5  77.3
##  5  8291       0      0        0         0            0       1     0      0      0       NA  24    81.7
##  6  8296       1      0        0         0            0       1     0      0      0       NA  23    88.9
##  7  8310       1      0        1         0            0       1     0      1      0       NA  29.4  86.0
##  8  8313       1      0        0         0            0       1     1      1      0       NA  NA    87.3
##  9  8375       1      1        0         0           NA       1     0      0      0       NA  26.3  87.2
## 10  8512       1      0        0         0            1       1     1      1      0       NA  NA    78.9
## # ℹ 789 more rows
## # ℹ 4 more variables: education &lt;dbl&gt;, SRhealth &lt;dbl&gt;, gender &lt;dbl&gt;, p_year &lt;dbl&gt;</code></pre>
</div>
<div id="personality-variables-5" class="section level3 hasAnchor" number="2.6.4">
<h3><span class="header-section-number">2.6.4</span> Personality Variables<a href="cleaning.html#personality-variables-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="cleaning.html#cb133-1" tabindex="-1"></a><span class="co"># bring in codebook info</span></span>
<span id="cb133-2"><a href="cleaning.html#cb133-2" tabindex="-1"></a>eas_pers <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span> </span>
<span id="cb133-3"><a href="cleaning.html#cb133-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb133-4"><a href="cleaning.html#cb133-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb133-5"><a href="cleaning.html#cb133-5" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_p_waves) <span class="sc">%&gt;%</span> </span>
<span id="cb133-6"><a href="cleaning.html#cb133-6" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> p_year)</span>
<span id="cb133-7"><a href="cleaning.html#cb133-7" tabindex="-1"></a></span>
<span id="cb133-8"><a href="cleaning.html#cb133-8" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb133-9"><a href="cleaning.html#cb133-9" tabindex="-1"></a>eas_pers <span class="ot">&lt;-</span> eas_pers <span class="sc">%&gt;%</span></span>
<span id="cb133-10"><a href="cleaning.html#cb133-10" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb133-11"><a href="cleaning.html#cb133-11" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T))  <span class="sc">%&gt;%</span></span>
<span id="cb133-12"><a href="cleaning.html#cb133-12" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code></pre></div>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="cleaning.html#cb134-1" tabindex="-1"></a>eas_pers</span></code></pre></div>
<pre><code>## # A tibble: 3,995 × 4
##      SID name  p_year value
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1  6075 A       2016   3.6
##  2  6075 C       2016   3.4
##  3  6075 E       2016   2.5
##  4  6075 N       2016   2.8
##  5  6075 O       2016   3.1
##  6  8024 A       2006   3.7
##  7  8024 C       2006   4.1
##  8  8024 E       2006   2.7
##  9  8024 N       2006   2.7
## 10  8024 O       2006   2.9
## # ℹ 3,985 more rows</code></pre>
</div>
<div id="outcome-variables-5" class="section level3 hasAnchor" number="2.6.5">
<h3><span class="header-section-number">2.6.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="cleaning.html#cb136-1" tabindex="-1"></a>eas_out <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb136-2"><a href="cleaning.html#cb136-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-3"><a href="cleaning.html#cb136-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb136-4"><a href="cleaning.html#cb136-4" tabindex="-1"></a></span>
<span id="cb136-5"><a href="cleaning.html#cb136-5" tabindex="-1"></a>eas_out_waves <span class="ot">&lt;-</span> eas_out <span class="sc">%&gt;%</span></span>
<span id="cb136-6"><a href="cleaning.html#cb136-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb136-7"><a href="cleaning.html#cb136-7" tabindex="-1"></a>  <span class="fu">select</span>(year, SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb136-8"><a href="cleaning.html#cb136-8" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb136-9"><a href="cleaning.html#cb136-9" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-10"><a href="cleaning.html#cb136-10" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb136-11"><a href="cleaning.html#cb136-11" tabindex="-1"></a></span>
<span id="cb136-12"><a href="cleaning.html#cb136-12" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb136-13"><a href="cleaning.html#cb136-13" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb136-14"><a href="cleaning.html#cb136-14" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb136-15"><a href="cleaning.html#cb136-15" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb136-16"><a href="cleaning.html#cb136-16" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year, long_rule, p_year) <span class="sc">%&gt;%</span> </span>
<span id="cb136-17"><a href="cleaning.html#cb136-17" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb136-18"><a href="cleaning.html#cb136-18" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb136-19"><a href="cleaning.html#cb136-19" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb136-20"><a href="cleaning.html#cb136-20" tabindex="-1"></a>}</span>
<span id="cb136-21"><a href="cleaning.html#cb136-21" tabindex="-1"></a></span>
<span id="cb136-22"><a href="cleaning.html#cb136-22" tabindex="-1"></a>eas_out <span class="ot">&lt;-</span> eas_out <span class="sc">%&gt;%</span></span>
<span id="cb136-23"><a href="cleaning.html#cb136-23" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_p_waves) <span class="sc">%&gt;%</span></span>
<span id="cb136-24"><a href="cleaning.html#cb136-24" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb136-25"><a href="cleaning.html#cb136-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule) <span class="sc">|</span> comp_rule <span class="sc">==</span> <span class="st">&quot;none&quot;</span>, <span class="st">&quot;skip&quot;</span>, comp_rule)) <span class="sc">%&gt;%</span></span>
<span id="cb136-26"><a href="cleaning.html#cb136-26" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb136-27"><a href="cleaning.html#cb136-27" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb136-28"><a href="cleaning.html#cb136-28" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb136-29"><a href="cleaning.html#cb136-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb136-30"><a href="cleaning.html#cb136-30" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb136-31"><a href="cleaning.html#cb136-31" tabindex="-1"></a></span>
<span id="cb136-32"><a href="cleaning.html#cb136-32" tabindex="-1"></a>eas_out <span class="ot">&lt;-</span> eas_out <span class="sc">%&gt;%</span></span>
<span id="cb136-33"><a href="cleaning.html#cb136-33" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-34"><a href="cleaning.html#cb136-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">ifelse</span>(year <span class="sc">&lt;=</span> p_year, <span class="st">&quot;past&quot;</span>, <span class="st">&quot;future&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb136-35"><a href="cleaning.html#cb136-35" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, group, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb136-36"><a href="cleaning.html#cb136-36" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb136-37"><a href="cleaning.html#cb136-37" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb136-38"><a href="cleaning.html#cb136-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb136-39"><a href="cleaning.html#cb136-39" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb136-40"><a href="cleaning.html#cb136-40" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb136-41"><a href="cleaning.html#cb136-41" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(past) <span class="sc">|</span> (past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(future)), future,</span>
<span id="cb136-42"><a href="cleaning.html#cb136-42" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(future), past, </span>
<span id="cb136-43"><a href="cleaning.html#cb136-43" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb136-44"><a href="cleaning.html#cb136-44" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb136-45"><a href="cleaning.html#cb136-45" tabindex="-1"></a>  <span class="fu">full_join</span>(eas_out <span class="sc">%&gt;%</span></span>
<span id="cb136-46"><a href="cleaning.html#cb136-46" tabindex="-1"></a>    <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-47"><a href="cleaning.html#cb136-47" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, long_rule, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb136-48"><a href="cleaning.html#cb136-48" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb136-49"><a href="cleaning.html#cb136-49" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb136-50"><a href="cleaning.html#cb136-50" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb136-51"><a href="cleaning.html#cb136-51" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb136-52"><a href="cleaning.html#cb136-52" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb136-53"><a href="cleaning.html#cb136-53" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_out_waves) <span class="sc">%&gt;%</span></span>
<span id="cb136-54"><a href="cleaning.html#cb136-54" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value))</span></code></pre></div>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="cleaning.html#cb137-1" tabindex="-1"></a>eas_out</span></code></pre></div>
<pre><code>## # A tibble: 878 × 8
##      SID name     p_year  past future  `NA` value o_year
##    &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  8024 dementia   2006     0     NA    NA     0   2006
##  2  8027 dementia   2009     0      1    NA     1   2017
##  3  8265 dementia   2006     0      0    NA     0   2011
##  4  8291 dementia   2009     0      0    NA     0   2012
##  5  8296 dementia   2006     0     NA    NA     0   2006
##  6  8310 dementia   2007     0     NA    NA     0   2007
##  7  8313 dementia   2007     0     NA    NA     0   2007
##  8  8375 dementia   2006     0      0    NA     0   2010
##  9  8512 dementia   2010     0      0    NA     0   2013
## 10  8518 dementia   2011     0     NA    NA     0   2011
## # ℹ 868 more rows</code></pre>
</div>
<div id="cognition-variables-5" class="section level3 hasAnchor" number="2.6.6">
<h3><span class="header-section-number">2.6.6</span> Cognition Variables<a href="cleaning.html#cognition-variables-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="cleaning.html#cb139-1" tabindex="-1"></a><span class="co"># composite within years</span></span>
<span id="cb139-2"><a href="cleaning.html#cb139-2" tabindex="-1"></a>eas_cog <span class="ot">&lt;-</span> eas_recode <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="cleaning.html#cb139-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-4"><a href="cleaning.html#cb139-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category) <span class="sc">%&gt;%</span></span>
<span id="cb139-5"><a href="cleaning.html#cb139-5" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb139-6"><a href="cleaning.html#cb139-6" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_p_waves) <span class="sc">%&gt;%</span></span>
<span id="cb139-7"><a href="cleaning.html#cb139-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_year) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb139-8"><a href="cleaning.html#cb139-8" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, year) <span class="sc">%&gt;%</span></span>
<span id="cb139-9"><a href="cleaning.html#cb139-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb139-10"><a href="cleaning.html#cb139-10" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, itemname) <span class="sc">%&gt;%</span></span>
<span id="cb139-11"><a href="cleaning.html#cb139-11" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> (p_year <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span>(p_year <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb139-12"><a href="cleaning.html#cb139-12" tabindex="-1"></a>  <span class="fu">group_by</span>(name, SID) <span class="sc">%&gt;%</span></span>
<span id="cb139-13"><a href="cleaning.html#cb139-13" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb139-14"><a href="cleaning.html#cb139-14" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb139-15"><a href="cleaning.html#cb139-15" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span></span>
<span id="cb139-16"><a href="cleaning.html#cb139-16" tabindex="-1"></a>              , <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="cleaning.html#cb140-1" tabindex="-1"></a>eas_cog</span></code></pre></div>
<pre><code>## # A tibble: 799 × 2
##      SID cognition
##    &lt;dbl&gt;     &lt;dbl&gt;
##  1  6075      5.78
##  2  8024      4.83
##  3  8027      4.55
##  4  8265      5.60
##  5  8291      4.64
##  6  8296      5.20
##  7  8310      4.16
##  8  8313      4.37
##  9  8375      6.10
## 10  8512      3.62
## # ℹ 789 more rows</code></pre>
</div>
<div id="combine-data-5" class="section level3 hasAnchor" number="2.6.7">
<h3><span class="header-section-number">2.6.7</span> Combine Data<a href="cleaning.html#combine-data-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="cleaning.html#cb142-1" tabindex="-1"></a>eas_combined <span class="ot">&lt;-</span> eas_pers <span class="sc">%&gt;%</span> </span>
<span id="cb142-2"><a href="cleaning.html#cb142-2" tabindex="-1"></a>  <span class="fu">select</span>(SID, <span class="at">Trait =</span> name, <span class="at">p_value =</span> value, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb142-3"><a href="cleaning.html#cb142-3" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb142-4"><a href="cleaning.html#cb142-4" tabindex="-1"></a>    eas_out <span class="sc">%&gt;%</span> </span>
<span id="cb142-5"><a href="cleaning.html#cb142-5" tabindex="-1"></a>      <span class="fu">select</span>(SID, o_year, <span class="at">Outcome =</span> name, <span class="at">o_value =</span> value)</span>
<span id="cb142-6"><a href="cleaning.html#cb142-6" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb142-7"><a href="cleaning.html#cb142-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(o_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(p_value)) <span class="sc">%&gt;%</span></span>
<span id="cb142-8"><a href="cleaning.html#cb142-8" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb142-9"><a href="cleaning.html#cb142-9" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb142-10"><a href="cleaning.html#cb142-10" tabindex="-1"></a>    eas_out <span class="sc">%&gt;%</span></span>
<span id="cb142-11"><a href="cleaning.html#cb142-11" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb142-12"><a href="cleaning.html#cb142-12" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">rowSums</span>(<span class="fu">cbind</span>(future, past), <span class="at">na.rm =</span> T) <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb142-13"><a href="cleaning.html#cb142-13" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>future, <span class="sc">-</span>past) <span class="sc">%&gt;%</span></span>
<span id="cb142-14"><a href="cleaning.html#cb142-14" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb142-15"><a href="cleaning.html#cb142-15" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb142-16"><a href="cleaning.html#cb142-16" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_cov) <span class="sc">%&gt;%</span></span>
<span id="cb142-17"><a href="cleaning.html#cb142-17" tabindex="-1"></a>  <span class="fu">left_join</span>(eas_cog) </span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="cleaning.html#cb143-1" tabindex="-1"></a>eas_combined</span></code></pre></div>
<pre><code>## # A tibble: 4,320 × 25
##      SID Trait p_value p_year o_year Outcome      o_value  `NA` dementia alcohol cancer diabetes heartProb
##    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1  8024 A         3.7   2006   2006 dementia         0      NA        0       1      0        0         0
##  2  8024 C         4.1   2006   2006 dementia         0      NA        0       1      0        0         0
##  3  8024 E         2.7   2006   2006 dementia         0      NA        0       1      0        0         0
##  4  8024 N         2.7   2006   2006 dementia         0      NA        0       1      0        0         0
##  5  8024 O         2.9   2006   2006 dementia         0      NA        0       1      0        0         0
##  6  8027 A         3.2   2009   2017 dementia         1      NA        1       1      0        0         0
##  7  8027 A         3.2   2009   2017 braak            5.5    NA        1       1      0        0         0
##  8  8027 A         3.2   2009   2017 hipSclerosis     0      NA        1       1      0        0         0
##  9  8027 A         3.2   2009   2017 lewyBodyDis      1      NA        1       1      0        0         0
## 10  8027 C         3.4   2009   2017 dementia         1      NA        1       1      0        0         0
## # ℹ 4,310 more rows
## # ℹ 12 more variables: hypertension &lt;dbl&gt;, married &lt;dbl&gt;, race &lt;dbl&gt;, smokes &lt;dbl&gt;, stroke &lt;dbl&gt;,
## #   exercise &lt;dbl&gt;, BMI &lt;dbl&gt;, age &lt;dbl&gt;, education &lt;dbl&gt;, SRhealth &lt;dbl&gt;, gender &lt;dbl&gt;, cognition &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="cleaning.html#cb145-1" tabindex="-1"></a><span class="fu">save</span>(eas_cov, eas_pers, eas_out, eas_combined, eas_cog,</span>
<span id="cb145-2"><a href="cleaning.html#cb145-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/eas_cleaned.RData&quot;</span>, load_path))</span></code></pre></div>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="cleaning.html#cb146-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;eas&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="german-socioeconomic-panel-study-gsoep" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> German Socioeconomic Panel Study (GSOEP)<a href="cleaning.html#german-socioeconomic-panel-study-gsoep" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The German Socioeconomic Panel Study (GSOEP; Socio-Economic Panel, 2017) is an ongoing longitudinal study of German collected by the German Institute of Economic Research (DIW Berlin). The data are freely available at <a href="https://www.diw.de/soep" class="uri">https://www.diw.de/soep</a> by application.</p>
<p>Data have been collected annually since 1984 (the latest data release includes data up to 2017). Participants have been recruited from more than 11,000 households, which are nationally representative of private German households. 20,000 individuals are sampled each year, on average. It is critical to note that the GSOEP samples households, not individuals, and the households consist of individuals living in both the “old” and “new” federal states (the former West and East Germany), foreigners, and recent immigrants to Germany.</p>
<p>Sample size varies by year, ranging from approximately 10,000 (1989) to 31,000 (2013). This provides 99% power to detect a zero-order correlation effect size of ~.06, two-tailed at alpha &lt; .05.</p>
<div id="load-data-5" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Load Data<a href="cleaning.html#load-data-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="cleaning.html#cb147-1" tabindex="-1"></a>gsoep_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(Year, WL){</span>
<span id="cb147-2"><a href="cleaning.html#cb147-2" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> (gsoep_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> Year <span class="sc">|</span> category <span class="sc">==</span> <span class="st">&quot;proc&quot;</span>))<span class="sc">$</span>orig_itemname </span>
<span id="cb147-3"><a href="cleaning.html#cb147-3" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%sp.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb147-4"><a href="cleaning.html#cb147-4" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%skind.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb147-5"><a href="cleaning.html#cb147-5" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%spequiv.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb147-6"><a href="cleaning.html#cb147-6" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%spgen.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb147-7"><a href="cleaning.html#cb147-7" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%spkal.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb147-8"><a href="cleaning.html#cb147-8" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb147-9"><a href="cleaning.html#cb147-9" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>persnr, <span class="sc">-</span>hhnr, <span class="at">na.rm =</span> T)</span>
<span id="cb147-10"><a href="cleaning.html#cb147-10" tabindex="-1"></a>  </span>
<span id="cb147-11"><a href="cleaning.html#cb147-11" tabindex="-1"></a> <span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%shbrutto.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb147-12"><a href="cleaning.html#cb147-12" tabindex="-1"></a>    <span class="fu">full_join</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/%sh.sav&quot;</span>, data_path, WL) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb147-13"><a href="cleaning.html#cb147-13" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb147-14"><a href="cleaning.html#cb147-14" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>hhnr, <span class="at">na.rm =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb147-15"><a href="cleaning.html#cb147-15" tabindex="-1"></a>    <span class="fu">full_join</span>(p <span class="sc">%&gt;%</span> <span class="fu">select</span>(persnr, hhnr) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb147-16"><a href="cleaning.html#cb147-16" tabindex="-1"></a>    <span class="fu">full_join</span>(p) </span>
<span id="cb147-17"><a href="cleaning.html#cb147-17" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="cleaning.html#cb148-1" tabindex="-1"></a>gsoep_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;GSOEP&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb148-2"><a href="cleaning.html#cb148-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orig_itemname =</span> <span class="fu">str_to_lower</span>(orig_itemname))</span>
<span id="cb148-3"><a href="cleaning.html#cb148-3" tabindex="-1"></a>gsoep_codebook</span></code></pre></div>
<pre><code>## # A tibble: 594 × 17
##    study dataset category name  itemname  wave waveletter  year orig_itemname description scale reverse_code
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       
##  1 gosep cognit  cogniti… cogn… animals1    23 w           2006 f99z30r       Symbol Dig… inte… no          
##  2 gosep cognit  cogniti… cogn… animals1    29 bc          2012 f99z30r       Symbol Dig… inte… no          
##  3 gosep cognit  cogniti… cogn… animals2    23 w           2006 f99z60r       Symbol Dig… inte… no          
##  4 gosep cognit  cogniti… cogn… animals2    29 bc          2012 f99z60r       Symbol Dig… inte… no          
##  5 gosep cognit  cogniti… cogn… animals3    23 w           2006 f99z90r       Symbol Dig… inte… no          
##  6 gosep cognit  cogniti… cogn… animals3    29 bc          2012 f99z90r       Symbol Dig… inte… no          
##  7 gosep cognit  cogniti… cogn… symDig1     23 w           2006 f96t30g       Symbol Dig… inte… no          
##  8 gosep cognit  cogniti… cogn… symDig1     29 bc          2012 f96t30g       Symbol Dig… inte… no          
##  9 gosep cognit  cogniti… cogn… symDig2     23 w           2006 f96t60g       Symbol Dig… inte… no          
## 10 gosep cognit  cogniti… cogn… symDig2     29 bc          2012 f96t60g       Symbol Dig… inte… no          
## # ℹ 584 more rows
## # ℹ 5 more variables: recode &lt;chr&gt;, mini &lt;dbl&gt;, maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;, long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="cleaning.html#cb150-1" tabindex="-1"></a>gsoep <span class="ot">&lt;-</span> gsoep_codebook <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="cleaning.html#cb150-2" tabindex="-1"></a>  <span class="fu">select</span>(wave, waveletter, year) <span class="sc">%&gt;%</span></span>
<span id="cb150-3"><a href="cleaning.html#cb150-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb150-4"><a href="cleaning.html#cb150-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb150-5"><a href="cleaning.html#cb150-5" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb150-6"><a href="cleaning.html#cb150-6" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="st">&quot;2018&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb150-7"><a href="cleaning.html#cb150-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(year, waveletter, gsoep_read_fun)) </span>
<span id="cb150-8"><a href="cleaning.html#cb150-8" tabindex="-1"></a></span>
<span id="cb150-9"><a href="cleaning.html#cb150-9" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(gsoep_codebook<span class="sc">$</span>orig_itemname)</span>
<span id="cb150-10"><a href="cleaning.html#cb150-10" tabindex="-1"></a>gsoep_cog <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/gsoep/cognit.sav&quot;</span>, data_path) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb150-11"><a href="cleaning.html#cb150-11" tabindex="-1"></a>  <span class="fu">select</span>(persnr, hhnr, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb150-12"><a href="cleaning.html#cb150-12" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb150-13"><a href="cleaning.html#cb150-13" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hhnr) <span class="sc">%&gt;%</span></span>
<span id="cb150-14"><a href="cleaning.html#cb150-14" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, <span class="sc">-</span>persnr, <span class="at">na.rm =</span> T)</span>
<span id="cb150-15"><a href="cleaning.html#cb150-15" tabindex="-1"></a></span>
<span id="cb150-16"><a href="cleaning.html#cb150-16" tabindex="-1"></a>gsoep_long <span class="ot">&lt;-</span> gsoep <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb150-17"><a href="cleaning.html#cb150-17" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hhnr, <span class="sc">-</span>wave, <span class="sc">-</span>waveletter, <span class="sc">-</span>year) <span class="sc">%&gt;%</span></span>
<span id="cb150-18"><a href="cleaning.html#cb150-18" tabindex="-1"></a>  <span class="co"># filter(persnr %in% gsoep_cog_subs) %&gt;%</span></span>
<span id="cb150-19"><a href="cleaning.html#cb150-19" tabindex="-1"></a>  <span class="fu">full_join</span>(gsoep_cog) <span class="sc">%&gt;%</span></span>
<span id="cb150-20"><a href="cleaning.html#cb150-20" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">SID =</span> persnr)</span>
<span id="cb150-21"><a href="cleaning.html#cb150-21" tabindex="-1"></a></span>
<span id="cb150-22"><a href="cleaning.html#cb150-22" tabindex="-1"></a><span class="fu">save</span>(gsoep, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/gsoep_raw.RData&quot;</span>, load_path))</span>
<span id="cb150-23"><a href="cleaning.html#cb150-23" tabindex="-1"></a><span class="fu">rm</span>(gsoep)</span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-4" class="section level3 hasAnchor" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Recoding &amp; Reverse Scoring<a href="cleaning.html#recoding-reverse-scoring-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="cleaning.html#cb151-1" tabindex="-1"></a>gsoep_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;GSOEP&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb151-2"><a href="cleaning.html#cb151-2" tabindex="-1"></a></span>
<span id="cb151-3"><a href="cleaning.html#cb151-3" tabindex="-1"></a><span class="co"># join data with recoding info </span></span>
<span id="cb151-4"><a href="cleaning.html#cb151-4" tabindex="-1"></a>gsoep_recode <span class="ot">&lt;-</span> gsoep_codebook <span class="sc">%&gt;%</span></span>
<span id="cb151-5"><a href="cleaning.html#cb151-5" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;cognition&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb151-6"><a href="cleaning.html#cb151-6" tabindex="-1"></a>  <span class="fu">select</span>(category, name, itemname, wave, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb151-7"><a href="cleaning.html#cb151-7" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span> </span>
<span id="cb151-8"><a href="cleaning.html#cb151-8" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb151-9"><a href="cleaning.html#cb151-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb151-10"><a href="cleaning.html#cb151-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(gsoep_long))) </span>
<span id="cb151-11"><a href="cleaning.html#cb151-11" tabindex="-1"></a></span>
<span id="cb151-12"><a href="cleaning.html#cb151-12" tabindex="-1"></a><span class="co"># recode </span></span>
<span id="cb151-13"><a href="cleaning.html#cb151-13" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y, year){</span>
<span id="cb151-14"><a href="cleaning.html#cb151-14" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb151-15"><a href="cleaning.html#cb151-15" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb151-16"><a href="cleaning.html#cb151-16" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb151-17"><a href="cleaning.html#cb151-17" tabindex="-1"></a>}</span>
<span id="cb151-18"><a href="cleaning.html#cb151-18" tabindex="-1"></a></span>
<span id="cb151-19"><a href="cleaning.html#cb151-19" tabindex="-1"></a>gsoep_recode <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span> </span>
<span id="cb151-20"><a href="cleaning.html#cb151-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb151-21"><a href="cleaning.html#cb151-21" tabindex="-1"></a>    <span class="fu">group_by</span>(recode, year) <span class="sc">%&gt;%</span></span>
<span id="cb151-22"><a href="cleaning.html#cb151-22" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb151-23"><a href="cleaning.html#cb151-23" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb151-24"><a href="cleaning.html#cb151-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data, year), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb151-25"><a href="cleaning.html#cb151-25" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb151-26"><a href="cleaning.html#cb151-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb151-27"><a href="cleaning.html#cb151-27" tabindex="-1"></a></span>
<span id="cb151-28"><a href="cleaning.html#cb151-28" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb151-29"><a href="cleaning.html#cb151-29" tabindex="-1"></a>gsoep_recode <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb151-30"><a href="cleaning.html#cb151-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb151-31"><a href="cleaning.html#cb151-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(reverse_code <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb151-32"><a href="cleaning.html#cb151-32" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb151-33"><a href="cleaning.html#cb151-33" tabindex="-1"></a></span>
<span id="cb151-34"><a href="cleaning.html#cb151-34" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb151-35"><a href="cleaning.html#cb151-35" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb151-36"><a href="cleaning.html#cb151-36" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb151-37"><a href="cleaning.html#cb151-37" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb151-38"><a href="cleaning.html#cb151-38" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb151-39"><a href="cleaning.html#cb151-39" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb151-40"><a href="cleaning.html#cb151-40" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb151-41"><a href="cleaning.html#cb151-41" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb151-42"><a href="cleaning.html#cb151-42" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb151-43"><a href="cleaning.html#cb151-43" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-6" class="section level3 hasAnchor" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Covariates<a href="cleaning.html#covariates-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="cleaning.html#cb152-1" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/gsoep_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="cleaning.html#cb153-1" tabindex="-1"></a>yrBrth <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span> </span>
<span id="cb153-2"><a href="cleaning.html#cb153-2" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;yearBrth&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb153-3"><a href="cleaning.html#cb153-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb153-4"><a href="cleaning.html#cb153-4" tabindex="-1"></a>  <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span> </span>
<span id="cb153-5"><a href="cleaning.html#cb153-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">yearBrth =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb153-6"><a href="cleaning.html#cb153-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb153-7"><a href="cleaning.html#cb153-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yearBrth =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(yearBrth), <span class="cn">NA</span>, yearBrth),</span>
<span id="cb153-8"><a href="cleaning.html#cb153-8" tabindex="-1"></a>         <span class="at">yearBrth =</span> <span class="fu">ifelse</span>(yearBrth <span class="sc">&lt;</span> <span class="dv">1000</span>, yearBrth <span class="sc">+</span> <span class="dv">1000</span>, yearBrth)) </span>
<span id="cb153-9"><a href="cleaning.html#cb153-9" tabindex="-1"></a></span>
<span id="cb153-10"><a href="cleaning.html#cb153-10" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb153-11"><a href="cleaning.html#cb153-11" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule, name){</span>
<span id="cb153-12"><a href="cleaning.html#cb153-12" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(rule, name))</span>
<span id="cb153-13"><a href="cleaning.html#cb153-13" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb153-14"><a href="cleaning.html#cb153-14" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, yearBrth, year, long_rule) <span class="sc">%&gt;%</span> <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb153-15"><a href="cleaning.html#cb153-15" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb153-16"><a href="cleaning.html#cb153-16" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb153-17"><a href="cleaning.html#cb153-17" tabindex="-1"></a>}</span>
<span id="cb153-18"><a href="cleaning.html#cb153-18" tabindex="-1"></a></span>
<span id="cb153-19"><a href="cleaning.html#cb153-19" tabindex="-1"></a>gsoep_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;GSOEP&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb153-20"><a href="cleaning.html#cb153-20" tabindex="-1"></a></span>
<span id="cb153-21"><a href="cleaning.html#cb153-21" tabindex="-1"></a>gsoep_cov <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb153-22"><a href="cleaning.html#cb153-22" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb153-23"><a href="cleaning.html#cb153-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">&quot;alcohol&quot;</span>, <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">ifelse</span>(year <span class="sc">==</span> <span class="dv">2006</span>, <span class="dv">2005</span>, year))), data)) <span class="sc">%&gt;%</span></span>
<span id="cb153-24"><a href="cleaning.html#cb153-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb153-25"><a href="cleaning.html#cb153-25" tabindex="-1"></a>    <span class="fu">left_join</span>(yrBrth) <span class="sc">%&gt;%</span></span>
<span id="cb153-26"><a href="cleaning.html#cb153-26" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="fu">max</span>(gsoep_waves<span class="sc">$</span>Used) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb153-27"><a href="cleaning.html#cb153-27" tabindex="-1"></a>    <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb153-28"><a href="cleaning.html#cb153-28" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb153-29"><a href="cleaning.html#cb153-29" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb153-30"><a href="cleaning.html#cb153-30" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(comp_rule), <span class="st">&quot;skip&quot;</span>, comp_rule)))) <span class="sc">%&gt;%</span></span>
<span id="cb153-31"><a href="cleaning.html#cb153-31" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">map</span>(data, nrow) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb153-32"><a href="cleaning.html#cb153-32" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb153-33"><a href="cleaning.html#cb153-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(data, comp_rule, name), year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb153-34"><a href="cleaning.html#cb153-34" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb153-35"><a href="cleaning.html#cb153-35" tabindex="-1"></a></span>
<span id="cb153-36"><a href="cleaning.html#cb153-36" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, p_year){</span>
<span id="cb153-37"><a href="cleaning.html#cb153-37" tabindex="-1"></a>  gsoep_cov <span class="sc">%&gt;%</span></span>
<span id="cb153-38"><a href="cleaning.html#cb153-38" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year  <span class="sc">&amp;</span> long_rule <span class="sc">==</span> rule) <span class="sc">%&gt;%</span></span>
<span id="cb153-39"><a href="cleaning.html#cb153-39" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, yearBrth, name) <span class="sc">%&gt;%</span></span>
<span id="cb153-40"><a href="cleaning.html#cb153-40" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb153-41"><a href="cleaning.html#cb153-41" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb153-42"><a href="cleaning.html#cb153-42" tabindex="-1"></a>}</span>
<span id="cb153-43"><a href="cleaning.html#cb153-43" tabindex="-1"></a></span>
<span id="cb153-44"><a href="cleaning.html#cb153-44" tabindex="-1"></a>gsoep_cov <span class="ot">&lt;-</span> <span class="fu">crossing</span>(</span>
<span id="cb153-45"><a href="cleaning.html#cb153-45" tabindex="-1"></a>  <span class="at">p_year =</span> gsoep_waves<span class="sc">$</span>Used, </span>
<span id="cb153-46"><a href="cleaning.html#cb153-46" tabindex="-1"></a>  <span class="at">long_rule =</span> <span class="fu">unique</span>(gsoep_cov<span class="sc">$</span>long_rule)</span>
<span id="cb153-47"><a href="cleaning.html#cb153-47" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb153-48"><a href="cleaning.html#cb153-48" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(long_rule, p_year, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb153-49"><a href="cleaning.html#cb153-49" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb153-50"><a href="cleaning.html#cb153-50" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb153-51"><a href="cleaning.html#cb153-51" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule, <span class="sc">-</span>yearBrth) <span class="sc">%&gt;%</span></span>
<span id="cb153-52"><a href="cleaning.html#cb153-52" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb153-53"><a href="cleaning.html#cb153-53" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yearBrth =</span> <span class="fu">ifelse</span>(yearBrth <span class="sc">&lt;</span> <span class="dv">1000</span>, yearBrth <span class="sc">+</span> <span class="dv">1000</span>, yearBrth))</span></code></pre></div>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="cleaning.html#cb154-1" tabindex="-1"></a>gsoep_cov</span></code></pre></div>
<pre><code>## # A tibble: 114,106 × 16
##    p_year   SID exercise height weight cancer diabetes married stroke alcohol education smokes gender
##     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1   2005   101     1.67     NA     NA      0        0       1      0      NA        NA     NA      0
##  2   2005   102     1        NA     NA      0        0       1      0      NA        NA     NA      1
##  3   2005   103     2.67     NA     NA      0        0       0      0      NA        NA     NA      0
##  4   2005   201     2       157     61      0        0       0      0       1        11      0      1
##  5   2005   202     3        NA     NA      0        0       0      0      NA        NA     NA      1
##  6   2005   203     4       177     77      0        0       0      0       1        NA      0      0
##  7   2005   301     1        NA     NA      0        0       1      0      NA        NA     NA      0
##  8   2005   302     1        NA     NA      0        0       1      0      NA        NA     NA      1
##  9   2005   401     1        NA     NA      0        0       0      0      NA        NA     NA      0
## 10   2005   501     1        NA     NA      0        0       0      0      NA        NA     NA      1
## # ℹ 114,096 more rows
## # ℹ 3 more variables: yearBrth &lt;dbl&gt;, age &lt;dbl&gt;, SRhealth &lt;dbl&gt;</code></pre>
</div>
<div id="personality-variables-6" class="section level3 hasAnchor" number="2.7.4">
<h3><span class="header-section-number">2.7.4</span> Personality Variables<a href="cleaning.html#personality-variables-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="cleaning.html#cb156-1" tabindex="-1"></a>gsoep_pers <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href="cleaning.html#cb156-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb156-3"><a href="cleaning.html#cb156-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb156-4"><a href="cleaning.html#cb156-4" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> gsoep_waves<span class="sc">$</span>Used) <span class="sc">%&gt;%</span></span>
<span id="cb156-5"><a href="cleaning.html#cb156-5" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb156-6"><a href="cleaning.html#cb156-6" tabindex="-1"></a></span>
<span id="cb156-7"><a href="cleaning.html#cb156-7" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb156-8"><a href="cleaning.html#cb156-8" tabindex="-1"></a>gsoep_alpha <span class="ot">&lt;-</span> gsoep_pers <span class="sc">%&gt;%</span></span>
<span id="cb156-9"><a href="cleaning.html#cb156-9" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb156-10"><a href="cleaning.html#cb156-10" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb156-11"><a href="cleaning.html#cb156-11" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb156-12"><a href="cleaning.html#cb156-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value)),</span>
<span id="cb156-13"><a href="cleaning.html#cb156-13" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>persnr)), <span class="cn">NA_real_</span>)))</span>
<span id="cb156-14"><a href="cleaning.html#cb156-14" tabindex="-1"></a></span>
<span id="cb156-15"><a href="cleaning.html#cb156-15" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb156-16"><a href="cleaning.html#cb156-16" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb156-17"><a href="cleaning.html#cb156-17" tabindex="-1"></a>    <span class="fu">group_by</span>(SID) <span class="sc">%&gt;%</span></span>
<span id="cb156-18"><a href="cleaning.html#cb156-18" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb156-19"><a href="cleaning.html#cb156-19" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb156-20"><a href="cleaning.html#cb156-20" tabindex="-1"></a>}</span>
<span id="cb156-21"><a href="cleaning.html#cb156-21" tabindex="-1"></a></span>
<span id="cb156-22"><a href="cleaning.html#cb156-22" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb156-23"><a href="cleaning.html#cb156-23" tabindex="-1"></a>gsoep_pers <span class="ot">&lt;-</span> gsoep_pers <span class="sc">%&gt;%</span></span>
<span id="cb156-24"><a href="cleaning.html#cb156-24" tabindex="-1"></a>  <span class="fu">group_by</span>(name, comp_rule, year) <span class="sc">%&gt;%</span></span>
<span id="cb156-25"><a href="cleaning.html#cb156-25" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb156-26"><a href="cleaning.html#cb156-26" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb156-27"><a href="cleaning.html#cb156-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb156-28"><a href="cleaning.html#cb156-28" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb156-29"><a href="cleaning.html#cb156-29" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb156-30"><a href="cleaning.html#cb156-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="cleaning.html#cb157-1" tabindex="-1"></a>gsoep_pers</span></code></pre></div>
<pre><code>## # A tibble: 191,511 × 4
##    name   year   SID value
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 A      2005   201  7   
##  2 A      2005   203  4.67
##  3 A      2005   602  4.33
##  4 A      2005   901  4.67
##  5 A      2005  1202  7   
##  6 A      2005  1501  4.67
##  7 A      2005  1601  4   
##  8 A      2005  1602  6.67
##  9 A      2005  1603  4.33
## 10 A      2005  1701  7   
## # ℹ 191,501 more rows</code></pre>
</div>
<div id="outcome-variables-6" class="section level3 hasAnchor" number="2.7.5">
<h3><span class="header-section-number">2.7.5</span> Outcome Variables<a href="cleaning.html#outcome-variables-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="cleaning.html#cb159-1" tabindex="-1"></a>gsoep_pers_subs <span class="ot">&lt;-</span> <span class="fu">unique</span>(gsoep_pers<span class="sc">$</span>SID)</span>
<span id="cb159-2"><a href="cleaning.html#cb159-2" tabindex="-1"></a>gsoep_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;GSOEP&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb159-3"><a href="cleaning.html#cb159-3" tabindex="-1"></a></span>
<span id="cb159-4"><a href="cleaning.html#cb159-4" tabindex="-1"></a><span class="co"># composite within years </span></span>
<span id="cb159-5"><a href="cleaning.html#cb159-5" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb159-6"><a href="cleaning.html#cb159-6" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb159-7"><a href="cleaning.html#cb159-7" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb159-8"><a href="cleaning.html#cb159-8" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name, year) <span class="sc">%&gt;%</span> <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb159-9"><a href="cleaning.html#cb159-9" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb159-10"><a href="cleaning.html#cb159-10" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb159-11"><a href="cleaning.html#cb159-11" tabindex="-1"></a>}</span>
<span id="cb159-12"><a href="cleaning.html#cb159-12" tabindex="-1"></a></span>
<span id="cb159-13"><a href="cleaning.html#cb159-13" tabindex="-1"></a></span>
<span id="cb159-14"><a href="cleaning.html#cb159-14" tabindex="-1"></a>gsoep_out <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb159-15"><a href="cleaning.html#cb159-15" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb159-16"><a href="cleaning.html#cb159-16" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb159-17"><a href="cleaning.html#cb159-17" tabindex="-1"></a>  <span class="co"># filter(year &lt;= max(gsoep_waves$Used)) %&gt;%</span></span>
<span id="cb159-18"><a href="cleaning.html#cb159-18" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb159-19"><a href="cleaning.html#cb159-19" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb159-20"><a href="cleaning.html#cb159-20" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb159-21"><a href="cleaning.html#cb159-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comp_rule =</span> <span class="fu">ifelse</span>(comp_rule <span class="sc">==</span> <span class="st">&quot;select&quot;</span>, <span class="st">&quot;skip&quot;</span>, comp_rule),</span>
<span id="cb159-22"><a href="cleaning.html#cb159-22" tabindex="-1"></a>         <span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb159-23"><a href="cleaning.html#cb159-23" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb159-24"><a href="cleaning.html#cb159-24" tabindex="-1"></a></span>
<span id="cb159-25"><a href="cleaning.html#cb159-25" tabindex="-1"></a><span class="co"># composite across years</span></span>
<span id="cb159-26"><a href="cleaning.html#cb159-26" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(p_year){</span>
<span id="cb159-27"><a href="cleaning.html#cb159-27" tabindex="-1"></a>  gsoep_out <span class="sc">%&gt;%</span></span>
<span id="cb159-28"><a href="cleaning.html#cb159-28" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, name) <span class="sc">%&gt;%</span></span>
<span id="cb159-29"><a href="cleaning.html#cb159-29" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb159-30"><a href="cleaning.html#cb159-30" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb159-31"><a href="cleaning.html#cb159-31" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) </span>
<span id="cb159-32"><a href="cleaning.html#cb159-32" tabindex="-1"></a>}</span>
<span id="cb159-33"><a href="cleaning.html#cb159-33" tabindex="-1"></a></span>
<span id="cb159-34"><a href="cleaning.html#cb159-34" tabindex="-1"></a>gsoep_out <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">p_year =</span> gsoep_waves<span class="sc">$</span>Used) <span class="sc">%&gt;%</span></span>
<span id="cb159-35"><a href="cleaning.html#cb159-35" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(p_year, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb159-36"><a href="cleaning.html#cb159-36" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb159-37"><a href="cleaning.html#cb159-37" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">o_year =</span> <span class="dv">2017</span>)</span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="cleaning.html#cb160-1" tabindex="-1"></a>gsoep_out</span></code></pre></div>
<pre><code>## # A tibble: 109,214 × 5
##    p_year   SID name     value o_year
##     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1   2005   602 dementia     0   2017
##  2   2005   604 dementia     0   2017
##  3   2005   901 dementia     0   2017
##  4   2005  1501 dementia     0   2017
##  5   2005  1601 dementia     0   2017
##  6   2005  1602 dementia     0   2017
##  7   2005  2301 dementia     0   2017
##  8   2005  2302 dementia     0   2017
##  9   2005  4701 dementia     0   2017
## 10   2005  4901 dementia     0   2017
## # ℹ 109,204 more rows</code></pre>
</div>
<div id="cognition-variables-6" class="section level3 hasAnchor" number="2.7.6">
<h3><span class="header-section-number">2.7.6</span> Cognition Variables<a href="cleaning.html#cognition-variables-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="cleaning.html#cb162-1" tabindex="-1"></a>gsoep_cog <span class="ot">&lt;-</span> gsoep_recode <span class="sc">%&gt;%</span></span>
<span id="cb162-2"><a href="cleaning.html#cb162-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb162-3"><a href="cleaning.html#cb162-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb162-4"><a href="cleaning.html#cb162-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value))</span>
<span id="cb162-5"><a href="cleaning.html#cb162-5" tabindex="-1"></a></span>
<span id="cb162-6"><a href="cleaning.html#cb162-6" tabindex="-1"></a>gsoep_cog_waves <span class="ot">&lt;-</span> gsoep_cog <span class="sc">%&gt;%</span></span>
<span id="cb162-7"><a href="cleaning.html#cb162-7" tabindex="-1"></a>  <span class="fu">select</span>(itemname, SID, year) <span class="sc">%&gt;%</span></span>
<span id="cb162-8"><a href="cleaning.html#cb162-8" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, itemname) <span class="sc">%&gt;%</span></span>
<span id="cb162-9"><a href="cleaning.html#cb162-9" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o_year =</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb162-10"><a href="cleaning.html#cb162-10" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb162-11"><a href="cleaning.html#cb162-11" tabindex="-1"></a></span>
<span id="cb162-12"><a href="cleaning.html#cb162-12" tabindex="-1"></a>gsoep_cog <span class="ot">&lt;-</span> gsoep_cog <span class="sc">%&gt;%</span></span>
<span id="cb162-13"><a href="cleaning.html#cb162-13" tabindex="-1"></a>  <span class="fu">right_join</span>(gsoep_cog_waves) <span class="sc">%&gt;%</span></span>
<span id="cb162-14"><a href="cleaning.html#cb162-14" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> o_year) <span class="sc">%&gt;%</span></span>
<span id="cb162-15"><a href="cleaning.html#cb162-15" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb162-16"><a href="cleaning.html#cb162-16" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, year) <span class="sc">%&gt;%</span></span>
<span id="cb162-17"><a href="cleaning.html#cb162-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb162-18"><a href="cleaning.html#cb162-18" tabindex="-1"></a>  <span class="fu">group_by</span>(name, o_year, SID) <span class="sc">%&gt;%</span></span>
<span id="cb162-19"><a href="cleaning.html#cb162-19" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb162-20"><a href="cleaning.html#cb162-20" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb162-21"><a href="cleaning.html#cb162-21" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="cleaning.html#cb163-1" tabindex="-1"></a>gsoep_cog</span></code></pre></div>
<pre><code>## # A tibble: 22,445 × 3
##    o_year   SID cognition
##     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1   2012   201      0   
##  2   2012  1501      3.81
##  3   2012  5601      2.06
##  4   2012  6002      2.46
##  5   2012  7302      1.44
##  6   2012  8603      3.75
##  7   2012  9801      3.88
##  8   2012 11301      3.45
##  9   2012 12303      2.66
## 10   2012 13401      1.98
## # ℹ 22,435 more rows</code></pre>
</div>
<div id="combine-data-6" class="section level3 hasAnchor" number="2.7.7">
<h3><span class="header-section-number">2.7.7</span> Combine Data<a href="cleaning.html#combine-data-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="cleaning.html#cb165-1" tabindex="-1"></a>gsoep_combined <span class="ot">&lt;-</span> gsoep_pers <span class="sc">%&gt;%</span> </span>
<span id="cb165-2"><a href="cleaning.html#cb165-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="cleaning.html#cb165-3" tabindex="-1"></a>  <span class="fu">full_join</span>(gsoep_out <span class="sc">%&gt;%</span> <span class="fu">select</span>(p_year, SID, <span class="at">Outcome =</span> name, o_year, <span class="at">o_value =</span> value)) <span class="sc">%&gt;%</span></span>
<span id="cb165-4"><a href="cleaning.html#cb165-4" tabindex="-1"></a>  <span class="fu">full_join</span>(gsoep_cov) <span class="sc">%&gt;%</span></span>
<span id="cb165-5"><a href="cleaning.html#cb165-5" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb165-6"><a href="cleaning.html#cb165-6" tabindex="-1"></a>    gsoep_out <span class="sc">%&gt;%</span></span>
<span id="cb165-7"><a href="cleaning.html#cb165-7" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb165-8"><a href="cleaning.html#cb165-8" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb165-9"><a href="cleaning.html#cb165-9" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb165-10"><a href="cleaning.html#cb165-10" tabindex="-1"></a>  <span class="fu">full_join</span>(gsoep_cog) <span class="sc">%&gt;%</span></span>
<span id="cb165-11"><a href="cleaning.html#cb165-11" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value)) <span class="sc">%&gt;%</span></span>
<span id="cb165-12"><a href="cleaning.html#cb165-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> p_year <span class="sc">-</span> yearBrth</span>
<span id="cb165-13"><a href="cleaning.html#cb165-13" tabindex="-1"></a>         , <span class="at">BMI =</span> weight<span class="sc">/</span>((height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="cleaning.html#cb166-1" tabindex="-1"></a>gsoep_combined</span></code></pre></div>
<pre><code>## # A tibble: 136,465 × 24
##    Trait p_year   SID p_value Outcome  o_year o_value exercise height weight cancer diabetes married stroke
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 A       2005   602    4.33 dementia   2017       0     2.8    177    87        0        0       1      0
##  2 A       2005   901    4.67 dementia   2017       0     2.8    158    47        0        0       0      0
##  3 A       2005  1501    4.67 dementia   2017       0     1      168.   84        0        0       0      0
##  4 A       2005  1601    4    dementia   2017       0     2.67   174.   75        0        0       1      0
##  5 A       2005  1602    6.67 dementia   2017       0     2      160.   48        0        0       1      0
##  6 A       2005  2301    5    dementia   2017       0     1.8    180    75        0        0       1      0
##  7 A       2005  2302    3.33 dementia   2017       0     3      157    46.5      0        0       1      0
##  8 A       2005  4701    6    dementia   2017       0     2.2    168    70        0        0       0      0
##  9 A       2005  4901    5.33 dementia   2017       0     1      162.   66.5      0        0       0      0
## 10 A       2005  5201    6.33 dementia   2017       0     1.07   183    83        0        0       1      0
## # ℹ 136,455 more rows
## # ℹ 10 more variables: alcohol &lt;dbl&gt;, education &lt;dbl&gt;, smokes &lt;dbl&gt;, gender &lt;dbl&gt;, yearBrth &lt;dbl&gt;,
## #   age &lt;dbl&gt;, SRhealth &lt;dbl&gt;, dementia &lt;dbl&gt;, cognition &lt;dbl&gt;, BMI &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="cleaning.html#cb168-1" tabindex="-1"></a><span class="fu">save</span>(gsoep_cov, gsoep_alpha, gsoep_pers, gsoep_out, gsoep_combined, gsoep_cog,</span>
<span id="cb168-2"><a href="cleaning.html#cb168-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/gsoep_cleaned.RData&quot;</span>, load_path))</span></code></pre></div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="cleaning.html#cb169-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;gsoep&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>
</div>
</div>
<div id="the-longitudinal-studies-for-the-social-sciences-liss" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> The Longitudinal Studies for the Social sciences (LISS)<a href="cleaning.html#the-longitudinal-studies-for-the-social-sciences-liss" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Longitudinal Studies for the Social sciences (LISS; Scherpenzeel, Das, Ester, &amp; Kaczmirek, 2010) is an ongoing longitudinal study of households in the Netherlands. These data are online, through application, from <a href="https://statements.centerdata.nl/liss-panel-data-statement" class="uri">https://statements.centerdata.nl/liss-panel-data-statement</a>.</p>
<p>Participants were approximately 8,000 Dutch-speaking individuals permanently residing in the Netherlands from 5,000 households. Data have been collected annually since 2007. The latest data release includes 11 waves of data from 2008 to 2018. More documentation are available at <a href="https://www.dataarchive.lissdata.nl/study_units/view/1" class="uri">https://www.dataarchive.lissdata.nl/study_units/view/1</a>.</p>
<p>Sample sizes vary by year, ranging from 5,021 (2018) to 6808 (2008). This provides 99/% power to detect a correlation effect size of ~.04, two-tailed at alpha .05.</p>
<div id="load-data-6" class="section level3 hasAnchor" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Load Data<a href="cleaning.html#load-data-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="cleaning.html#cb170-1" tabindex="-1"></a>liss_read_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb170-2"><a href="cleaning.html#cb170-2" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">&quot;%s/liss/%s&quot;</span>, data_path, x) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">one_of</span>(old.names))</span>
<span id="cb170-3"><a href="cleaning.html#cb170-3" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="cleaning.html#cb171-1" tabindex="-1"></a>liss_codebook <span class="ot">&lt;-</span> (codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(study <span class="sc">==</span> <span class="st">&quot;LISS&quot;</span>))<span class="sc">$</span>codebook[[<span class="dv">1</span>]]</span>
<span id="cb171-2"><a href="cleaning.html#cb171-2" tabindex="-1"></a>liss_codebook</span></code></pre></div>
<pre><code>## # A tibble: 1,327 × 17
##    study dataset    category   name      itemname  wave wave_letter  year orig_itemname description    scale
##    &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;
##  1 liss  ai07a      cognition  cognition BSI          1 a            2008 ai07a031      BSI problems … &quot;1\t…
##  2 liss  ai08b      cognition  cognition BSI          2 b            2009 ai08b031      BSI problems … &quot;1\t…
##  3 liss  ai08c      cognition  cognition BSI          3 c            2010 ai08c031      BSI problems … &quot;1\t…
##  4 liss  ai08d      cognition  cognition BSI          4 d            2011 ai08d031      BSI problems … &quot;1\t…
##  5 liss  avars_2008 covariates yearBrth  YOB1         1 a            2008 gebjaar       Year of Birth  &quot;num…
##  6 liss  avars_2009 covariates yearBrth  YOB1         2 b            2009 gebjaar       Year of Birth  &quot;num…
##  7 liss  avars_2010 covariates yearBrth  YOB1         3 c            2010 gebjaar       Year of Birth  &quot;num…
##  8 liss  avars_2011 covariates yearBrth  YOB1         4 d            2011 gebjaar       Year of Birth  &quot;num…
##  9 liss  avars_2012 covariates yearBrth  YOB1         5 e            2012 gebjaar       Year of Birth  &quot;num…
## 10 liss  avars_2013 covariates yearBrth  YOB1         6 f            2013 gebjaar       Year of Birth  &quot;num…
## # ℹ 1,317 more rows
## # ℹ 6 more variables: reverse_code &lt;chr&gt;, recode &lt;chr&gt;, mini &lt;dbl&gt;, maxi &lt;dbl&gt;, comp_rule &lt;chr&gt;,
## #   long_rule &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="cleaning.html#cb173-1" tabindex="-1"></a>old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>(liss_codebook<span class="sc">$</span>orig_itemname) <span class="sc">%&gt;%</span> str_to_lower</span>
<span id="cb173-2"><a href="cleaning.html#cb173-2" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/liss&quot;</span>, data_path) <span class="sc">%&gt;%</span> <span class="fu">list.files</span>()</span>
<span id="cb173-3"><a href="cleaning.html#cb173-3" tabindex="-1"></a>liss <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">datasets =</span> datasets) <span class="sc">%&gt;%</span></span>
<span id="cb173-4"><a href="cleaning.html#cb173-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(datasets, liss_read_fun)) </span>
<span id="cb173-5"><a href="cleaning.html#cb173-5" tabindex="-1"></a></span>
<span id="cb173-6"><a href="cleaning.html#cb173-6" tabindex="-1"></a>liss <span class="ot">&lt;-</span> <span class="fu">reduce</span>(liss<span class="sc">$</span>data, full_join) <span class="sc">%&gt;%</span> haven<span class="sc">::</span><span class="fu">zap_labels</span>(.)</span>
<span id="cb173-7"><a href="cleaning.html#cb173-7" tabindex="-1"></a><span class="fu">save</span>(liss, <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/liss_raw.RData&quot;</span>, load_path))</span>
<span id="cb173-8"><a href="cleaning.html#cb173-8" tabindex="-1"></a></span>
<span id="cb173-9"><a href="cleaning.html#cb173-9" tabindex="-1"></a>avars <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ds =</span> datasets[<span class="fu">grepl</span>(<span class="st">&quot;avar&quot;</span>, datasets)]) <span class="sc">%&gt;%</span></span>
<span id="cb173-10"><a href="cleaning.html#cb173-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(ds, <span class="sc">~</span><span class="fu">sprintf</span>(<span class="st">&quot;%s/liss/%s&quot;</span>, data_path, .) <span class="sc">%&gt;%</span> </span>
<span id="cb173-11"><a href="cleaning.html#cb173-11" tabindex="-1"></a>                      haven<span class="sc">::</span><span class="fu">read_sav</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb173-12"><a href="cleaning.html#cb173-12" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span> </span>
<span id="cb173-13"><a href="cleaning.html#cb173-13" tabindex="-1"></a>                      haven<span class="sc">::</span><span class="fu">zap_labels</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb173-14"><a href="cleaning.html#cb173-14" tabindex="-1"></a>  <span class="fu">separate</span>(ds, <span class="fu">c</span>(<span class="st">&quot;ds&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;scrap1&quot;</span>, <span class="st">&quot;scrap2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb173-15"><a href="cleaning.html#cb173-15" tabindex="-1"></a>  <span class="fu">separate</span>(year, <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>), <span class="sc">-</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb173-16"><a href="cleaning.html#cb173-16" tabindex="-1"></a>  <span class="fu">select</span>(year, month, data) <span class="sc">%&gt;%</span> </span>
<span id="cb173-17"><a href="cleaning.html#cb173-17" tabindex="-1"></a>  <span class="fu">unnest</span>(data) </span></code></pre></div>
</div>
<div id="recoding-reverse-scoring-5" class="section level3 hasAnchor" number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> Recoding &amp; Reverse-Scoring<a href="cleaning.html#recoding-reverse-scoring-5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="cleaning.html#cb174-1" tabindex="-1"></a>rename_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(cb, var){</span>
<span id="cb174-2"><a href="cleaning.html#cb174-2" tabindex="-1"></a>  <span class="fu">print</span>(var)</span>
<span id="cb174-3"><a href="cleaning.html#cb174-3" tabindex="-1"></a>  old.names <span class="ot">&lt;-</span> <span class="fu">unique</span>((liss_codebook <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> var))<span class="sc">$</span>orig_itemname)</span>
<span id="cb174-4"><a href="cleaning.html#cb174-4" tabindex="-1"></a>  df <span class="ot">&lt;-</span> liss <span class="sc">%&gt;%</span> </span>
<span id="cb174-5"><a href="cleaning.html#cb174-5" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">SID =</span> nomem_encr, <span class="at">HHID =</span> nohouse_encr, <span class="fu">one_of</span>(old.names)) <span class="sc">%&gt;%</span></span>
<span id="cb174-6"><a href="cleaning.html#cb174-6" tabindex="-1"></a>    <span class="fu">gather</span>(<span class="at">key =</span> orig_itemname, <span class="at">value =</span> value, </span>
<span id="cb174-7"><a href="cleaning.html#cb174-7" tabindex="-1"></a>           <span class="sc">-</span>SID, <span class="sc">-</span>HHID, <span class="at">na.rm=</span>T)</span>
<span id="cb174-8"><a href="cleaning.html#cb174-8" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(old.names) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb174-9"><a href="cleaning.html#cb174-9" tabindex="-1"></a>      df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule))</span>
<span id="cb174-10"><a href="cleaning.html#cb174-10" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb174-11"><a href="cleaning.html#cb174-11" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cb <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>(itemname<span class="sc">:</span>year)) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">0</span>)</span>
<span id="cb174-12"><a href="cleaning.html#cb174-12" tabindex="-1"></a>  }</span>
<span id="cb174-13"><a href="cleaning.html#cb174-13" tabindex="-1"></a>  <span class="cf">if</span>(var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;yearBrth&quot;</span>, <span class="st">&quot;gender&quot;</span>)) df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(avars <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>category, <span class="sc">-</span>name))</span>
<span id="cb174-14"><a href="cleaning.html#cb174-14" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb174-15"><a href="cleaning.html#cb174-15" tabindex="-1"></a>}</span>
<span id="cb174-16"><a href="cleaning.html#cb174-16" tabindex="-1"></a></span>
<span id="cb174-17"><a href="cleaning.html#cb174-17" tabindex="-1"></a>avars <span class="ot">&lt;-</span> avars <span class="sc">%&gt;%</span></span>
<span id="cb174-18"><a href="cleaning.html#cb174-18" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">SID =</span> nomem_encr, <span class="at">HHID =</span> nohouse_encr, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb174-19"><a href="cleaning.html#cb174-19" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, HHID, year) <span class="sc">%&gt;%</span></span>
<span id="cb174-20"><a href="cleaning.html#cb174-20" tabindex="-1"></a>  <span class="fu">summarize_at</span>(<span class="fu">vars</span>(gebjaar, geslacht), Mode) <span class="sc">%&gt;%</span></span>
<span id="cb174-21"><a href="cleaning.html#cb174-21" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb174-22"><a href="cleaning.html#cb174-22" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;gebjaar&quot;</span>, <span class="st">&quot;geslacht&quot;</span>)</span>
<span id="cb174-23"><a href="cleaning.html#cb174-23" tabindex="-1"></a>               , <span class="at">names_to =</span> <span class="st">&quot;orig_itemname&quot;</span></span>
<span id="cb174-24"><a href="cleaning.html#cb174-24" tabindex="-1"></a>               , <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb174-25"><a href="cleaning.html#cb174-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb174-26"><a href="cleaning.html#cb174-26" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb174-27"><a href="cleaning.html#cb174-27" tabindex="-1"></a>    liss_codebook <span class="sc">%&gt;%</span> </span>
<span id="cb174-28"><a href="cleaning.html#cb174-28" tabindex="-1"></a>      <span class="fu">select</span>(category, name, itemname, year, orig_itemname, reverse_code<span class="sc">:</span>long_rule)</span>
<span id="cb174-29"><a href="cleaning.html#cb174-29" tabindex="-1"></a>    )</span>
<span id="cb174-30"><a href="cleaning.html#cb174-30" tabindex="-1"></a></span>
<span id="cb174-31"><a href="cleaning.html#cb174-31" tabindex="-1"></a><span class="co"># rename variables   </span></span>
<span id="cb174-32"><a href="cleaning.html#cb174-32" tabindex="-1"></a>liss_recode <span class="ot">&lt;-</span> liss_codebook <span class="sc">%&gt;%</span></span>
<span id="cb174-33"><a href="cleaning.html#cb174-33" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;covariates&quot;</span>, <span class="st">&quot;pers&quot;</span>, <span class="st">&quot;outcome&quot;</span>, <span class="st">&quot;cognition&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb174-34"><a href="cleaning.html#cb174-34" tabindex="-1"></a>  <span class="fu">select</span>(category, name<span class="sc">:</span>wave, year<span class="sc">:</span>orig_itemname, reverse_code<span class="sc">:</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb174-35"><a href="cleaning.html#cb174-35" tabindex="-1"></a>  <span class="fu">group_by</span>(category, name) <span class="sc">%&gt;%</span> </span>
<span id="cb174-36"><a href="cleaning.html#cb174-36" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb174-37"><a href="cleaning.html#cb174-37" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb174-38"><a href="cleaning.html#cb174-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, name, rename_fun))</span>
<span id="cb174-39"><a href="cleaning.html#cb174-39" tabindex="-1"></a></span>
<span id="cb174-40"><a href="cleaning.html#cb174-40" tabindex="-1"></a></span>
<span id="cb174-41"><a href="cleaning.html#cb174-41" tabindex="-1"></a>recode_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, y){</span>
<span id="cb174-42"><a href="cleaning.html#cb174-42" tabindex="-1"></a>  x <span class="ot">&lt;-</span> y<span class="sc">$</span>value</span>
<span id="cb174-43"><a href="cleaning.html#cb174-43" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(rule)){y<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> rule))}</span>
<span id="cb174-44"><a href="cleaning.html#cb174-44" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb174-45"><a href="cleaning.html#cb174-45" tabindex="-1"></a>}</span>
<span id="cb174-46"><a href="cleaning.html#cb174-46" tabindex="-1"></a></span>
<span id="cb174-47"><a href="cleaning.html#cb174-47" tabindex="-1"></a></span>
<span id="cb174-48"><a href="cleaning.html#cb174-48" tabindex="-1"></a>liss_recode <span class="ot">&lt;-</span> liss_recode <span class="sc">%&gt;%</span> </span>
<span id="cb174-49"><a href="cleaning.html#cb174-49" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb174-50"><a href="cleaning.html#cb174-50" tabindex="-1"></a>    <span class="fu">group_by</span>(recode) <span class="sc">%&gt;%</span></span>
<span id="cb174-51"><a href="cleaning.html#cb174-51" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb174-52"><a href="cleaning.html#cb174-52" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb174-53"><a href="cleaning.html#cb174-53" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(recode, data), recode_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb174-54"><a href="cleaning.html#cb174-54" tabindex="-1"></a>    <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb174-55"><a href="cleaning.html#cb174-55" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(value <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.nan</span>(value) <span class="sc">|</span> <span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value))))</span>
<span id="cb174-56"><a href="cleaning.html#cb174-56" tabindex="-1"></a></span>
<span id="cb174-57"><a href="cleaning.html#cb174-57" tabindex="-1"></a></span>
<span id="cb174-58"><a href="cleaning.html#cb174-58" tabindex="-1"></a><span class="co"># reverse code </span></span>
<span id="cb174-59"><a href="cleaning.html#cb174-59" tabindex="-1"></a>liss_recode <span class="ot">&lt;-</span> liss_recode <span class="sc">%&gt;%</span></span>
<span id="cb174-60"><a href="cleaning.html#cb174-60" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb174-61"><a href="cleaning.html#cb174-61" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">tolower</span>(reverse_code) <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">|</span> <span class="fu">is.na</span>(reverse_code), value, </span>
<span id="cb174-62"><a href="cleaning.html#cb174-62" tabindex="-1"></a>                        <span class="fu">reverse.code</span>(<span class="sc">-</span><span class="dv">1</span>, value, <span class="at">mini =</span> mini, <span class="at">maxi =</span> maxi)))))</span>
<span id="cb174-63"><a href="cleaning.html#cb174-63" tabindex="-1"></a></span>
<span id="cb174-64"><a href="cleaning.html#cb174-64" tabindex="-1"></a>fun_call <span class="ot">&lt;-</span> <span class="cf">function</span>(x, rule){</span>
<span id="cb174-65"><a href="cleaning.html#cb174-65" tabindex="-1"></a>    <span class="cf">switch</span>(rule,</span>
<span id="cb174-66"><a href="cleaning.html#cb174-66" tabindex="-1"></a>           <span class="at">average =</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb174-67"><a href="cleaning.html#cb174-67" tabindex="-1"></a>           <span class="at">mode =</span> <span class="fu">Mode</span>(x)[<span class="dv">1</span>],</span>
<span id="cb174-68"><a href="cleaning.html#cb174-68" tabindex="-1"></a>           <span class="at">sum =</span> <span class="fu">sum</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb174-69"><a href="cleaning.html#cb174-69" tabindex="-1"></a>           <span class="at">skip =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb174-70"><a href="cleaning.html#cb174-70" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">unique</span>(x)[<span class="dv">1</span>],</span>
<span id="cb174-71"><a href="cleaning.html#cb174-71" tabindex="-1"></a>           <span class="at">max =</span> <span class="fu">max</span>(x, <span class="at">na.rm =</span> T),</span>
<span id="cb174-72"><a href="cleaning.html#cb174-72" tabindex="-1"></a>           <span class="at">min =</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb174-73"><a href="cleaning.html#cb174-73" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="covariates-7" class="section level3 hasAnchor" number="2.8.3">
<h3><span class="header-section-number">2.8.3</span> Covariates<a href="cleaning.html#covariates-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="cleaning.html#cb175-1" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/liss_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="cleaning.html#cb176-1" tabindex="-1"></a><span class="co"># bring in year or birth for cleaning</span></span>
<span id="cb176-2"><a href="cleaning.html#cb176-2" tabindex="-1"></a>liss_cov <span class="ot">&lt;-</span> liss_recode <span class="sc">%&gt;%</span> </span>
<span id="cb176-3"><a href="cleaning.html#cb176-3" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;covariates&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb176-4"><a href="cleaning.html#cb176-4" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb176-5"><a href="cleaning.html#cb176-5" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb176-6"><a href="cleaning.html#cb176-6" tabindex="-1"></a></span>
<span id="cb176-7"><a href="cleaning.html#cb176-7" tabindex="-1"></a><span class="co"># compositing within years</span></span>
<span id="cb176-8"><a href="cleaning.html#cb176-8" tabindex="-1"></a>year_comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(df, rule){</span>
<span id="cb176-9"><a href="cleaning.html#cb176-9" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb176-10"><a href="cleaning.html#cb176-10" tabindex="-1"></a>    <span class="co"># group by person and item (collapse across age)</span></span>
<span id="cb176-11"><a href="cleaning.html#cb176-11" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, HHID, long_rule, name, year) <span class="sc">%&gt;%</span> </span>
<span id="cb176-12"><a href="cleaning.html#cb176-12" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb176-13"><a href="cleaning.html#cb176-13" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb176-14"><a href="cleaning.html#cb176-14" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value))</span>
<span id="cb176-15"><a href="cleaning.html#cb176-15" tabindex="-1"></a>}</span>
<span id="cb176-16"><a href="cleaning.html#cb176-16" tabindex="-1"></a></span>
<span id="cb176-17"><a href="cleaning.html#cb176-17" tabindex="-1"></a>liss_waves <span class="ot">&lt;-</span> p_waves <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Study <span class="sc">==</span> <span class="st">&quot;LISS&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Used) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb176-18"><a href="cleaning.html#cb176-18" tabindex="-1"></a></span>
<span id="cb176-19"><a href="cleaning.html#cb176-19" tabindex="-1"></a>liss_cov <span class="ot">&lt;-</span> liss_cov <span class="sc">%&gt;%</span></span>
<span id="cb176-20"><a href="cleaning.html#cb176-20" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="fu">max</span>(liss_waves<span class="sc">$</span>Used)) <span class="sc">%&gt;%</span></span>
<span id="cb176-21"><a href="cleaning.html#cb176-21" tabindex="-1"></a>  <span class="fu">group_by</span>(comp_rule) <span class="sc">%&gt;%</span></span>
<span id="cb176-22"><a href="cleaning.html#cb176-22" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb176-23"><a href="cleaning.html#cb176-23" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb176-24"><a href="cleaning.html#cb176-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(data, comp_rule, year_comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb176-25"><a href="cleaning.html#cb176-25" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb176-26"><a href="cleaning.html#cb176-26" tabindex="-1"></a></span>
<span id="cb176-27"><a href="cleaning.html#cb176-27" tabindex="-1"></a>comp_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(rule, p_year){</span>
<span id="cb176-28"><a href="cleaning.html#cb176-28" tabindex="-1"></a>  liss_cov <span class="sc">%&gt;%</span></span>
<span id="cb176-29"><a href="cleaning.html#cb176-29" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&lt;=</span> p_year  <span class="sc">&amp;</span> long_rule <span class="sc">==</span> rule) <span class="sc">%&gt;%</span></span>
<span id="cb176-30"><a href="cleaning.html#cb176-30" tabindex="-1"></a>    <span class="fu">group_by</span>(SID, HHID, name) <span class="sc">%&gt;%</span></span>
<span id="cb176-31"><a href="cleaning.html#cb176-31" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">fun_call</span>(value, rule)) <span class="sc">%&gt;%</span></span>
<span id="cb176-32"><a href="cleaning.html#cb176-32" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb176-33"><a href="cleaning.html#cb176-33" tabindex="-1"></a>}</span>
<span id="cb176-34"><a href="cleaning.html#cb176-34" tabindex="-1"></a></span>
<span id="cb176-35"><a href="cleaning.html#cb176-35" tabindex="-1"></a>liss_cov <span class="ot">&lt;-</span> <span class="fu">crossing</span>(</span>
<span id="cb176-36"><a href="cleaning.html#cb176-36" tabindex="-1"></a>  <span class="at">p_year =</span> liss_waves<span class="sc">$</span>Used, </span>
<span id="cb176-37"><a href="cleaning.html#cb176-37" tabindex="-1"></a>  <span class="at">long_rule =</span> <span class="fu">unique</span>(liss_cov<span class="sc">$</span>long_rule)</span>
<span id="cb176-38"><a href="cleaning.html#cb176-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb176-39"><a href="cleaning.html#cb176-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2</span>(long_rule, p_year, comp_fun)) <span class="sc">%&gt;%</span></span>
<span id="cb176-40"><a href="cleaning.html#cb176-40" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb176-41"><a href="cleaning.html#cb176-41" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value) <span class="sc">|</span> <span class="fu">is.nan</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb176-42"><a href="cleaning.html#cb176-42" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>long_rule) <span class="sc">%&gt;%</span></span>
<span id="cb176-43"><a href="cleaning.html#cb176-43" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> name, <span class="at">values_from =</span> value, <span class="at">values_fn =</span> <span class="fu">list</span>(<span class="at">value =</span> max)) <span class="sc">%&gt;%</span></span>
<span id="cb176-44"><a href="cleaning.html#cb176-44" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">BMI =</span> weight<span class="sc">/</span>((height<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="cleaning.html#cb177-1" tabindex="-1"></a>liss_cov</span></code></pre></div>
<pre><code>## # A tibble: 27,202 × 21
##    p_year    SID   HHID weight exercise alcohol cancer diabetes education ethnicity heartProb height
##     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
##  1   2008 800033 583404   58         NA       1      0        0        12         2         0    165
##  2   2008 800042 500277   74.5        0       1      0        0        16        NA         0    169
##  3   2008 800045 548654   84         NA       1      0        0        NA        NA         0    185
##  4   2008 800057 580532   85         NA       1      0        0        18        NA         0    198
##  5   2008 800076 578048   57          0       1      0        0        NA        NA         0    167
##  6   2008 800119 537783   84.5       NA       0      1        0        NA         2         0    174
##  7   2008 800125 582101   61         NA       1      0        0        16         2         0    158
##  8   2008 800134 549826   66         NA       1      0        0        NA        NA         0    162
##  9   2008 800158 519049   87.5       NA       1      0        0        14        NA         0    180
## 10   2008 800170 520571   56.5        0       1      0        0        14        NA         0    160
## # ℹ 27,192 more rows
## # ℹ 9 more variables: parkinsons &lt;dbl&gt;, respDis &lt;dbl&gt;, smokes &lt;dbl&gt;, stroke &lt;dbl&gt;, married &lt;dbl&gt;,
## #   gender &lt;dbl&gt;, yearBrth &lt;dbl&gt;, SRhealth &lt;dbl&gt;, BMI &lt;dbl&gt;</code></pre>
</div>
<div id="personality-variables-7" class="section level3 hasAnchor" number="2.8.4">
<h3><span class="header-section-number">2.8.4</span> Personality Variables<a href="cleaning.html#personality-variables-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="cleaning.html#cb179-1" tabindex="-1"></a>liss_pers <span class="ot">&lt;-</span> liss_recode <span class="sc">%&gt;%</span></span>
<span id="cb179-2"><a href="cleaning.html#cb179-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;pers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="cleaning.html#cb179-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb179-4"><a href="cleaning.html#cb179-4" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> liss_waves<span class="sc">$</span>Used) <span class="sc">%&gt;%</span></span>
<span id="cb179-5"><a href="cleaning.html#cb179-5" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb179-6"><a href="cleaning.html#cb179-6" tabindex="-1"></a></span>
<span id="cb179-7"><a href="cleaning.html#cb179-7" tabindex="-1"></a><span class="co"># alpha&#39;s</span></span>
<span id="cb179-8"><a href="cleaning.html#cb179-8" tabindex="-1"></a>liss_alpha <span class="ot">&lt;-</span> liss_pers <span class="sc">%&gt;%</span></span>
<span id="cb179-9"><a href="cleaning.html#cb179-9" tabindex="-1"></a>  <span class="fu">select</span>(name, itemname, year, SID, value) <span class="sc">%&gt;%</span></span>
<span id="cb179-10"><a href="cleaning.html#cb179-10" tabindex="-1"></a>  <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span></span>
<span id="cb179-11"><a href="cleaning.html#cb179-11" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb179-12"><a href="cleaning.html#cb179-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, <span class="sc">~</span>(.) <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> itemname, <span class="at">values_from =</span> value)),</span>
<span id="cb179-13"><a href="cleaning.html#cb179-13" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">map</span>(data, <span class="fu">possibly</span>(<span class="sc">~</span>psych<span class="sc">::</span><span class="fu">alpha</span>((.) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>SID)), <span class="cn">NA_real_</span>)))</span>
<span id="cb179-14"><a href="cleaning.html#cb179-14" tabindex="-1"></a></span>
<span id="cb179-15"><a href="cleaning.html#cb179-15" tabindex="-1"></a><span class="co"># create composites</span></span>
<span id="cb179-16"><a href="cleaning.html#cb179-16" tabindex="-1"></a>liss_pers <span class="ot">&lt;-</span> liss_pers <span class="sc">%&gt;%</span></span>
<span id="cb179-17"><a href="cleaning.html#cb179-17" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, HHID, name, year) <span class="sc">%&gt;%</span></span>
<span id="cb179-18"><a href="cleaning.html#cb179-18" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> T))  <span class="sc">%&gt;%</span></span>
<span id="cb179-19"><a href="cleaning.html#cb179-19" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="cleaning.html#cb180-1" tabindex="-1"></a>liss_pers</span></code></pre></div>
<pre><code>## # A tibble: 54,280 × 5
##       SID   HHID name   year value
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 800033 583404 A      2008   2.8
##  2 800033 583404 C      2008   2.3
##  3 800033 583404 E      2008   2.4
##  4 800033 583404 N      2008   2.7
##  5 800033 583404 NA     2008   3.3
##  6 800033 583404 O      2008   3.4
##  7 800033 583404 PA     2008   4.2
##  8 800033 583404 SWL    2008   6  
##  9 800042 500277 A      2008   3.7
## 10 800042 500277 C      2008   3.9
## # ℹ 54,270 more rows</code></pre>
</div>
<div id="cognition-variables-7" class="section level3 hasAnchor" number="2.8.5">
<h3><span class="header-section-number">2.8.5</span> Cognition Variables<a href="cleaning.html#cognition-variables-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="cleaning.html#cb182-1" tabindex="-1"></a>liss_cog <span class="ot">&lt;-</span> liss_recode <span class="sc">%&gt;%</span></span>
<span id="cb182-2"><a href="cleaning.html#cb182-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;cognition&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-3"><a href="cleaning.html#cb182-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb182-4"><a href="cleaning.html#cb182-4" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> liss_waves<span class="sc">$</span>Used) <span class="sc">%&gt;%</span></span>
<span id="cb182-5"><a href="cleaning.html#cb182-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb182-6"><a href="cleaning.html#cb182-6" tabindex="-1"></a>  <span class="fu">group_by</span>(name, itemname, year) <span class="sc">%&gt;%</span></span>
<span id="cb182-7"><a href="cleaning.html#cb182-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">pomp</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb182-8"><a href="cleaning.html#cb182-8" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb182-9"><a href="cleaning.html#cb182-9" tabindex="-1"></a>  <span class="fu">group_by</span>(name, SID) <span class="sc">%&gt;%</span></span>
<span id="cb182-10"><a href="cleaning.html#cb182-10" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb182-11"><a href="cleaning.html#cb182-11" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb182-12"><a href="cleaning.html#cb182-12" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="cleaning.html#cb183-1" tabindex="-1"></a>liss_cog</span></code></pre></div>
<pre><code>## # A tibble: 1,804 × 2
##       SID cognition
##     &lt;dbl&gt;     &lt;dbl&gt;
##  1 800076       2.5
##  2 800170       0  
##  3 800186       7.5
##  4 800231       2.5
##  5 800326       0  
##  6 800354       2.5
##  7 800424       7.5
##  8 800540       5  
##  9 800601       5  
## 10 800790       5  
## # ℹ 1,794 more rows</code></pre>
</div>
<div id="outcome-variables-7" class="section level3 hasAnchor" number="2.8.6">
<h3><span class="header-section-number">2.8.6</span> Outcome Variables<a href="cleaning.html#outcome-variables-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="cleaning.html#cb185-1" tabindex="-1"></a>liss_out <span class="ot">&lt;-</span> liss_recode <span class="sc">%&gt;%</span></span>
<span id="cb185-2"><a href="cleaning.html#cb185-2" tabindex="-1"></a>  <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;outcome&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="cleaning.html#cb185-3" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb185-4"><a href="cleaning.html#cb185-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_year =</span> liss_waves<span class="sc">$</span>Used, </span>
<span id="cb185-5"><a href="cleaning.html#cb185-5" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">ifelse</span>(year <span class="sc">&gt;</span> p_year, <span class="st">&quot;future&quot;</span>, <span class="st">&quot;past&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb185-6"><a href="cleaning.html#cb185-6" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, p_year) <span class="sc">%&gt;%</span></span>
<span id="cb185-7"><a href="cleaning.html#cb185-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">o_year =</span> <span class="fu">max</span>(year[<span class="sc">!</span><span class="fu">is.na</span>(value)])) <span class="sc">%&gt;%</span></span>
<span id="cb185-8"><a href="cleaning.html#cb185-8" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, name, group, p_year, o_year) <span class="sc">%&gt;%</span></span>
<span id="cb185-9"><a href="cleaning.html#cb185-9" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">max</span>(value, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb185-10"><a href="cleaning.html#cb185-10" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb185-11"><a href="cleaning.html#cb185-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(value), <span class="cn">NA</span>, value)) <span class="sc">%&gt;%</span></span>
<span id="cb185-12"><a href="cleaning.html#cb185-12" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb185-13"><a href="cleaning.html#cb185-13" tabindex="-1"></a>  <span class="fu">group_by</span>(SID, p_year, name, o_year) <span class="sc">%&gt;%</span></span>
<span id="cb185-14"><a href="cleaning.html#cb185-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(past) <span class="sc">|</span> (past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(future)), future,</span>
<span id="cb185-15"><a href="cleaning.html#cb185-15" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(future), past, </span>
<span id="cb185-16"><a href="cleaning.html#cb185-16" tabindex="-1"></a>                 <span class="fu">ifelse</span>(past <span class="sc">==</span> <span class="dv">1</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb185-17"><a href="cleaning.html#cb185-17" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb185-18"><a href="cleaning.html#cb185-18" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value))</span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="cleaning.html#cb186-1" tabindex="-1"></a>liss_out</span></code></pre></div>
<pre><code>## # A tibble: 13,452 × 7
##       SID name     p_year o_year future  past value
##     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 800009 dementia   2008   2018      0    NA     0
##  2 800012 dementia   2008   2015      0    NA     0
##  3 800015 dementia   2008   2018      0    NA     0
##  4 800018 dementia   2008   2012      0    NA     0
##  5 800033 dementia   2008   2012      0     0     0
##  6 800042 dementia   2008   2016      0     0     0
##  7 800045 dementia   2008   2007     NA     0     0
##  8 800054 dementia   2008   2018      0    NA     0
##  9 800057 dementia   2008   2018      0     0     0
## 10 800073 dementia   2008   2018      0    NA     0
## # ℹ 13,442 more rows</code></pre>
</div>
<div id="combine-data-7" class="section level3 hasAnchor" number="2.8.7">
<h3><span class="header-section-number">2.8.7</span> Combine Data<a href="cleaning.html#combine-data-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="cleaning.html#cb188-1" tabindex="-1"></a>liss_combined <span class="ot">&lt;-</span> liss_pers <span class="sc">%&gt;%</span> </span>
<span id="cb188-2"><a href="cleaning.html#cb188-2" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Trait =</span> name, <span class="at">p_value =</span> value, <span class="at">p_year =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb188-3"><a href="cleaning.html#cb188-3" tabindex="-1"></a>  <span class="fu">full_join</span>(liss_out <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Outcome =</span> name, <span class="at">o_value =</span> value)) <span class="sc">%&gt;%</span></span>
<span id="cb188-4"><a href="cleaning.html#cb188-4" tabindex="-1"></a>  <span class="fu">full_join</span>(liss_cov) <span class="sc">%&gt;%</span></span>
<span id="cb188-5"><a href="cleaning.html#cb188-5" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb188-6"><a href="cleaning.html#cb188-6" tabindex="-1"></a>    liss_out <span class="sc">%&gt;%</span></span>
<span id="cb188-7"><a href="cleaning.html#cb188-7" tabindex="-1"></a>      <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;dementia&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb188-8"><a href="cleaning.html#cb188-8" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">ifelse</span>(<span class="fu">rowSums</span>(<span class="fu">cbind</span>(future, past), <span class="at">na.rm =</span> T) <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb188-9"><a href="cleaning.html#cb188-9" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>future, <span class="sc">-</span>past) <span class="sc">%&gt;%</span></span>
<span id="cb188-10"><a href="cleaning.html#cb188-10" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb188-11"><a href="cleaning.html#cb188-11" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb188-12"><a href="cleaning.html#cb188-12" tabindex="-1"></a>  <span class="fu">full_join</span>(liss_cog) <span class="sc">%&gt;%</span></span>
<span id="cb188-13"><a href="cleaning.html#cb188-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(o_value)) <span class="sc">%&gt;%</span></span>
<span id="cb188-14"><a href="cleaning.html#cb188-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> p_year <span class="sc">-</span> yearBrth)</span></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="cleaning.html#cb189-1" tabindex="-1"></a>liss_combined</span></code></pre></div>
<pre><code>## # A tibble: 52,267 × 31
##       SID   HHID Trait p_year p_value Outcome  o_year future  past o_value weight exercise alcohol cancer
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1 800033 583404 A       2008     2.8 dementia   2012      0     0       0   58         NA       1      0
##  2 800033 583404 C       2008     2.3 dementia   2012      0     0       0   58         NA       1      0
##  3 800033 583404 E       2008     2.4 dementia   2012      0     0       0   58         NA       1      0
##  4 800033 583404 N       2008     2.7 dementia   2012      0     0       0   58         NA       1      0
##  5 800033 583404 NA      2008     3.3 dementia   2012      0     0       0   58         NA       1      0
##  6 800033 583404 O       2008     3.4 dementia   2012      0     0       0   58         NA       1      0
##  7 800033 583404 PA      2008     4.2 dementia   2012      0     0       0   58         NA       1      0
##  8 800033 583404 SWL     2008     6   dementia   2012      0     0       0   58         NA       1      0
##  9 800042 500277 A       2008     3.7 dementia   2016      0     0       0   74.5        0       1      0
## 10 800042 500277 C       2008     3.9 dementia   2016      0     0       0   74.5        0       1      0
## # ℹ 52,257 more rows
## # ℹ 17 more variables: diabetes &lt;dbl&gt;, education &lt;dbl&gt;, ethnicity &lt;dbl&gt;, heartProb &lt;dbl&gt;, height &lt;dbl&gt;,
## #   parkinsons &lt;dbl&gt;, respDis &lt;dbl&gt;, smokes &lt;dbl&gt;, stroke &lt;dbl&gt;, married &lt;dbl&gt;, gender &lt;dbl&gt;,
## #   yearBrth &lt;dbl&gt;, SRhealth &lt;dbl&gt;, BMI &lt;dbl&gt;, dementia &lt;dbl&gt;, cognition &lt;dbl&gt;, age &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="cleaning.html#cb191-1" tabindex="-1"></a><span class="fu">save</span>(liss_cov, liss_alpha, liss_pers, liss_out, liss_combined, liss_cog, </span>
<span id="cb191-2"><a href="cleaning.html#cb191-2" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">sprintf</span>(<span class="st">&quot;%s/data/clean/liss_cleaned.RData&quot;</span>, local_path))</span></code></pre></div>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="cleaning.html#cb192-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span><span class="fu">ls</span>()[<span class="fu">grepl</span>(<span class="st">&quot;liss&quot;</span>, <span class="fu">ls</span>())])</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="runmodels.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-data-cleaning.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
